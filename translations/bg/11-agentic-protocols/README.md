# Използване на агентни протоколи (MCP, A2A и NLWeb)

[![Агентни протоколи](../../../translated_images/bg/lesson-11-thumbnail.b6c742949cf1ce2a.webp)](https://youtu.be/X-Dh9R3Opn8)

> _(Кликнете върху изображението по-горе, за да гледате видеото на този урок)_

С нарастването на използването на AI агенти, нараства и нуждата от протоколи, които гарантират стандартизация, сигурност и подпомагат отворените иновации. В този урок ще разгледаме 3 протокола, които целят да задоволят тази нужда - Model Context Protocol (MCP), Agent to Agent (A2A) и Natural Language Web (NLWeb).

## Въведение

В този урок ще разгледаме:

• Как **MCP** позволява на AI агенти да имат достъп до външни инструменти и данни за изпълнение на потребителски задачи.

• Как **A2A** дава възможност за комуникация и сътрудничество между различни AI агенти.

• Как **NLWeb** внедрява естественоезикови интерфейси на всякакъв уебсайт, позволявайки на AI агенти да откриват и взаимодействат със съдържанието.

## Учебни цели

• **Идентифициране** на основната цел и ползите от MCP, A2A и NLWeb в контекста на AI агентите.

• **Обяснение** как всеки протокол улеснява комуникацията и взаимодействието между LLM, инструменти и други агенти.

• **Разпознаване** на различните роли, които всеки протокол играе при изграждането на сложни агентни системи.

## Model Context Protocol

The **Model Context Protocol (MCP)** е отворен стандарт, който предоставя стандартизирани начини за приложенията да осигуряват контекст и инструменти за LLM. Това позволява „универсален адаптер“ към различни източници на данни и инструменти, към които AI агентите могат да се свързват по последователен начин.

Нека разгледаме компонентите на MCP, предимствата в сравнение с директната употреба на API и пример за това как AI агенти може да използват MCP сървър.

### Основни компоненти на MCP

MCP оперира върху **клиент-сървърна архитектура** и основните компоненти са:

• **Hosts** са LLM приложения (например редактор на код като VSCode), които инициират връзките към MCP Server.

• **Clients** са компоненти в рамките на host приложението, които поддържат едно към едно връзки със сървърите.

• **Servers** са леки програми, които предоставят специфични възможности.

В протокола са включени три основни примитивa, които са възможностите на един MCP Server:

• **Tools**: Това са отделни действия или функции, които AI агент може да извика, за да изпълни действие. Например, метеорологична услуга може да изложи инструмент "get weather", или e-commerce сървър може да изложи инструмент "purchase product". MCP сървърите рекламират името на всеки инструмент, описание и входно/изходна схема в списъка с възможности.

• **Resources**: Това са само за четене елементи от данни или документи, които MCP сървър може да предостави, и клиентите могат да ги извличат при поискване. Примери включват съдържание на файлове, записи от база данни или лог файлове. Ресурсите могат да бъдат текстови (като код или JSON) или бинарни (като изображения или PDF).

• **Prompts**: Това са предварително дефинирани шаблони, които предоставят предложени подканвания, позволявайки по-сложни работни потоци.

### Предимства на MCP

MCP предлага значителни предимства за AI агентите:

• **Динамично откриване на инструменти**: Агентите могат динамично да получават списък с налични инструменти от сървъра заедно с описания на това какво вършат. Това контрастира с традиционните API, които често изискват статично кодиране за интеграции, което означава, че всяка промяна в API изисква обновяване на кода. MCP предлага подход „интегрирай веднъж“, водещ до по-голяма адаптивност.

• **Взаимодействие между различни LLM**: MCP работи с различни LLM, предоставяйки гъвкавост за смяна на основните модели за по-добра производителност.

• **Стандартизирана сигурност**: MCP включва стандартизиран метод за автентикация, подобрявайки мащабируемостта при добавяне на достъп до допълнителни MCP сървъри. Това е по-просто от управлението на различни ключове и типове автентикация за различни традиционни API.

### Пример за MCP

![Диаграма на MCP](../../../translated_images/bg/mcp-diagram.e4ca1cbd551444a1.webp)

Представете си, че потребител иска да резервира полет, използвайки AI асистент захранван от MCP.

1. **Връзка**: AI асистентът (MCP client) се свързва с MCP server, предоставен от авиокомпания.

2. **Откриване на инструменти**: Клиентът пита MCP сървъра на авиокомпанията: "Какви инструменти имате налични?" Сървърът отговаря с инструменти като "search flights" и "book flights".

3. **Извикване на инструмент**: След това вие питате AI асистента: "Моля, потърси полет от Portland до Honolulu." AI асистентът, използвайки своя LLM, идентифицира, че трябва да извика инструмента "search flights" и предава съответните параметри (origin, destination) на MCP сървъра.

4. **Изпълнение и отговор**: MCP сървърът, действащ като обвивка, прави реалното извикване към вътрешното API за резервации на авиокомпанията. След това получава информацията за полетите (напр. JSON данни) и я изпраща обратно на AI асистента.

5. **Допълнително взаимодействие**: AI асистентът представя опциите за полети. След като изберете полет, асистентът може да извика инструмента "book flight" на същия MCP сървър, завършвайки резервацията.

## Протокол агент-към-агент (A2A)

Докато MCP се фокусира върху свързването на LLM към инструменти, **Протоколът агент-към-агент (A2A)** прави една стъпка напред, като позволява комуникация и сътрудничество между различни AI агенти. A2A свързва AI агенти от различни организации, среди и технологични стекове, за да изпълнят споделена задача.

Ще разгледаме компонентите и предимствата на A2A, заедно с пример за това как може да се приложи в нашето туристическо приложение.

### Основни компоненти на A2A

A2A се фокусира върху осигуряване на комуникация между агенти и позволява на тях да работят заедно, за да завършат подзадача на потребителя. Всеки компонент на протокола допринася за това:

#### Agent Card

Подобно на това как MCP сървър споделя списък с инструменти, Agent Card съдържа:
- Името на агента .
- **описание на общите задачи**, които той изпълнява.
- **списък със специфични умения** с описания, които помагат на другите агенти (или дори човешки потребители) да разберат кога и защо биха искали да извикат този агент.
- **текущия Endpoint URL** на агента
- **версията** и **възможностите** на агента като streaming responses и push notifications.

#### Agent Executor

Agent Executor е отговорен за **предаването на контекста на потребителския чат към отдалечения агент**, отдалеченият агент се нуждае от това, за да разбере задачата, която трябва да бъде изпълнена. В един A2A сървър, агентът използва собствен Large Language Model (LLM), за да анализира входящите заявки и да изпълнява задачи, използвайки своите вътрешни инструменти.

#### Artifact

След като отдалеченият агент завърши поисканата задача, неговият краен продукт се създава като артефакт. Артефактът **съдържа резултата от работата на агента**, **описание на това, което е изпълнено**, и **текстовия контекст**, който се предава през протокола. След изпращането на артефакта връзката с отдалечения агент се затваря, докато отново не бъде необходима.

#### Event Queue

Този компонент се използва за **обработка на актуализации и предаване на съобщения**. Той е особено важен в продукционни агентни системи, за да се предотврати затварянето на връзката между агентите преди задачата да е завършена, особено когато времето за изпълнение на задачата може да е по-дълго.

### Предимства на A2A

• **Подобрено сътрудничество**: Позволява на агенти от различни доставчици и платформи да взаимодействат, да споделят контекст и да работят заедно, улеснявайки безпроблемна автоматизация през традиционно несвързани системи.

• **Гъвкавост при избора на модел**: Всеки A2A агент може да реши кой LLM да използва за обслужване на своите заявки, позволявайки оптимизирани или финно настроени модели за всеки агент, за разлика от единична LLM връзка в някои MCP сценарии.

• **Вградена автентикация**: Автентикацията е интегрирана директно в A2A протокола, предоставяйки здравословна рамка за сигурност при взаимодействията между агенти.

### Пример за A2A

![Диаграма на A2A](../../../translated_images/bg/A2A-Diagram.8666928d648acc26.webp)

Нека разширим нашия сценарий за резервация на пътуване, но този път използвайки A2A.

1. **Потребителска заявка към мулти-агент**: Потребител взаимодейства с "Travel Agent" A2A клиент/агент, например казвайки: "Моля, резервирай цялото пътуване до Honolulu за следващата седмица, включително полети, хотел и кола под наем".

2. **Оркестрация от Travel Agent**: Travel Agent получава тази сложна заявка. Той използва своя LLM, за да разсъждава за задачата и да определи, че трябва да взаимодейства с други специализирани агенти.

3. **Междуагентна комуникация**: Travel Agent използва A2A протокола, за да се свърже със downstream агенти, като "Airline Agent", "Hotel Agent" и "Car Rental Agent", които са създадени от различни компании.

4. **Делегирано изпълнение на задачи**: Travel Agent изпраща специфични задачи на тези специализирани агенти (напр. "Find flights to Honolulu", "Book a hotel", "Rent a car"). Всеки от тези специализирани агенти, работещи със собствените си LLM и използващи собствени инструменти (които сами по себе си може да са MCP сървъри), изпълнява своята част от резервацията.

5. **Консолидиран отговор**: След като всички downstream агенти завършат задачите си, Travel Agent компилира резултатите (детайли за полетите, потвърждение за хотел, резервация на кола) и изпраща подробен чат-стил отговор обратно на потребителя.

## Natural Language Web (NLWeb)

Уебсайтовете отдавна са основният начин за потребителите да достъпват информация и данни в интернет.

Нека разгледаме различните компоненти на NLWeb, ползите от NLWeb и пример за това как работи нашият NLWeb, разглеждайки нашето туристическо приложение.

### Компоненти на NLWeb

- **NLWeb Application (Core Service Code)**: Системата, която обработва въпроси на естествен език. Тя свързва различните части на платформата, за да създава отговори. Можете да я разглеждате като **двигателя, който захранва естественоезиковите функции** на един уебсайт.

- **NLWeb Protocol**: Това е **основен набор от правила за естественоезиково взаимодействие** с уебсайт. Той връща отговори в JSON формат (често използвайки Schema.org). Неговата цел е да създаде проста основа за „AI уеба“, по същия начин, по който HTML направи възможно споделянето на документи онлайн.

- **MCP Server (Model Context Protocol Endpoint)**: Всяка NLWeb инсталация също работи като **MCP сървър**. Това означава, че може да **споделя инструменти (като метод "ask") и данни** с други AI системи. На практика това прави съдържанието и възможностите на уебсайта използваеми от AI агенти, позволявайки на сайта да стане част от по-широката „екосистема на агенти“.

- **Embedding Models**: Тези модели се използват за **преобразуване на съдържанието на уебсайта в числови представяния, наречени вектори** (embeddings). Тези вектори улавят смисъл по начин, по който компютрите могат да сравняват и търсят. Те се съхраняват в специална база данни и потребителите могат да изберат кой embedding модел да използват.

- **Vector Database (Retrieval Mechanism)**: Тази база данни **съхранява embeddings на съдържанието на уебсайта**. Когато някой зададе въпрос, NLWeb проверява векторната база данни, за да намери бързо най-подходящата информация. Тя дава бърз списък с възможни отговори, класирани по сходство. NLWeb работи с различни системи за съхранение на вектори като Qdrant, Snowflake, Milvus, Azure AI Search и Elasticsearch.

### NLWeb по пример

![NLWeb диаграма](../../../translated_images/bg/nlweb-diagram.c1e2390b310e5fe4.webp)

Помислете отново за нашия сайт за резервации на пътувания, но този път той е захранван от NLWeb.

1. **Въвеждане на данни**: Съществуващите продуктови каталози на сайта за пътувания (напр. листинги на полети, описания на хотели, туристически пакети) се форматират с помощта на Schema.org или се зареждат чрез RSS емисии. Инструментите на NLWeb поглъщат тези структурирани данни, създават embeddings и ги съхраняват в локална или отдалечена векторна база данни.

2. **Запитване на естествен език (човек)**: Потребител посещава сайта и, вместо да навигира през менюта, пише в чат интерфейс: "Намери ми семеен хотел в Honolulu с басейн за следващата седмица".

3. **Обработка от NLWeb**: NLWeb приложението получава това запитване. То изпраща заявката до LLM за разбиране и едновременно търси в своята векторна база данни за съответните хотелски листинги.

4. **Точни резултати**: LLM помага да се интерпретират резултатите от търсенето в базата данни, да се идентифицират най-добрите съвпадения на база критерии като "подходящ за семейства", "басейн" и "Honolulu", и след това форматира естественоезиков отговор. Съществено е, че отговорът се отнася до реални хотели от каталога на сайта, като се избягва измисляне на информация.

5. **Взаимодействие с AI агент**: Тъй като NLWeb служи като MCP сървър, външен AI travel agent може също да се свърже с инстанцията NLWeb на този уебсайт. AI агентът би могъл да използва метода `ask`, за да запита сайта директно: `ask("Are there any vegan-friendly restaurants in the Honolulu area recommended by the hotel?")`. NLWeb инстанцията би обработила това, използвайки своята база данни с информация за ресторанти (ако е заредена), и би върнала структуриран JSON отговор.

### Имали ли сте още въпроси относно MCP/A2A/NLWeb?

Присъединете се към [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord) за да се срещнете с други учащи се, да присъствате на офис часове и да получите отговори на вашите въпроси за AI агенти.

## Ресурси

- [MCP for Beginners](https://aka.ms/mcp-for-beginners)  
- [MCP Documentation](https://github.com/microsoft/semantic-kernel/tree/main/python/semantic-kernel/semantic_kernel/connectors/mcp)
- [NLWeb Repo](https://github.com/nlweb-ai/NLWeb)
- [Semantic Kernel Guides](https://learn.microsoft.com/semantic-kernel/)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
Отказ от отговорност:
Този документ е преведен с помощта на услуга за автоматичен превод с изкуствен интелект Co-op Translator (https://github.com/Azure/co-op-translator). Въпреки че се стремим към точност, моля, имайте предвид, че автоматизираните преводи могат да съдържат грешки или неточности. Оригиналният документ на оригиналния език трябва да се смята за авторитетен източник. За критична информация се препоръчва професионален човешки превод. Не носим отговорност за каквито и да е недоразумения или погрешни тълкувания, произтичащи от използването на този превод.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->