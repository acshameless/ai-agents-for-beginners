[![Πρότυπο Σχεδιασμού Σχεδιασμού](../../../translated_images/el/lesson-7-thumbnail.f7163ac557bea123.webp)](https://youtu.be/kPfJ2BrBCMY?si=9pYpPXp0sSbK91Dr)

> _(Κάντε κλικ στην εικόνα παραπάνω για να δείτε το βίντεο αυτού του μαθήματος)_

# Σχεδιασμός Προγραμματισμού

## Εισαγωγή

Αυτό το μάθημα θα καλύψει

* Τον ορισμό ενός σαφούς συνολικού στόχου και τη διάσπαση μιας σύνθετης εργασίας σε διαχειρίσιμες εργασίες.
* Την αξιοποίηση δομημένης εξόδου για πιο αξιόπιστες και μηχανικά αναγνώσιμες απαντήσεις.
* Την εφαρμογή μιας προσέγγισης με βάση τα γεγονότα για τη διαχείριση δυναμικών εργασιών και απροσδόκητων εισόδων.

## Στόχοι Μάθησης

Μετά την ολοκλήρωση αυτού του μαθήματος, θα έχετε κατανόηση για:

* Τον εντοπισμό και τον καθορισμό ενός συνολικού στόχου για έναν πράκτορα τεχνητής νοημοσύνης, διασφαλίζοντας ότι γνωρίζει σαφώς τι πρέπει να επιτευχθεί.
* Τη διάσπαση μιας σύνθετης εργασίας σε διαχειρίσιμες υποεργασίες και την οργάνωσή τους σε μια λογική ακολουθία.
* Την εξοπλισμό των πρακτόρων με τα κατάλληλα εργαλεία (π.χ. εργαλεία αναζήτησης ή εργαλεία ανάλυσης δεδομένων), την απόφαση πότε και πώς θα χρησιμοποιηθούν, και τη διαχείριση απροσδόκητων καταστάσεων που προκύπτουν.
* Την αξιολόγηση των αποτελεσμάτων των υποεργασιών, τη μέτρηση της απόδοσης και την επανάληψη ενεργειών για τη βελτίωση του τελικού αποτελέσματος.

## Καθορισμός του Συνολικού Στόχου και Διάσπαση μιας Εργασίας

![Ορισμός Στόχων και Εργασιών](../../../translated_images/el/defining-goals-tasks.d70439e19e37c47a.webp)

Οι περισσότερες πραγματικές εργασίες είναι πολύπλοκες για να αντιμετωπιστούν σε ένα μόνο βήμα. Ένας πράκτορας ΤΝ χρειάζεται έναν σύντομο στόχο για να καθοδηγήσει τον προγραμματισμό και τις ενέργειές του. Για παράδειγμα, σκεφτείτε τον στόχο:

    "Δημιουργία ενός ταξιδιωτικού προγράμματος 3 ημερών."

Ενώ είναι απλό να δηλωθεί, χρειάζεται ακόμα βελτίωση. Όσο πιο σαφής είναι ο στόχος, τόσο καλύτερα μπορεί ο πράκτορας (και τυχόν συνεργάτες άνθρωποι) να επικεντρωθούν στην επίτευξη του σωστού αποτελέσματος, όπως η δημιουργία ενός ολοκληρωμένου προγράμματος με επιλογές πτήσεων, προτάσεις ξενοδοχείων και προτάσεις δραστηριοτήτων.

### Διάσπαση Εργασίας

Οι μεγάλες ή πολύπλοκες εργασίες γίνονται πιο διαχειρίσιμες όταν διασπώνται σε μικρότερες, προσανατολισμένες σε στόχο υποεργασίες.
Για το παράδειγμα του ταξιδιωτικού προγράμματος, θα μπορούσατε να διασπάσετε το στόχο σε:

* Κράτηση Πτήσης
* Κράτηση Ξενοδοχείου
* Ενοικίαση Αυτοκινήτου
* Εξατομίκευση

Κάθε υποεργασία μπορεί στη συνέχεια να αντιμετωπιστεί από αφιερωμένους πράκτορες ή διαδικασίες. Ένας πράκτορας μπορεί να ειδικεύεται στην αναζήτηση των καλύτερων προσφορών πτήσεων, άλλος εστιάζει στις κρατήσεις ξενοδοχείων, και ούτω καθεξής. Ένας συντονιστικός ή «κατώτερος» πράκτορας μπορεί στη συνέχεια να συνθέσει αυτά τα αποτελέσματα σε ένα συνεκτικό πρόγραμμα για τον τελικό χρήστη.

Αυτή η αρθρωτή προσέγγιση επιτρέπει επίσης σταδιακές βελτιώσεις. Για παράδειγμα, θα μπορούσατε να προσθέσετε εξειδικευμένους πράκτορες για Προτάσεις Φαγητού ή Προτάσεις Τοπικών Δραστηριοτήτων και να βελτιώσετε το πρόγραμμα με την πάροδο του χρόνου.

### Δομημένη έξοδος

Μεγάλα Γλωσσικά Μοντέλα (LLMs) μπορούν να παράγουν δομημένη έξοδο (π.χ. JSON) που είναι ευκολότερο να αναλυθεί και να επεξεργαστεί από κατώτερους πράκτορες ή υπηρεσίες. Αυτό είναι ιδιαίτερα χρήσιμο σε ένα περιβάλλον με πολλούς πράκτορες, όπου μπορούμε να εκτελέσουμε αυτές τις εργασίες μετά τη λήψη της εξόδου του προγραμματισμού. Ανατρέξτε σε αυτήν την <a href="https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/cookbook/structured-output-agent.html" target="_blank">ανάρτηση ιστολογίου</a> για μια γρήγορη επισκόπηση.

Το παρακάτω απόσπασμα Python παρουσιάζει έναν απλό πράκτορα προγραμματισμού που διασπά έναν στόχο σε υποεργασίες και δημιουργεί ένα δομημένο σχέδιο:

```python
from pydantic import BaseModel
from enum import Enum
from typing import List, Optional, Union
import json
import os
from typing import Optional
from pprint import pprint
from autogen_core.models import UserMessage, SystemMessage, AssistantMessage
from autogen_ext.models.azure import AzureAIChatCompletionClient
from azure.core.credentials import AzureKeyCredential

class AgentEnum(str, Enum):
    FlightBooking = "flight_booking"
    HotelBooking = "hotel_booking"
    CarRental = "car_rental"
    ActivitiesBooking = "activities_booking"
    DestinationInfo = "destination_info"
    DefaultAgent = "default_agent"
    GroupChatManager = "group_chat_manager"

# Μοντέλο Υποεργασίας Ταξιδιού
class TravelSubTask(BaseModel):
    task_details: str
    assigned_agent: AgentEnum  # θέλουμε να αναθέσουμε την εργασία στον πράκτορα

class TravelPlan(BaseModel):
    main_task: str
    subtasks: List[TravelSubTask]
    is_greeting: bool

client = AzureAIChatCompletionClient(
    model="gpt-4o-mini",
    endpoint="https://models.inference.ai.azure.com",
    # Για να πιστοποιηθείτε με το μοντέλο θα χρειαστεί να δημιουργήσετε ένα προσωπικό κλειδί πρόσβασης (PAT) στις ρυθμίσεις του GitHub σας.
    # Δημιουργήστε το κλειδί PAT ακολουθώντας τις οδηγίες εδώ: https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens
    credential=AzureKeyCredential(os.environ["GITHUB_TOKEN"]),
    model_info={
        "json_output": False,
        "function_calling": True,
        "vision": True,
        "family": "unknown",
    },
)

# Ορίστε το μήνυμα χρήστη
messages = [
    SystemMessage(content="""You are an planner agent.
    Your job is to decide which agents to run based on the user's request.
                      Provide your response in JSON format with the following structure:
{'main_task': 'Plan a family trip from Singapore to Melbourne.',
 'subtasks': [{'assigned_agent': 'flight_booking',
               'task_details': 'Book round-trip flights from Singapore to '
                               'Melbourne.'}
    Below are the available agents specialised in different tasks:
    - FlightBooking: For booking flights and providing flight information
    - HotelBooking: For booking hotels and providing hotel information
    - CarRental: For booking cars and providing car rental information
    - ActivitiesBooking: For booking activities and providing activity information
    - DestinationInfo: For providing information about destinations
    - DefaultAgent: For handling general requests""", source="system"),
    UserMessage(
        content="Create a travel plan for a family of 2 kids from Singapore to Melboune", source="user"),
]

response = await client.create(messages=messages, extra_create_args={"response_format": 'json_object'})

response_content: Optional[str] = response.content if isinstance(
    response.content, str) else None
if response_content is None:
    raise ValueError("Response content is not a valid JSON string" )

pprint(json.loads(response_content))

# # Βεβαιωθείτε ότι η απάντηση είναι έγκυρο JSON πριν την φορτώσετε
# response_content: Optional[str] = response.content αν είναι τύπου (
#     response.content, str) αλλιώς None
# αν το response_content είναι None:
#     raise ValueError("Το περιεχόμενο απάντησης δεν είναι έγκυρο JSON")

# # Εκτυπώστε το περιεχόμενο απάντησης μετά τη φόρτωση ως JSON
# pprint(json.loads(response_content))

# Επιβεβαιώστε το περιεχόμενο απάντησης με το μοντέλο MathReasoning
# TravelPlan.model_validate(json.loads(response_content))
```

### Πράκτορας Προγραμματισμού με Ορχήστρωση Πολλαπλών Πρακτόρων

Σε αυτό το παράδειγμα, ένας Πράκτορας Σημασιολογικής Δρομολόγησης λαμβάνει ένα αίτημα χρήστη (π.χ., "Χρειάζομαι ένα σχέδιο ξενοδοχείου για το ταξίδι μου.").

Ο προγραμματιστής στη συνέχεια:

* Λαμβάνει το Σχέδιο Ξενοδοχείου: Ο προγραμματιστής παίρνει το μήνυμα του χρήστη και, βασιζόμενος σε ένα σύστημα προτροπής (συμπεριλαμβανομένων των διαθέσιμων λεπτομερειών πρακτόρων), δημιουργεί ένα δομημένο ταξιδιωτικό σχέδιο.
* Λίστα Πρακτόρων και Εργαλείων τους: Το μητρώο πρακτόρων κρατά μια λίστα πρακτόρων (π.χ. για πτήση, ξενοδοχείο, ενοικίαση αυτοκινήτου και δραστηριότητες) μαζί με τις λειτουργίες ή τα εργαλεία που προσφέρουν.
* Δρομολόγηση του Σχεδίου στους αντίστοιχους Πράκτορες: Ανάλογα με τον αριθμό των υποεργασιών, ο προγραμματιστής είτε στέλνει το μήνυμα απευθείας σε έναν αφιερωμένο πράκτορα (για σενάρια μονής εργασίας) είτε συντονίζει μέσω ενός διαχειριστή ομαδικής συνομιλίας για συνεργασία πολλαπλών πρακτόρων.
* Περίληψη του Αποτελέσματος: Τέλος, ο προγραμματιστής συνοψίζει το δημιουργημένο σχέδιο για σαφήνεια.
Το παρακάτω δείγμα κώδικα Python αποτυπώνει αυτά τα βήματα:

```python

from pydantic import BaseModel

from enum import Enum
from typing import List, Optional, Union

class AgentEnum(str, Enum):
    FlightBooking = "flight_booking"
    HotelBooking = "hotel_booking"
    CarRental = "car_rental"
    ActivitiesBooking = "activities_booking"
    DestinationInfo = "destination_info"
    DefaultAgent = "default_agent"
    GroupChatManager = "group_chat_manager"

# Μοντέλο Υπο-Εργασίας Ταξιδίου

class TravelSubTask(BaseModel):
    task_details: str
    assigned_agent: AgentEnum # θέλουμε να αναθέσουμε την εργασία στον πράκτορα

class TravelPlan(BaseModel):
    main_task: str
    subtasks: List[TravelSubTask]
    is_greeting: bool
import json
import os
from typing import Optional

from autogen_core.models import UserMessage, SystemMessage, AssistantMessage
from autogen_ext.models.openai import AzureOpenAIChatCompletionClient

# Δημιουργήστε τον πελάτη με μεταβλητές περιβάλλοντος ελεγμένες ως προς τον τύπο

client = AzureOpenAIChatCompletionClient(
    azure_deployment=os.getenv("AZURE_OPENAI_DEPLOYMENT_NAME"),
    model=os.getenv("AZURE_OPENAI_DEPLOYMENT_NAME"),
    api_version=os.getenv("AZURE_OPENAI_API_VERSION"),
    azure_endpoint=os.getenv("AZURE_OPENAI_ENDPOINT"),
    api_key=os.getenv("AZURE_OPENAI_API_KEY"),
)

from pprint import pprint

# Ορίστε το μήνυμα χρήστη

messages = [
    SystemMessage(content="""You are an planner agent.
    Your job is to decide which agents to run based on the user's request.
    Below are the available agents specialized in different tasks:
    - FlightBooking: For booking flights and providing flight information
    - HotelBooking: For booking hotels and providing hotel information
    - CarRental: For booking cars and providing car rental information
    - ActivitiesBooking: For booking activities and providing activity information
    - DestinationInfo: For providing information about destinations
    - DefaultAgent: For handling general requests""", source="system"),
    UserMessage(content="Create a travel plan for a family of 2 kids from Singapore to Melbourne", source="user"),
]

response = await client.create(messages=messages, extra_create_args={"response_format": TravelPlan})

# Εξασφαλίστε ότι το περιεχόμενο της απόκρισης είναι έγκυρο συμβολοσειρά JSON πριν το φορτώσετε

response_content: Optional[str] = response.content if isinstance(response.content, str) else None
if response_content is None:
    raise ValueError("Response content is not a valid JSON string")

# Εκτυπώστε το περιεχόμενο της απόκρισης μετά το φόρτωμά του ως JSON

pprint(json.loads(response_content))
```

Ακολουθεί η έξοδος από τον προηγούμενο κώδικα και μπορείτε στη συνέχεια να χρησιμοποιήσετε αυτή τη δομημένη έξοδο για το δρομολόγηση στον `assigned_agent` και να συνοψίσετε το ταξιδιωτικό σχέδιο στον τελικό χρήστη.

```json
{
    "is_greeting": "False",
    "main_task": "Plan a family trip from Singapore to Melbourne.",
    "subtasks": [
        {
            "assigned_agent": "flight_booking",
            "task_details": "Book round-trip flights from Singapore to Melbourne."
        },
        {
            "assigned_agent": "hotel_booking",
            "task_details": "Find family-friendly hotels in Melbourne."
        },
        {
            "assigned_agent": "car_rental",
            "task_details": "Arrange a car rental suitable for a family of four in Melbourne."
        },
        {
            "assigned_agent": "activities_booking",
            "task_details": "List family-friendly activities in Melbourne."
        },
        {
            "assigned_agent": "destination_info",
            "task_details": "Provide information about Melbourne as a travel destination."
        }
    ]
}
```

Ένα παράδειγμα σημειωματάριου με το προηγούμενο δείγμα κώδικα είναι διαθέσιμο [εδώ](07-autogen.ipynb).

### Επαναληπτικός Προγραμματισμός

Ορισμένες εργασίες απαιτούν αλληλεπιδραστική προσέγγιση ή αναπρογραμματισμό, όπου το αποτέλεσμα μιας υποεργασίας επηρεάζει την επόμενη. Για παράδειγμα, αν ο πράκτορας ανακαλύψει ένα απροσδόκητο φορμά δεδομένων κατά την κράτηση πτήσεων, μπορεί να χρειαστεί να προσαρμόσει τη στρατηγική του πριν προχωρήσει στις κρατήσεις ξενοδοχείων.

Επιπλέον, η ανατροφοδότηση του χρήστη (π.χ. ένας άνθρωπος που αποφασίζει ότι προτιμά μια πιο νωρίς πτήση) μπορεί να ενεργοποιήσει μερικό επαναπρογραμματισμό. Αυτή η δυναμική, επαναληπτική προσέγγιση διασφαλίζει ότι η τελική λύση ευθυγραμμίζεται με τους περιορισμούς του πραγματικού κόσμου και τις εξελισσόμενες προτιμήσεις των χρηστών.

π.χ. δείγμα κώδικα

```python
from autogen_core.models import UserMessage, SystemMessage, AssistantMessage
#.. το ίδιο με τον προηγούμενο κώδικα και προώθησε το ιστορικό χρήστη, το τρέχον σχέδιο
messages = [
    SystemMessage(content="""You are a planner agent to optimize the
    Your job is to decide which agents to run based on the user's request.
    Below are the available agents specialized in different tasks:
    - FlightBooking: For booking flights and providing flight information
    - HotelBooking: For booking hotels and providing hotel information
    - CarRental: For booking cars and providing car rental information
    - ActivitiesBooking: For booking activities and providing activity information
    - DestinationInfo: For providing information about destinations
    - DefaultAgent: For handling general requests""", source="system"),
    UserMessage(content="Create a travel plan for a family of 2 kids from Singapore to Melbourne", source="user"),
    AssistantMessage(content=f"Previous travel plan - {TravelPlan}", source="assistant")
]
# .. ξανασχεδίασε και στείλε τις εργασίες στους αντίστοιχους πράκτορες
```

Για πιο ολοκληρωμένο προγραμματισμό δείτε το Magnetic One <a href="https://www.microsoft.com/research/articles/magentic-one-a-generalist-multi-agent-system-for-solving-complex-tasks" target="_blank">Ανακοίνωση</a> για την επίλυση σύνθετων εργασιών.

## Περίληψη

Σε αυτό το άρθρο εξετάσαμε ένα παράδειγμα για το πώς μπορούμε να δημιουργήσουμε έναν προγραμματιστή που μπορεί δυναμικά να επιλέγει τους διαθέσιμους ορισμένους πράκτορες. Η έξοδος του Προγραμματιστή διασπά τις εργασίες και αναθέτει τους πράκτορες ώστε να μπορούν να εκτελεστούν. Υποτίθεται ότι οι πράκτορες έχουν πρόσβαση στις λειτουργίες/εργαλεία που απαιτούνται για να πραγματοποιήσουν την εργασία. Επιπλέον των πρακτόρων μπορείτε να συμπεριλάβετε και άλλα πρότυπα όπως reflection, summarizer, και round robin chat για περαιτέρω παραμετροποίηση.

## Πρόσθετοι Πόροι

Το AutoGen Magnetic One — Ένα γενικό σύστημα πολλαπλών πρακτόρων για την επίλυση σύνθετων εργασιών που έχει επιτύχει εντυπωσιακά αποτελέσματα σε πολλαπλά απαιτητικά benchmarks πρακτόρων. Αναφορά: <a href="https://github.com/microsoft/autogen/tree/main/python/packages/autogen-magentic-one" target="_blank">autogen-magentic-one</a>. Σε αυτήν την υλοποίηση ο ορχηστρωτής δημιουργεί σχέδιο συγκεκριμένο για τις εργασίες και αναθέτει αυτές τις εργασίες στους διαθέσιμους πράκτορες. Εκτός από τον προγραμματισμό, ο ορχηστρωτής χρησιμοποιεί επίσης έναν μηχανισμό παρακολούθησης για να ελέγχει την πρόοδο της εργασίας και να αναπρογραμματίζει όπως απαιτείται.

### Έχετε Περισσότερες Ερωτήσεις σχετικά με το Πρότυπο Σχεδιασμού Προγραμματισμού;

Ενταχθείτε στο [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord) για να συναντήσετε άλλους μαθητές, να παρακολουθήσετε ώρες γραφείου και να λάβετε απαντήσεις στις ερωτήσεις σας σχετικά με τους Πράκτορες ΤΝ.

## Προηγούμενο Μάθημα

[Κατασκευή Αξιόπιστων Πρακτόρων ΤΝ](../06-building-trustworthy-agents/README.md)

## Επόμενο Μάθημα

[Πρότυπο Σχεδιασμού Πολλαπλών Πρακτόρων](../08-multi-agent/README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**Αποποίηση ευθυνών**:  
Αυτό το έγγραφο έχει μεταφραστεί χρησιμοποιώντας την υπηρεσία μετάφρασης AI [Co-op Translator](https://github.com/Azure/co-op-translator). Ενώ καταβάλλουμε προσπάθεια για ακρίβεια, παρακαλώ να γνωρίζετε ότι οι αυτόματες μεταφράσεις ενδέχεται να περιέχουν λάθη ή ανακρίβειες. Το πρωτότυπο έγγραφο στη γλώσσα του αποτελεί την αυθεντική πηγή. Για κρίσιμες πληροφορίες, προτείνεται επαγγελματική μετάφραση από άνθρωπο. Δεν φέρουμε ευθύνη για τυχόν παρεξηγήσεις ή λανθασμένες ερμηνείες που προκύπτουν από τη χρήση αυτής της μετάφρασης.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->