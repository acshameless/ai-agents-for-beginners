[![Agentic RAG](../../../translated_images/ru/lesson-5-thumbnail.20ba9d0c0ae64fae.webp)](https://youtu.be/WcjAARvdL7I?si=BCgwjwFb2yCkEhR9)

> _(Нажмите на изображение выше, чтобы посмотреть видео этого урока)_

# Agentic RAG

Этот урок предоставляет всесторонний обзор Agentic Retrieval-Augmented Generation (Agentic RAG) — новой парадигмы в области ИИ, где большие языковые модели (LLM) автономно планируют свои следующие шаги, одновременно извлекая информацию из внешних источников. В отличие от статичных схем «извлечение-потом-чтение», Agentic RAG включает итеративные вызовы LLM, прерываемые вызовами инструментов или функций и структурированными выводами. Система оценивает результаты, уточняет запросы, при необходимости вызывает дополнительные инструменты и продолжает этот цикл до достижения удовлетворительного решения.

## Введение

Этот урок охватывает

- **Понимание Agentic RAG:** Узнайте о новой парадигме в ИИ, где большие языковые модели (LLM) автономно планируют свои следующие шаги, одновременно извлекая информацию из внешних источников данных.
- **Освоение итеративного стиля «Maker-Checker»:** Поймите цикл итеративных вызовов LLM, прерываемых вызовами инструментов или функций и структурированными выводами, направленный на повышение корректности и обработку некорректно сформулированных запросов.
- **Изучение практических применений:** Определите сценарии, в которых Agentic RAG демонстрирует свои преимущества, такие как среды с приоритетом корректности, сложные взаимодействия с базами данных и длительные рабочие процессы.

## Цели обучения

После завершения этого урока вы будете знать/понимать:

- **Понимание Agentic RAG:** Узнайте о новой парадигме в ИИ, где большие языковые модели (LLM) автономно планируют свои следующие шаги, одновременно извлекая информацию из внешних источников данных.
- **Итеративный стиль Maker-Checker:** Освойте концепцию цикла итеративных вызовов LLM, прерываемых вызовами инструментов или функций и структурированными выводами, направленного на повышение корректности и обработку некорректно сформулированных запросов.
- **Контроль процесса рассуждений:** Поймите способность системы владеть своим процессом рассуждений, принимая решения о подходе к задачам без опоры на заранее определённые пути.
- **Рабочий процесс:** Поймите, как агентная модель самостоятельно принимает решение извлечь отчёты о рыночных тенденциях, выявить данные о конкурентах, скоррелировать внутренние показатели продаж, синтезировать выводы и оценить стратегию.
- **Итеративные циклы, интеграция инструментов и память:** Узнайте о зависимости системы от циклического паттерна взаимодействия, поддерживающего состояние и память между шагами, чтобы избежать повторяющихся петель и принимать обоснованные решения.
- **Обработка ошибок и самокоррекция:** Изучите надёжные механизмы самокоррекции системы, включая итерации и повторные запросы, использование диагностических инструментов и обращение к человеческому контролю.
- **Границы агентности:** Поймите ограничения Agentic RAG, сосредоточенные на доменно-специфической автономии, зависимости от инфраструктуры и соблюдении защитных мер.
- **Практические случаи и ценность:** Определите сценарии, в которых Agentic RAG особенно полезен — например, среды с приоритетом корректности, сложные взаимодействия с базами данных и длительные рабочие процессы.
- **Управление, прозрачность и доверие:** Узнайте о важности управления и прозрачности, включая объяснимые рассуждения, контроль смещения и человеческий надзор.

## Что такое Agentic RAG?

Agentic Retrieval-Augmented Generation (Agentic RAG) — это новая парадигма в разработке ИИ, где большие языковые модели (LLM) не только извлекают информацию из внешних источников данных, но и автономно планируют свои следующие шаги. В отличие от статичных схем «извлечение-потом-чтение» или тщательно продуманных последовательностей подсказок, Agentic RAG включает цикл итеративных вызовов LLM, прерываемых вызовами инструментов или функций и структурированными выводами. На каждом шаге система оценивает полученные результаты, решает, нужно ли уточнить запросы, при необходимости вызывает дополнительные инструменты и продолжает этот цикл, пока не достигнет удовлетворительного решения.

Этот итеративный стиль работы «maker-checker» разработан для повышения корректности, обработки некорректно сформулированных запросов к структурированным базам данных (например, NL2SQL) и обеспечения сбалансированных, высококачественных результатов. Вместо того чтобы полагаться исключительно на тщательно продуманные цепочки подсказок, система активно владеет своим процессом рассуждений. Она может переписывать запросы, которые не сработали, выбирать другие методы извлечения и интегрировать несколько инструментов — таких как векторный поиск в Azure AI Search, SQL-базы данных или пользовательские API — прежде чем окончательно сформировать ответ. Это устраняет необходимость в чрезмерно сложных фреймворках оркестрации. Вместо этого относительно простой цикл «вызов LLM → использование инструмента → вызов LLM → …» может привести к сложным и хорошо обоснованным выводам.

![Agentic RAG Core Loop](../../../translated_images/ru/agentic-rag-core-loop.c8f4b85c26920f71.webp)

## Владение процессом рассуждений

Отличительной чертой, делающей систему «агентной», является её способность владеть процессом рассуждений. Традиционные реализации RAG часто зависят от того, что люди заранее определяют путь для модели: цепочку размышлений, указывающую, что и когда извлекать.
Но когда система по-настоящему агентная, она внутренне решает, как подойти к проблеме. Она не просто выполняет сценарий; она автономно определяет последовательность шагов на основе качества найденной информации.
Например, если её просят создать стратегию запуска продукта, она не полагается исключительно на подсказку, которая описывает весь процесс исследования и принятия решений. Вместо этого агентная модель самостоятельно принимает решение:

1. Получить отчёты о текущих рыночных тенденциях с помощью Bing Web Grounding
2. Выявить релевантные данные о конкурентах с помощью Azure AI Search.
3.	Скоррелировать исторические внутренние метрики продаж с использованием Azure SQL Database.
4.	Синтезировать выводы в цельную стратегию, скоординированную через Azure OpenAI Service.
5.	Оценить стратегию на предмет пробелов или несоответствий, при необходимости инициировав ещё один раунд извлечения.
Все эти шаги — уточнение запросов, выбор источников, итерация до «удовлетворения» ответом — принимаются моделью, а не заранее прописываются человеком.

## Итеративные циклы, интеграция инструментов и память

![Tool Integration Architecture](../../../translated_images/ru/tool-integration.0f569710b5c17c10.webp)

Агентная система опирается на циклический паттерн взаимодействия:

- **Первоначальный вызов:** Цель пользователя (т.е. запрос пользователя) представляется LLM.
- **Вызов инструмента:** Если модель обнаруживает отсутствующую информацию или неоднозначные инструкции, она выбирает инструмент или метод извлечения — например, запрос к векторной базе данных (например, гибридный поиск Azure AI Search по приватным данным) или структурированный SQL-вызов — чтобы собрать больше контекста.
- **Оценка и уточнение:** После изучения возвращённых данных модель решает, достаточна ли информация. Если нет, она уточняет запрос, пробует другой инструмент или изменяет подход.
- **Повторять до удовлетворения:** Этот цикл продолжается до тех пор, пока модель не определит, что у неё достаточно ясности и доказательств для предоставления окончательного, хорошо обоснованного ответа.
- **Память и состояние:** Поскольку система сохраняет состояние и память между шагами, она может вспоминать предыдущие попытки и их результаты, избегая повторяющихся циклов и принимая более информированные решения по мере продвижения.

Со временем это создаёт ощущение эволюции понимания, позволяя модели справляться со сложными многоэтапными задачами без необходимости постоянного вмешательства человека или перестройки подсказки.

## Обработка режимов отказа и самокоррекция

Автономность Agentic RAG также включает надёжные механизмы самокоррекции. Когда система сталкивается с тупиками — например, извлекает нерелевантные документы или встречает некорректно сформулированные запросы — она может:

- **Итерировать и повторно запрашивать:** Вместо возврата малоценного ответа модель пытается новые стратегии поиска, переписывает запросы к базе данных или обращается к альтернативным наборам данных.
- **Использовать диагностические инструменты:** Система может вызвать дополнительные функции, предназначенные для отладки её шагов рассуждений или подтверждения корректности извлечённых данных. Инструменты, такие как Azure AI Tracing, будут важны для обеспечения надёжной наблюдаемости и мониторинга.
- **Обратиться к человеческому надзору:** Для задач с высоким риском или при повторных неудачах модель может пометить неопределённость и запросить руководство человека. После того как человек предоставит корректирующую обратную связь, модель может учесть этот урок в дальнейшем.

Этот итеративный и динамичный подход позволяет модели постоянно совершенствоваться, гарантируя, что она не является одноразовой системой, а учится на своих ошибках в рамках текущей сессии.

![Self Correction Mechanism](../../../translated_images/ru/self-correction.da87f3783b7f174b.webp)

## Границы агентности

Несмотря на автономию внутри задачи, Agentic RAG не является аналогом искусственного общего интеллекта. Её «агентные» возможности ограничены инструментами, источниками данных и политиками, предоставленными разработчиками-человеками. Она не может изобретать собственные инструменты или выходить за пределы установленных доменных границ. Вместо этого она эффективно оркестрирует доступные ресурсы.
Ключевые отличия от более продвинутых форм ИИ включают:

1. **Доменно-специфическая автономия:** Системы Agentic RAG ориентированы на достижение целей, определённых пользователем, в известной доменной области, применяя стратегии, такие как переписывание запросов или выбор инструментов для улучшения результатов.
2. **Зависимость от инфраструктуры:** Возможности системы зависят от инструментов и данных, интегрированных разработчиками. Она не может превзойти эти границы без вмешательства человека.
3. **Соблюдение защитных мер:** Этические руководящие принципы, правила соответствия и бизнес-политики остаются крайне важными. Свобода агента всегда ограничена мерами безопасности и механизмами надзора (надеюсь?)

## Практические случаи и ценность

Agentic RAG особенно полезен в сценариях, требующих итеративного уточнения и точности:

1. **Окружения с приоритетом корректности:** В проверках соответствия, регуляторном анализе или юридических исследованиях агентная модель может многократно проверять факты, консультироваться с несколькими источниками и переписывать запросы, пока не получит тщательно проверенный ответ.
2. **Сложные взаимодействия с базами данных:** При работе со структурированными данными, где запросы часто могут падать или требовать корректировки, система может автономно уточнять свои запросы с использованием Azure SQL или Microsoft Fabric OneLake, обеспечивая соответствие конечного извлечения намерению пользователя.
3. **Длительные рабочие процессы:** Долгие сессии могут развиваться по мере появления новой информации. Agentic RAG может непрерывно включать новые данные, меняя стратегии по мере того, как он узнаёт больше о предметной области.

## Управление, прозрачность и доверие

По мере того как эти системы становятся более автономными в своих рассуждениях, управление и прозрачность имеют решающее значение:

- **Объяснимые рассуждения:** Модель может предоставить аудит-трейл запросов, которые она сделала, источников, к которым обращалась, и шагов рассуждений, которые она предприняла для достижения вывода. Инструменты, такие как Azure AI Content Safety и Azure AI Tracing / GenAIOps, могут помочь поддерживать прозрачность и снижать риски.
- **Контроль смещения и сбалансированное извлечение:** Разработчики могут настраивать стратегии извлечения, чтобы обеспечить учёт сбалансированных и репрезентативных источников данных, а также регулярно проверять выходы на предмет смещения или искажённых паттернов с помощью пользовательских моделей для продвинутых аналитических команд, использующих Azure Machine Learning.
- **Человеческий надзор и соответствие:** Для чувствительных задач человеческая проверка остаётся необходимой. Agentic RAG не заменяет человеческое суждение в задачах с высоким риском — он дополняет его, предоставляя более тщательно проверенные варианты.

Наличие инструментов, предоставляющих чёткий отчёт о действиях, имеет жизненно важное значение. Без них отладка многоэтапного процесса может быть очень сложной. См. следующий пример от Literal AI (компания за Chainlit) для запуска агента:

![AgentRunExample](../../../translated_images/ru/AgentRunExample.471a94bc40cbdc0c.webp)

## Заключение

Agentic RAG представляет собой естественную эволюцию того, как системы ИИ справляются со сложными задачами, требующими интенсивной работы с данными. Применяя циклический паттерн взаимодействия, автономно выбирая инструменты и уточняя запросы до получения высококачественного результата, система выходит за рамки статического следования подсказкам и становится более адаптивным, контекстно-осведомлённым принимающим решения. Хотя она по-прежнему ограничена инфраструктурой и этическими руководствами, заданными человеком, эти агентные возможности обеспечивают более насыщенные, динамичные и в конечном счёте более полезные взаимодействия с ИИ как для предприятий, так и для конечных пользователей.

### Есть ещё вопросы об Agentic RAG?

Присоединяйтесь к [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord), чтобы встретиться с другими учащимися, посетить часы консультаций и получить ответы на ваши вопросы по AI Agents.

## Дополнительные ресурсы
- <a href="https://learn.microsoft.com/training/modules/use-own-data-azure-openai" target="_blank">Реализация Retrieval Augmented Generation (RAG) с Azure OpenAI Service: узнайте, как использовать собственные данные с Azure OpenAI Service. Этот модуль Microsoft Learn предоставляет всестороннее руководство по реализации RAG</a>
- <a href="https://learn.microsoft.com/azure/ai-studio/concepts/evaluation-approach-gen-ai" target="_blank">Оценка приложений генеративного ИИ с Microsoft Foundry: в этой статье рассматривается оценка и сравнение моделей на общедоступных наборах данных, включая агентные приложения ИИ и архитектуры RAG</a>
- <a href="https://weaviate.io/blog/what-is-agentic-rag" target="_blank">Что такое Agentic RAG | Weaviate</a>
- <a href="https://ragaboutit.com/agentic-rag-a-complete-guide-to-agent-based-retrieval-augmented-generation/" target="_blank">Agentic RAG: Полное руководство по агентно-ориентированной Retrieval Augmented Generation – News from generation RAG</a>
- <a href="https://huggingface.co/learn/cookbook/agent_rag" target="_blank">Agentic RAG: ускорьте свой RAG с помощью реформулирования запросов и self-query! Руководство Hugging Face по ИИ с открытым исходным кодом</a>
- <a href="https://youtu.be/aQ4yQXeB1Ss?si=2HUqBzHoeB5tR04U" target="_blank">Добавление агентных слоёв в RAG</a>
- <a href="https://www.youtube.com/watch?v=zeAyuLc_f3Q&t=244s" target="_blank">Будущее ассистентов знаний: Джерри Лю</a>
- <a href="https://www.youtube.com/watch?v=AOSjiXP1jmQ" target="_blank">Как построить агентные RAG-системы</a>
- <a href="https://ignite.microsoft.com/sessions/BRK102?source=sessions" target="_blank">Использование Microsoft Foundry Agent Service для масштабирования ваших агентов ИИ</a>

### Академические статьи

- <a href="https://arxiv.org/abs/2303.17651" target="_blank">2303.17651 Self-Refine: Итеративное уточнение с самообратной связью</a>
- <a href="https://arxiv.org/abs/2303.11366" target="_blank">2303.11366 Reflexion: языковые агенты с обучением с вербальным подкреплением</a>
- <a href="https://arxiv.org/abs/2305.11738" target="_blank">2305.11738 CRITIC: большие языковые модели могут самоисправляться с помощью интерактивной критики с использованием инструментов</a>
- <a href="https://arxiv.org/abs/2501.09136" target="_blank">2501.09136 Agentic Retrieval-Augmented Generation: Обзор Agentic RAG</a>

## Предыдущий урок

[Паттерн использования инструментов](../04-tool-use/README.md)

## Следующий урок

[Построение надежных агентов ИИ](../06-building-trustworthy-agents/README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
Отказ от ответственности:
Этот документ был переведен с помощью сервиса машинного перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Хотя мы стремимся к точности, имейте в виду, что автоматические переводы могут содержать ошибки или неточности. Оригинальный документ на его исходном языке следует считать авторитетным источником. Для критически важной информации рекомендуется профессиональный перевод, выполненный человеком. Мы не несем ответственности за какие-либо недопонимания или неправильные толкования, возникшие в результате использования этого перевода.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->