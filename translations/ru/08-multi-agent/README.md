[![Многоагентное проектирование](../../../translated_images/ru/lesson-8-thumbnail.278a3e4a59137d62.webp)](https://youtu.be/V6HpE9hZEx0?si=A7K44uMCqgvLQVCa)

> _(Нажмите на изображение выше, чтобы посмотреть видео этого урока)_

# Шаблоны проектирования многоагентных систем

Как только вы начинаете работать над проектом, который включает несколько агентов, вам нужно будет рассмотреть шаблон проектирования многоагентных систем. Однако может быть не сразу ясно, когда переходить к многоагентной архитектуре и в чем заключаются преимущества.

## Введение

В этом уроке мы постараемся ответить на следующие вопросы:

- В каких сценариях применимы многоагентные системы?
- Каковы преимущества использования многоагентов по сравнению с одним агентом, выполняющим несколько задач?
- Какие строительные блоки необходимы для реализации шаблона многоагентного проектирования?
- Как обеспечить видимость того, как несколько агентов взаимодействуют друг с другом?

## Цели обучения

После этого урока вы должны уметь:

- Определять сценарии, в которых применимы многоагентные системы
- Осознавать преимущества использования многоагентов по сравнению с одним агентом
- Понимать строительные блоки реализации шаблона многоагентного проектирования

Какова общая картина?

*Многоагентные системы — это шаблон проектирования, который позволяет нескольким агентам работать вместе для достижения общей цели*.

Этот шаблон широко используется в различных областях, включая робототехнику, автономные системы и распределённые вычисления.

## Сценарии, в которых применимы многоагентные системы

Итак, в каких сценариях использование многоагентной системы будет хорошим решением? Ответ в том, что существует много сценариев, где применение нескольких агентов выгодно, особенно в следующих случаях:

- **Большие нагрузки**: Большие объёмы работы можно разделить на более мелкие задачи и поручить разным агентам, что позволяет выполнять их параллельно и быстрее завершать работу. Примером может служить задача обработки большого объёма данных.
- **Сложные задачи**: Сложные задачи, как и большие нагрузки, можно разбить на более мелкие подзадачи и поручить их разным агентам, каждый из которых специализируется на определённом аспекте задачи. Хорошим примером являются автономные транспортные средства, где разные агенты управляют навигацией, обнаружением препятствий и связью с другими транспортными средствами.
- **Разнообразная экспертиза**: Разные агенты могут обладать различной экспертизой, что позволяет им более эффективно справляться с разными аспектами задачи, чем один агент. Для этого случая хорошим примером является здравоохранение, где агенты могут заниматься диагностикой, планами лечения и мониторингом пациентов.

## Преимущества использования многоагентов по сравнению с одиночным агентом

Система с одним агентом может хорошо работать для простых задач, но для более сложных задач использование нескольких агентов может дать несколько преимуществ:

- **Специализация**: Каждый агент может быть специализован для конкретной задачи. Отсутствие специализации у одного агента означает, что у вас есть агент, который умеет делать всё, но может запутаться при сложной задаче. Он, например, может в итоге выполнять задачу, для которой не является наилучшим выбором.
- **Масштабируемость**: Системы легче масштабировать, добавляя больше агентов, а не перегружая одного агента.
- **Отказоустойчивость**: Если один агент выходит из строя, другие могут продолжать функционировать, обеспечивая надёжность системы.

Возьмём пример: забронируем поездку для пользователя. Система с одним агентом должна была бы обрабатывать все аспекты процесса бронирования поездки — от поиска рейсов до бронирования отелей и аренды автомобилей. Для этого одному агенту понадобились бы инструменты для выполнения всех этих задач. Это могло бы привести к сложной и монолитной системе, которую трудно поддерживать и масштабировать. Многоагентная система, с другой стороны, может иметь разных агентов, специализирующихся на поиске рейсов, бронировании отелей и аренде автомобилей. Это сделает систему более модульной, проще в обслуживании и масштабируемой.

Сравните это с туристическим бюро, управляемым семейным магазином, и туристическим бюро, работающим по франшизе. В семейном магазине один агент будет заниматься всеми аспектами бронирования, тогда как во франшизе разные агенты будут отвечать за разные аспекты процесса бронирования.

## Строительные блоки реализации шаблона многоагентного проектирования

Прежде чем реализовывать шаблон многоагентного проектирования, вам нужно понять строительные блоки, из которых он состоит.

Сделаем это более конкретным, снова рассмотрев пример бронирования поездки для пользователя. В этом случае строительные блоки будут включать:

- **Коммуникация между агентами**: Агенты, занимающиеся поиском рейсов, бронированием отелей и арендой автомобилей, должны общаться и делиться информацией о предпочтениях и ограничениях пользователя. Вам нужно определить протоколы и методы этой коммуникации. Что это означает на практике: агент, занимающийся поиском рейсов, должен общаться с агентом по бронированию отелей, чтобы убедиться, что отель забронирован на те же даты, что и рейс. Это означает, что агенты должны обмениваться информацией о датах поездки пользователя, то есть вам нужно решить *какие агенты обмениваются информацией и как они это делают*.
- **Механизмы координации**: Агенты должны координировать свои действия, чтобы учесть предпочтения и ограничения пользователя. Например, предпочтением пользователя может быть отель рядом с аэропортом, тогда как ограничением может быть то, что аренда автомобилей возможна только в аэропорту. Это значит, что агент по бронированию отелей должен координироваться с агентом по аренде автомобилей, чтобы удовлетворить предпочтения и ограничения пользователя. Это означает, что вам нужно решить *как агенты координируют свои действия*.
- **Архитектура агентов**: Агенты должны иметь внутреннюю структуру для принятия решений и обучения на основе взаимодействий с пользователем. Это означает, что агент по поиску рейсов должен иметь внутреннюю структуру для принятия решений о том, какие рейсы рекомендовать пользователю. Это означает, что вам нужно решить *как агенты принимают решения и учатся на взаимодействиях с пользователем*. Примеры того, как агент учится и совершенствуется: агент по поиску рейсов может использовать модель машинного обучения для рекомендации рейсов пользователю на основе его прошлых предпочтений.
- **Видимость взаимодействий многоагентной системы**: Вам нужна видимость того, как несколько агентов взаимодействуют друг с другом. Это означает, что вам нужны инструменты и методы для отслеживания активности и взаимодействий агентов. Это может быть реализовано в виде инструментов логирования и мониторинга, инструментов визуализации и метрик производительности.
- **Шаблоны многоагентных систем**: Существуют разные шаблоны для реализации многоагентных систем, такие как централизованные, децентрализованные и гибридные архитектуры. Вам нужно выбрать шаблон, который лучше всего подходит для вашего случая использования.
- **Человек в петле**: В большинстве случаев у вас будет человек в петле, и вам нужно указать агентам, когда запрашивать человеческое вмешательство. Это может быть, например, когда пользователь просит конкретный отель или рейс, который агенты не рекомендовали, или просит подтверждение перед бронированием рейса или отеля.

## Видимость взаимодействий многоагентной системы

Важно обеспечить видимость того, как несколько агентов взаимодействуют друг с другом. Эта видимость необходима для отладки, оптимизации и обеспечения общей эффективности системы. Для этого вам понадобятся инструменты и методы для отслеживания активности и взаимодействий агентов. Это может быть реализовано в виде инструментов логирования и мониторинга, инструментов визуализации и метрик производительности.

Например, в случае бронирования поездки для пользователя вы можете создать панель управления, показывающую статус каждого агента, предпочтения и ограничения пользователя, а также взаимодействия между агентами. Эта панель может отображать даты поездки пользователя, рейсы, рекомендованные агентом по рейсам, отели, рекомендованные агентом по отелям, и автомобили, рекомендованные агентом по аренде. Это даст вам ясное представление о том, как агенты взаимодействуют друг с другом и удовлетворяются ли предпочтения и ограничения пользователя.

Рассмотрим каждый из этих аспектов подробнее.

- **Инструменты логирования и мониторинга**: Вы должны вести логирование каждого действия, выполняемого агентом. Запись лога может содержать информацию об агенте, совершившем действие, самом действии, времени его выполнения и результате. Эти данные затем можно использовать для отладки, оптимизации и прочего.
- **Инструменты визуализации**: Инструменты визуализации помогают интуитивно видеть взаимодействия между агентами. Например, можно создать граф, показывающий поток информации между агентами. Это может помочь выявить узкие места, неэффективность и другие проблемы в системе.
- **Метрики производительности**: Метрики производительности помогут отслеживать эффективность многоагентной системы. Например, можно отслеживать время, затраченное на выполнение задачи, количество задач, выполненных за единицу времени, и точность рекомендаций, сделанных агентами. Эта информация поможет выявить области для улучшения и оптимизировать систему.

## Шаблоны многоагентных систем

Рассмотрим некоторые конкретные шаблоны, которые можно использовать для создания многоагентных приложений. Вот несколько интересных шаблонов, которые стоит рассмотреть:

### Групповой чат

Этот шаблон полезен, когда вы хотите создать приложение группового чата, где несколько агентов могут общаться друг с другом. Типичные случаи использования включают командное сотрудничество, поддержку клиентов и социальные сети.

В этом шаблоне каждый агент представляет пользователя в групповом чате, и сообщения обмениваются между агентами с использованием протокола обмена сообщениями. Агенты могут отправлять сообщения в групповой чат, получать сообщения из чата и отвечать на сообщения других агентов.

Этот шаблон можно реализовать с использованием централизованной архитектуры, где все сообщения маршрутизируются через центральный сервер, или децентрализованной архитектуры, где сообщения обмениваются напрямую.

![Групповой чат](../../../translated_images/ru/multi-agent-group-chat.ec10f4cde556babd.webp)

### Передача задач

Этот шаблон полезен, когда вы хотите создать приложение, в котором несколько агентов могут передавать задачи друг другу.

Типичные случаи использования включают поддержку клиентов, управление задачами и автоматизацию рабочих процессов.

В этом шаблоне каждый агент представляет задачу или шаг в рабочем процессе, и агенты могут передавать задачи другим агентам на основе заранее определённых правил.

![Передача задач](../../../translated_images/ru/multi-agent-hand-off.4c5fb00ba6f8750a.webp)

### Коллаборативная фильтрация

Этот шаблон полезен, когда вы хотите создать приложение, в котором несколько агентов могут сотрудничать для составления рекомендаций для пользователей.

Почему вы захотите, чтобы несколько агентов сотрудничали — потому что каждый агент может обладать разной экспертизой и вносить вклад в процесс рекомендаций по-разному.

Рассмотрим пример, где пользователь хочет получить рекомендацию по лучшей акции для покупки на фондовом рынке.

- **Эксперт отрасли**:. Один агент может быть экспертом в конкретной отрасли.
- **Технический анализ**: Другой агент может быть экспертом по техническому анализу.
- **Фундаментальный анализ**: И ещё один агент может быть экспертом по фундаментальному анализу. Сотрудничая, эти агенты могут предоставить пользователю более всестороннюю рекомендацию.

![Рекомендации](../../../translated_images/ru/multi-agent-filtering.d959cb129dc9f608.webp)

## Сценарий: процесс возврата средств

Рассмотрим сценарий, в котором клиент пытается получить возврат за товар — в этом процессе может участвовать довольно много агентов, но давайте разделим их на агентов, специфичных для этого процесса, и общих агентов, которые можно использовать в других процессах.

**Агенты, специфичные для процесса возврата**:

Ниже перечислены некоторые агенты, которые могут участвовать в процессе возврата:

- **Агент клиента**: Этот агент представляет клиента и отвечает за инициирование процесса возврата.
- **Агент продавца**: Этот агент представляет продавца и отвечает за обработку возврата.
- **Платежный агент**: Этот агент отвечает за возврат средств клиенту.
- **Агент урегулирования**: Этот агент отвечает за разрешение любых проблем, возникших в процессе возврата.
- **Агент соответствия**: Этот агент отвечает за обеспечение соответствия процесса возврата нормативам и правилам.

**Общие агенты**:

Эти агенты можно использовать в других частях вашего бизнеса.

- **Агент доставки**: Этот агент представляет процесс доставки и отвечает за возврат товара продавцу. Этот агент можно использовать как для процесса возврата, так и для общей доставки товара при покупке, например.
- **Агент обратной связи**: Этот агент отвечает за сбор отзывов от клиента. Отзывы могут собираться в любое время, а не только в процессе возврата.
- **Агент эскалации**: Этот агент отвечает за эскалацию проблем на более высокий уровень поддержки. Вы можете использовать такого агента для любого процесса, где требуется эскалация проблемы.
- **Агент уведомлений**: Этот агент отвечает за отправку уведомлений клиенту на различных этапах процесса возврата.
- **Агент аналитики**: Этот агент отвечает за анализ данных, связанных с процессом возврата.
- **Агент аудита**: Этот агент отвечает за аудит процесса возврата, чтобы убедиться, что он проводится корректно.
- **Агент отчётности**: Этот агент отвечает за формирование отчётов по процессу возврата.
- **Агент знаний**: Этот агент отвечает за поддержку базы знаний с информацией, связанной с процессом возврата. Этот агент может иметь знания как по возвратам, так и по другим частям вашего бизнеса.
- **Агент безопасности**: Этот агент отвечает за обеспечение безопасности процесса возврата.
- **Агент качества**: Этот агент отвечает за обеспечение качества процесса возврата.

Ранее было перечислено довольно много агентов, как для конкретного процесса возврата, так и для общих агентов, которые можно использовать в других частях вашего бизнеса. Надеюсь, это даёт вам представление о том, как можно принять решение о том, каких агентов использовать в вашей многоагентной системе.

## Задание

Спроектируйте многоагентную систему для процесса поддержки клиентов. Определите агентов, участвующих в процессе, их роли и обязанности, а также то, как они взаимодействуют друг с другом. Учтите как агентов, специфичных для процесса поддержки клиентов, так и общих агентов, которые можно использовать в других частях вашего бизнеса.
> Подумайте, прежде чем читать следующее решение, возможно, вам понадобится больше агентов, чем вы думаете.
> 
> СОВЕТ: Подумайте о разных этапах процесса поддержки клиентов и также учтите агентов, необходимых для любой системы.

## Решение

[Решение](./solution/solution.md)

## Проверка знаний

Question: Когда следует рассматривать использование нескольких агентов?

- [ ] A1: Когда у вас небольшая нагрузка и простая задача.
- [ ] A2: Когда у вас большая нагрузка
- [ ] A3: Когда у вас простая задача.

[Тест решения](./solution/solution-quiz.md)

## Резюме

В этом уроке мы рассмотрели шаблон проектирования с несколькими агентами, включая сценарии, в которых применимы мульти-агенты, преимущества использования нескольких агентов по сравнению с одним агентом, основные компоненты реализации шаблона мульти-агентов и способы получения видимости того, как несколько агентов взаимодействуют друг с другом.

### Есть дополнительные вопросы о шаблоне проектирования с несколькими агентами?

Присоединяйтесь к [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord), чтобы встретиться с другими обучающимися, посетить часы консультаций и получить ответы на вопросы по агентам ИИ.

## Дополнительные ресурсы

- <a href="https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html" target="_blank">Шаблоны проектирования AutoGen</a>
- <a href="https://www.analyticsvidhya.com/blog/2024/10/agentic-design-patterns/" target="_blank">Шаблоны агентного проектирования</a>


## Предыдущий урок

[Планирование дизайна](../07-planning-design/README.md)

## Следующий урок

[Метакогниция в агентах ИИ](../09-metacognition/README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**Отказ от ответственности**:
Данный документ был переведен с помощью сервиса перевода на базе ИИ [Co-op Translator](https://github.com/Azure/co-op-translator). Хотя мы стремимся к точности, просим учитывать, что автоматизированные переводы могут содержать ошибки или неточности. Оригинальный документ на его исходном языке следует считать авторитетным источником. Для критически важной информации рекомендуется обратиться к профессиональному переводчику-человеку. Мы не несем ответственности за любые недоразумения или неправильные толкования, возникшие в результате использования этого перевода.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->