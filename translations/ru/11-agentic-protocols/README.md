# Использование агентных протоколов (MCP, A2A и NLWeb)

[![Agentic Protocols](../../../translated_images/ru/lesson-11-thumbnail.b6c742949cf1ce2a.webp)](https://youtu.be/X-Dh9R3Opn8)

> _(Нажмите на изображение выше, чтобы посмотреть видео этого урока)_

С ростом использования AI-агентов увеличивается и потребность в протоколах, обеспечивающих стандартизацию, безопасность и поддержку открытых инноваций. В этом уроке мы рассмотрим 3 протокола, призванных удовлетворить эту потребность — Model Context Protocol (MCP), Agent to Agent (A2A) и Natural Language Web (NLWeb).

## Введение

В этом уроке мы рассмотрим:

• Как **MCP** позволяет AI-агентам получать доступ к внешним инструментам и данным для выполнения задач пользователя.

• Как **A2A** обеспечивает коммуникацию и сотрудничество между разными AI-агентами.

• Как **NLWeb** приносит интерфейсы на основе естественного языка на любой веб-сайт, позволяя AI-агентам обнаруживать и взаимодействовать с содержимым.

## Цели обучения

• **Определить** основное назначение и преимущества MCP, A2A и NLWeb в контексте AI-агентов.

• **Объяснить**, как каждый протокол способствует коммуникации и взаимодействию между LLM, инструментами и другими агентами.

• **Распознать** уникальные роли каждого протокола в построении сложных агентных систем.

## Протокол контекста модели (MCP)

**Model Context Protocol (MCP)** — открытый стандарт, предоставляющий стандартизированный способ для приложений обеспечивать контекст и инструменты для LLM. Это позволяет использовать «универсальный адаптер» к различным источникам данных и инструментам, к которым AI-агенты могут подключаться единообразным способом.

Рассмотрим компоненты MCP, преимущества по сравнению с прямым использованием API, а также пример того, как AI-агенты могут использовать MCP сервер.

### Основные компоненты MCP

MCP работает на основе **клиент-серверной архитектуры**, а его основные компоненты:

• **Хосты** — приложения LLM (например, редактор кода VSCode), которые инициируют соединения с MCP сервером.

• **Клиенты** — компоненты в приложении-хосте, поддерживающие однонаправленные соединения с серверами.

• **Серверы** — легковесные программы, предоставляющие определённые возможности.

В протоколе предусмотрены три основных примитива, которые являются возможностями MCP сервера:

• **Инструменты (Tools)**: Это отдельные действия или функции, которые AI-агент может вызвать для выполнения операции. Например, сервис погоды может предоставить инструмент «get weather» («получить погоду»), а сервер электронной коммерции — «purchase product» («купить продукт»). MCP серверы публикуют имя каждого инструмента, описание и схему входных/выходных данных в списке возможностей.

• **Ресурсы (Resources)**: Это данные только для чтения или документы, которые MCP сервер может предоставить, и клиенты могут получать их по запросу. Примеры включают содержимое файлов, записи баз данных или файлы журналов. Ресурсы могут быть текстовыми (код или JSON) или бинарными (изображения или PDF).

• **Подсказки (Prompts)**: Предопределённые шаблоны, предлагающие рекомендуемые подсказки, поддерживая более сложные рабочие процессы.

### Преимущества MCP

MCP предлагает значительные преимущества для AI-агентов:

• **Динамическое обнаружение инструментов**: Агенты могут динамически получать список доступных инструментов с сервера вместе с описаниями того, что они делают. В отличие от традиционных API, для интеграций которых часто требуется статическое кодирование, где любое изменение API требует обновления кода, MCP предлагает «интегрируй один раз», обеспечивая большую адаптивность.

• **Совместимость между LLM**: MCP работает с разными LLM, предоставляя гибкость для смены основных моделей с целью повышения производительности.

• **Стандартизированная безопасность**: MCP включает стандартный метод аутентификации, упрощающий масштабирование при добавлении доступа к дополнительным MCP серверам. Это проще, чем управление разными ключами и типами аутентификации для различных традиционных API.

### Пример MCP

![MCP Diagram](../../../translated_images/ru/mcp-diagram.e4ca1cbd551444a1.webp)

Представьте, что пользователь хочет забронировать авиабилет с помощью AI-ассистента на базе MCP.

1. **Соединение**: AI-ассистент (клиент MCP) подключается к MCP серверу, предоставленному авиакомпанией.

2. **Обнаружение инструментов**: Клиент спрашивает MCP сервер авиакомпании: «Какие инструменты у тебя есть?» Сервер отвечает инструментами, такими как «поиск рейсов» и «бронирование рейса».

3. **Вызов инструмента**: Вы просите AI-ассистента: «Пожалуйста, найди рейс из Портленда в Гонолулу». Ассистент, используя LLM, определяет, что нужно вызвать инструмент «search flights», и передаёт соответствующие параметры (отправление, пункт назначения) на MCP сервер.

4. **Выполнение и ответ**: MCP сервер, выступая в роли обёртки, делает фактический вызов внутреннего API бронирования авиакомпании, получает информацию о рейсе (например, данные в JSON) и отправляет её обратно AI-ассистенту.

5. **Дальнейшее взаимодействие**: AI-ассистент показывает варианты рейсов. Когда вы выбираете рейс, ассистент может вызвать инструмент «book flight» на том же MCP сервере, завершив бронирование.

## Протокол агент-агент (A2A)

В то время как MCP сосредоточен на подключении LLM к инструментам, **протокол Agent-to-Agent (A2A)** делает шаг вперёд, обеспечивая коммуникацию и сотрудничество между разными AI-агентами. A2A соединяет AI-агентов из разных организаций, сред и технологий для выполнения общей задачи.

Мы рассмотрим компоненты и преимущества A2A, а также пример применения в нашем приложении для путешествий.

### Основные компоненты A2A

A2A ориентирован на обеспечение коммуникации между агентами и их совместную работу по выполнению подзадач пользователя. Каждый компонент протокола способствует этому:

#### Карточка Агента (Agent Card)

Как MCP сервер делится списком инструментов, так и Карточка Агента содержит:
- Имя агента.
- **Описание общих задач**, которые он выполняет.
- **Список конкретных навыков** с описаниями, помогающими другим агентам (и даже людям) понять, когда и почему стоит обратиться к этому агенту.
- **Текущий URL конечной точки (Endpoint)** агента.
- **Версию** и **возможности** агента, такие как потоковые ответы и push-уведомления.

#### Исполнитель Агента (Agent Executor)

Исполнитель агента отвечает за **передачу контекста пользовательского чата удалённому агенту**, который нуждается в этом, чтобы понять задачу. В A2A сервере агент использует собственную Большую Языковую Модель (LLM) для разбора входящих запросов и выполнения задач с помощью внутренних инструментов.

#### Артефакт (Artifact)

После того как удалённый агент выполнил задачу, результат создаётся как артефакт. Артефакт **содержит результат работы агента**, **описание выполненного действия** и **текстовый контекст**, который передаётся по протоколу. После отправки артефакта соединение с удалённым агентом закрывается до нового запроса.

#### Очередь Событий (Event Queue)

Этот компонент используется для **обработки обновлений и передачи сообщений**. Он особенно важен в продакшене агентных систем, чтобы не допустить закрытие соединений между агентами до завершения задачи, особенно если выполнение занимает продолжительное время.

### Преимущества A2A

• **Улучшенное сотрудничество**: Обеспечивает взаимодействие агентов различных поставщиков и платформ, позволяет им делиться контекстом и работать вместе, создавая бесшовную автоматизацию между традиционно разобщёнными системами.

• **Гибкость выбора модели**: Каждый агент A2A сам решает, какую LLM использовать для обслуживания запросов, позволяя оптимизировать или настраивать модели для каждого агента, в отличие от единого LLM-подключения в некоторых сценариях MCP.

• **Встроенная аутентификация**: Аутентификация интегрирована напрямую в протокол A2A, обеспечивая надёжную систему безопасности взаимодействия агентов.

### Пример A2A

![A2A Diagram](../../../translated_images/ru/A2A-Diagram.8666928d648acc26.webp)

Расширим сценарий бронирования путешествия, но теперь используя A2A.

1. **Запрос пользователя к мультиагенту**: Пользователь взаимодействует с агентом-клиентом A2A «Туристический агент», например, говоря: «Пожалуйста, забронируй поездку в Гонолулу на следующую неделю, включая рейсы, отель и арендованную машину».

2. **Оркестрация Туристическим агентом**: Туристический агент получает сложный запрос. Он использует свою LLM, чтобы разобраться с задачей и понять, что нужно взаимодействовать с другими специализированными агентами.

3. **Взаимодействие между агентами**: Туристический агент подключается по протоколу A2A к агентам-подрядчикам, таким как «Агент авиакомпании», «Агент отеля» и «Агент аренды автомобиля», созданным разными компаниями.

4. **Делегирование задач**: Туристический агент передаёт конкретные задачи этим агентам (например, «Найти рейсы в Гонолулу», «Забронировать отель», «Арендовать машину»). Каждый из специализированных агентов, с собственной LLM и собственными инструментами (которые сами могут быть MCP серверами), выполняет свой этап бронирования.

5. **Объединённый ответ**: Когда все агенты завершают задачи, Туристический агент собирает результаты (детали рейсов, подтверждение отеля, бронирование автомобиля) и отправляет пользователю подробный ответ в стиле чата.

## Natural Language Web (NLWeb)

Веб-сайты долгое время были основным способом для пользователей получать информацию и данные через интернет.

Рассмотрим различные компоненты NLWeb, его преимущества и пример работы нашего приложения для путешествий на базе NLWeb.

### Компоненты NLWeb

- **Приложение NLWeb (основной сервисный код)**: Система, обрабатывающая вопросы на естественном языке. Она связывает разные части платформы для создания ответов. Можно считать её **движком, обеспечивающим функции на естественном языке** для сайта.

- **Протокол NLWeb**: Это **базовый набор правил для взаимодействия на естественном языке** с сайтом. Он возвращает ответы в формате JSON (часто используя Schema.org). Его задача — создать простую основу для «AI Web», подобно тому, как HTML сделал возможным обмен документами онлайн.

- **MCP сервер (конечная точка Model Context Protocol)**: Каждая установка NLWeb также работает как **MCP сервер**. Это означает, что она может **делиться инструментами (например, методом “ask”) и данными** с другими AI-системами. На практике это делает содержимое и возможности сайта доступными для AI-агентов, позволяя сайту стать частью более широкой «экосистемы агентов».

- **Модели эмбеддингов**: Эти модели используются для **преобразования содержимого сайта в числовые представления — векторы (эмбеддинги)**. Эти векторы захватывают смысл в форме, сравнимой и пригодной для поиска компьютером. Они сохраняются в специальной базе данных, и пользователи могут выбирать, какую модель эмбеддингов использовать.

- **Векторная база данных (механизм поиска)**: Эта база данных **хранит эмбеддинги содержимого сайта**. Когда кто-то задаёт вопрос, NLWeb проверяет эту базу, чтобы быстро найти наиболее релевантную информацию. Она выдаёт список возможных ответов, отсортированных по степени сходства. NLWeb работает с разными системами хранения векторов, такими как Qdrant, Snowflake, Milvus, Azure AI Search и Elasticsearch.

### NLWeb на примере

![NLWeb](../../../translated_images/ru/nlweb-diagram.c1e2390b310e5fe4.webp)

Рассмотрим снова наш сайт для бронирования путешествий, но теперь он работает на NLWeb.

1. **Загрузка данных**: Существующие каталоги продуктов (например, списки рейсов, описания отелей, туры) форматируются с использованием Schema.org или загружаются через RSS-ленты. Инструменты NLWeb поглощают эти структурированные данные, создают эмбеддинги и сохраняют их в локальной или удалённой векторной базе данных.

2. **Запрос на естественном языке (человек)**: Пользователь посещает сайт и вместо навигации по меню вводит в интерфейс чата: «Найдите для меня семейный отель в Гонолулу с бассейном на следующую неделю».

3. **Обработка NLWeb**: Приложение NLWeb получает этот запрос. Оно отправляет запрос в LLM для понимания и одновременно ищет в своей векторной базе данные, относящиеся к отелям.

4. **Точные результаты**: LLM помогает интерпретировать результаты поиска в базе данных, выбирает лучшие совпадения по критериям «семейный», «бассейн» и «Гонолулу», а затем формирует ответ на естественном языке. Важно, что ответ ссылается на реальные отели из каталога сайта, избегая выдуманной информации.

5. **Взаимодействие AI-агента**: Поскольку NLWeb служит MCP сервером, внешний AI-агент для путешествий может подключиться к этому экземпляру NLWeb сайта. Затем AI-агент может использовать метод `ask` протокола MCP, чтобы напрямую задать сайту вопрос: `ask("Есть ли в районе Гонолулу веганские рестораны, рекомендованные отелем?")`. Экземпляр NLWeb обработает запрос, используя базу данных информации о ресторанах (если она загружена), и вернёт структурированный JSON-ответ.

### Есть ли у вас ещё вопросы по MCP/A2A/NLWeb?

Присоединяйтесь к [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord), чтобы общаться с другими учащимися, посещать офисные часы и получать ответы на свои вопросы по AI-агентам.

## Ресурсы

- [MCP для начинающих](https://aka.ms/mcp-for-beginners)  
- [Документация MCP](https://github.com/microsoft/semantic-kernel/tree/main/python/semantic-kernel/semantic_kernel/connectors/mcp)
- [Репозиторий NLWeb](https://github.com/nlweb-ai/NLWeb)
- [Руководства по Semantic Kernel](https://learn.microsoft.com/semantic-kernel/)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**Отказ от ответственности**:  
Этот документ был переведён с помощью автоматического сервиса перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Несмотря на наши усилия обеспечить точность, имейте в виду, что автоматические переводы могут содержать ошибки или неточности. Оригинальный документ на исходном языке следует считать авторитетным источником. Для получения критически важной информации рекомендуется воспользоваться услугами профессионального переводчика. Мы не несем ответственности за любые недоразумения или искажения смысла, возникшие в результате использования данного перевода.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->