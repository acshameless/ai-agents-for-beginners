# Память для AI Агентов  
[![Agent Memory](../../../translated_images/ru/lesson-13-thumbnail.959e3bc52d210c64.webp)](https://youtu.be/QrYbHesIxpw?si=qNYW6PL3fb3lTPMk)

При обсуждении уникальных преимуществ создания AI Агентов, главным образом рассматриваются две вещи: возможность вызывать инструменты для выполнения задач и способность улучшаться со временем. Память лежит в основе создания самоулучшающегося агента, который может создавать лучшие впечатления для наших пользователей.

В этом уроке мы рассмотрим, что такое память для AI Агентов и как мы можем управлять ею и использовать её на благо наших приложений.

## Введение

В этом уроке будут рассмотрены следующие темы:

• **Понимание памяти AI агента**: Что такое память и почему она важна для агентов.

• **Реализация и хранение памяти**: Практические методы добавления возможностей памяти вашим AI агентам, с акцентом на краткосрочную и долгосрочную память.

• **Создание самоулучшающихся AI агентов**: Как память позволяет агентам учиться на прошлых взаимодействиях и улучшаться со временем.

## Доступные реализации

В урок включены два подробных ноутбука с учебными материалами:

• **[13-agent-memory.ipynb](./13-agent-memory.ipynb)**: Реализует память с использованием Mem0 и Azure AI Search с фреймворком Semantic Kernel

• **[13-agent-memory-cognee.ipynb](./13-agent-memory-cognee.ipynb)**: Реализует структурированную память с помощью Cognee, автоматически строя граф знаний на основе эмбеддингов, визуализируя граф и обеспечивая интеллектуальный поиск

## Цели обучения

После изучения этого урока вы будете знать, как:

• **Различать различные типы памяти AI агента**, включая рабочую, краткосрочную и долгосрочную память, а также специализированные формы, такие как персональная и эпизодическая память.

• **Реализовывать и управлять краткосрочной и долгосрочной памятью для AI агентов** с использованием фреймворка Semantic Kernel, используя инструменты, такие как Mem0, Cognee, Whiteboard memory и интеграцию с Azure AI Search.

• **Понимать принципы работы самоулучшающихся AI агентов** и то, как надежные системы управления памятью способствуют непрерывному обучению и адаптации.

## Понимание памяти AI агента

В своей основе **память для AI агентов — это механизмы, которые позволяют им сохранять и вспоминать информацию**. Эта информация может содержать конкретные детали о разговоре, предпочтения пользователя, прошлые действия или даже выявленные закономерности.

Без памяти AI приложения часто являются безсостоянием, что означает, что каждое взаимодействие начинается с нуля. Это приводит к повторяющемуся и раздражающему пользовательскому опыту, когда агент "забывает" предыдущий контекст или предпочтения.

### Почему память важна?

Интеллект агента тесно связан с его способностью вспоминать и использовать прошлую информацию. Память позволяет агентам быть:

• **Рефлексивными**: Учиться на прошлых действиях и результатах.

• **Интерактивными**: Поддерживать контекст в ходе текущего диалога.

• **Проактивными и реактивными**: Предугадывать потребности или адекватно реагировать, основываясь на исторических данных.

• **Автономными**: Работать более независимо, опираясь на накопленные знания.

Цель реализации памяти — сделать агентов более **надежными и способными**.

### Типы памяти

#### Рабочая память

Подумайте об этом как о листе для заметок, который агент использует во время одной продолжающейся задачи или процесса размышления. Она содержит немедленную информацию, необходимую для вычисления следующего шага.

Для AI агентов рабочая память часто захватывает наиболее релевантную информацию из разговора, даже если весь чат длинный или усечен. Она сосредоточена на выделении ключевых элементов, таких как требования, предложения, решения и действия.

**Пример рабочей памяти**

В агенте по бронированию путешествий рабочая память может сохранять текущий запрос пользователя, например "Я хочу забронировать поездку в Париж". Это конкретное требование удерживается в непосредственном контексте агента для управления текущим взаимодействием.

#### Краткосрочная память

Этот тип памяти сохраняет информацию в течение одной беседы или сессии. Она является контекстом текущего чата, позволяя агенту ссылаться на предыдущие реплики в диалоге.

**Пример краткосрочной памяти**

Если пользователь спросил: "Сколько стоит билет на рейс в Париж?" и затем добавил: "А как насчет проживания там?", краткосрочная память обеспечивает, что агент понимает, что "там" относится к "Парижу" в рамках одного разговора.

#### Долгосрочная память

Это информация, которая сохраняется между разными разговорами или сессиями. Она позволяет агентам помнить предпочтения пользователя, исторические взаимодействия или общие знания на протяжении длительного времени. Это важно для персонализации.

**Пример долгосрочной памяти**

Долгосрочная память может содержать сведения о том, что "Бен любит кататься на лыжах и заниматься активным отдыхом, предпочитает кофе с видом на горы и избегает сложных лыжных трасс из-за предыдущей травмы". Эта информация, полученная из предыдущих взаимодействий, влияет на рекомендации в будущих сессиях планирования путешествий, делая их более персонализированными.

#### Персональная память

Этот специализированный тип памяти помогает агенту развить последовательную "личность" или "персону". Она позволяет агенту запоминать детали о себе или своей роли, делая взаимодействия более плавными и сфокусированными.

**Пример персональной памяти**

Если туристический агент спроектирован как "эксперт по лыжному отдыху", персональная память может усиливать эту роль, влияя на ответы агента, чтобы они соответствовали тону и знаниям эксперта.

#### Рабочая/эпизодическая память

Эта память хранит последовательность шагов, которые агент предпринимает во время сложной задачи, включая успехи и неудачи. Это похоже на запоминание конкретных "эпизодов" или прошлых опытов для обучения на них.

**Пример эпизодической памяти**

Если агент пытался забронировать конкретный рейс, но это не получилось из-за отсутствия мест, эпизодическая память может зафиксировать эту неудачу, позволяя агенту попытаться с другими рейсами или информировать пользователя об этой проблеме более осознанно при последующей попытке.

#### Память сущностей

Это включает в себя извлечение и запоминание конкретных сущностей (например, людей, мест или предметов) и событий из разговоров. Это позволяет агенту построить структурированное понимание ключевых обсуждаемых элементов.

**Пример памяти сущностей**

Из разговора о прошлой поездке агент может выделить "Париж", "Эйфелева башня" и "ужин в ресторане Le Chat Noir" как сущности. В будущем агент сможет вспомнить "Le Chat Noir" и предложить сделать там новый заказ.

#### Структурированный RAG (Retrieval Augmented Generation)

Хотя RAG — это более широкая техника, "Структурированный RAG" выделяется как мощная технология памяти. Она извлекает плотную, структурированную информацию из различных источников (разговоров, писем, изображений) и использует её для повышения точности, полноты и скорости ответов. В отличие от классического RAG, который опирается только на семантическое сходство, Структурированный RAG работает с внутренней структурой информации.

**Пример структурированного RAG**

Вместо простого поиска по ключевым словам Структурированный RAG может распознать детали рейса (пункт назначения, дату, время, авиакомпанию) из электронного письма и сохранить их в структурированном виде. Это позволяет задавать точные запросы, например, "Какой рейс я забронировал в Париж во вторник?"

## Реализация и хранение памяти

Реализация памяти для AI агентов включает систематический процесс **управления памятью**, который охватывает генерацию, хранение, извлечение, интеграцию, обновление и даже "забывание" (или удаление) информации. Особенно важна функция извлечения.

### Специализированные инструменты памяти

#### Mem0

Один из способов хранить и управлять памятью агента — использование специализированных инструментов, таких как Mem0. Mem0 работает как слой постоянной памяти, позволяющий агентам вспоминать релевантные взаимодействия, хранить предпочтения пользователей и фактический контекст, а также учиться на успехах и ошибках со временем. Идея в том, что безсостоячные агенты превращаются в состоянтные.

Он работает через **двухфазный процесс памяти: извлечение и обновление**. Сначала сообщения, добавленные в поток агента, отправляются в сервис Mem0, который использует большую языковую модель (LLM) для обобщения истории разговора и извлечения новых воспоминаний. Затем фаза обновления на основе LLM определяет, следует ли добавить, изменить или удалить эти воспоминания, сохраняя их в гибридном хранилище данных, которое может включать в себя векторные, графовые и ключ-значение базы данных. Эта система поддерживает разные типы памяти и может включать графовую память для управления отношениями между сущностями.

#### Cognee

Другой мощный подход — использование **Cognee**, открытой семантической памяти для AI агентов, которая преобразует структурированные и неструктурированные данные в запросные графы знаний на базе эмбеддингов. Cognee предоставляет **двойную архитектуру хранения**, объединяющую поиск похожих векторов с графовыми связями, позволяя агентам понимать не только то, какая информация похожа, но и как понятия связаны друг с другом.

Cognee отлично справляется с **гибридным поиском**, который сочетает векторное сходство, структуру графа и рассуждения LLM — от поиска по сырьям до ответов с учётом графа. Система поддерживает **живую память**, которая развивается и растет, оставаясь доступной для запросов как единый связный граф, обеспечивая как краткосрочный контекст сессии, так и долгосрочную постоянную память.

Учебник в ноутбуке Cognee ([13-agent-memory-cognee.ipynb](./13-agent-memory-cognee.ipynb)) демонстрирует создание этого единого слоя памяти с практическими примерами загрузки различных источников данных, визуализации графа знаний и запросов с различными стратегиями поиска, адаптированными к конкретным потребностям агента.

### Хранение памяти с RAG

Помимо специализированных инструментов памяти, таких как Mem0, можно использовать мощные поисковые сервисы, например, **Azure AI Search в качестве бэкенда для хранения и извлечения воспоминаний**, особенно для структурированного RAG.

Это позволяет привязывать ответы агента к вашим собственным данным, обеспечивая более релевантные и точные ответы. Azure AI Search можно использовать для хранения пользовательских воспоминаний о поездках, каталогов продуктов или иной специфической области знаний.

Azure AI Search поддерживает возможности, такие как **Структурированный RAG**, который превосходно извлекает и возвращает плотную, структурированную информацию из больших наборов данных, например, из истории разговоров, писем или даже изображений. Это обеспечивает "сверхчеловеческую точность и полноту" по сравнению с традиционными подходами на основе текстовых фрагментов и эмбеддингов.

## Создание самоулучшающихся AI агентов

Распространенный шаблон для самоулучшающихся агентов включает введение **"агента знаний"**. Этот отдельный агент наблюдает за основным разговором между пользователем и основным агентом. Его роль заключается в следующем:

1. **Определять ценную информацию**: Выяснять, стоит ли часть разговора сохранить как общие знания или конкретные предпочтения пользователя.

2. **Извлекать и суммировать**: Вычленять существенное обучение или предпочтение из разговора.

3. **Хранить в базе знаний**: Сохранять извлечённую информацию, часто в векторной базе данных, чтобы можно было извлечь позже.

4. **Дополнять будущие запросы**: Когда пользователь начинает новый запрос, агент знаний извлекает релевантную сохранённую информацию и добавляет её в запрос пользователя, обеспечивая важный контекст для основного агента (похоже на RAG).

### Оптимизации для памяти

• **Управление задержками**: Чтобы не замедлять взаимодействие с пользователем, изначально можно использовать более дешевую, быструю модель, которая быстро проверит, стоит ли сохранять или извлекать информацию, вызывая более сложный процесс извлечения/поиска только при необходимости.

• **Обслуживание базы знаний**: Для растущей базы знаний реже используемую информацию можно переместить в "холодное хранилище" для управления затратами.

## Есть ещё вопросы о памяти агента?

Присоединяйтесь к [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord), чтобы встретиться с другими обучающимися, посетить часы приёма и получить ответы на ваши вопросы об AI агентах.

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**Отказ от ответственности**:  
Этот документ был переведен с помощью автоматического переводческого сервиса [Co-op Translator](https://github.com/Azure/co-op-translator). Несмотря на наши усилия обеспечить точность, имейте в виду, что автоматические переводы могут содержать ошибки или неточности. Оригинальный документ на исходном языке следует считать авторитетным источником. Для критически важной информации рекомендуется воспользоваться профессиональным человеческим переводом. Мы не несем ответственности за любые недоразумения или неправильные толкования, возникшие в результате использования данного перевода.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->