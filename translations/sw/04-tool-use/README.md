[![Jinsi ya Kubuni Maajenti Bora wa AI](../../../translated_images/sw/lesson-4-thumbnail.546162853cb3daff.webp)](https://youtu.be/vieRiPRx-gI?si=cEZ8ApnT6Sus9rhn)

> _(Bonyeza picha hapo juu kutazama video ya somo hili)_

# Mtindo wa Ubunifu wa Matumizi ya Zana

Zana ni za kuvutia kwa sababu zinawawezesha maajenti wa AI kuwa na uwezo mpana zaidi wa kufanya mambo. Badala ya maajenti kuwa na seti ndogo ya vitendo wanaweza kufanya, kwa kuongeza zana, maajenti sasa wanaweza kufanya vitendo vingi zaidi. Katika sura hii, tutaangalia Mtindo wa Ubunifu wa Matumizi ya Zana, unaoelezea jinsi maajenti wa AI wanavyoweza kutumia zana maalum kufanikisha malengo yao.

## Utangulizi

Katika somo hili, tunatafuta kujibu maswali yafuatayo:

- Mtindo wa ubunifu wa matumizi ya zana ni nini?
- Usanifu wa matumizi ya zana unaweza kutumika kwa nini?
- Ni vipengele/vinara gani vinavyohitajika kutekeleza mtindo wa ubunifu?
- Ni mambo gani maalum yanayopaswa kuzingatiwa wakati wa kutumia Mtindo wa Ubunifu wa Matumizi ya Zana kujenga maajenti wa AI wa kuaminika?

## Malengo ya Kujifunza

Baada ya kumaliza somo hili, utaweza:

- Kufafanua Mtindo wa Ubunifu wa Matumizi ya Zana na kusudi lake.
- Kutambua matumizi ambapo Mtindo wa Ubunifu wa Matumizi ya Zana unaweza kutumika.
- Kuelewa vipengele muhimu vinavyohitajika kutekeleza mtindo wa ubunifu.
- Kutambua mambo ya kuzingatia kuhakikisha uaminifu wa maajenti wa AI wanaotumia mtindo huu wa ubunifu.

## Mtindo wa Ubunifu wa Matumizi ya Zana ni Nini?

**Mtindo wa Ubunifu wa Matumizi ya Zana** unazingatia kutoa uwezo kwa LLMs kuingiliana na zana za nje kufanikisha malengo maalum. Zana ni msimbo unaoweza kutekelezwa na ajenti kufanya vitendo. Zana inaweza kuwa kazi rahisi kama kalkuleta, au mwito wa API kwa huduma ya mtu wa tatu kama kutafuta bei ya hisa au hali ya hewa. Katika muktadha wa maajenti wa AI, zana zimeundwa kutekelezwa na maajenti kama jibu kwa **miito ya kazi inayotokana na mfano**.

## Usanifu wa Matumizi ya Zana Unaweza Kutumika Kwa Nini?

Maajenti wa AI wanaweza kutumia zana kukamilisha kazi ngumu, kupata taarifa, au kufanya maamuzi. Mtindo wa matumizi ya zana mara nyingi hutumika katika hali zinazohitaji mwingiliano wa nguvu na mifumo ya nje, kama vile hifadhidata, huduma za wavuti, au wakalimishaji wa msimbo. Uwezo huu ni muhimu kwa matumizi mbalimbali ikiwemo:

- **Kupata Taarifa za Muda Halisi:** Maajenti wanaweza kuuliza API za nje au hifadhidata kupata data za kisasa (mfano, kuuliza hifadhidata ya SQLite kwa uchambuzi wa data, kupata bei za hisa au taarifa za hali ya hewa).
- **Utekelezaji na Ufasiri wa Msimbo:** Maajenti wanaweza kutekeleza msimbo au script kutatua matatizo ya kihisabati, kutoa ripoti, au kufanya maonyesho.
- **Uendeshaji wa Kazi Moja kwa Moja:** Kuendesha kazi rudufu au zenye hatua nyingi kwa kuunganisha zana kama ratiba za kazi, huduma za barua pepe, au mifereji ya data.
- **Msaada kwa Wateja:** Maajenti wanaweza kuingiliana na mifumo ya CRM, majukwaa ya tiketi, au hifadhidata za maarifa kutatua maswali ya watumiaji.
- **Uundaji na Uhariri wa Yaliyomo:** Maajenti wanaweza kutumia zana kama wakaguzi wa sarufi, waifupishaji wa maandishi, au wakaguzi wa usalama wa yaliyomo kusaidia kazi za uundaji.

## Ni Vipengele/Vinara Vipi Vinavyohitajika Kutekeleza Mtindo wa Utumiaji wa Zana?

Vinara hivi vinawawezesha maajenti wa AI kufanya kazi nyingi. Tuchunguze vipengele muhimu vya kutekeleza Mtindo wa Ubunifu wa Matumizi ya Zana:

- **Miundo ya Kazi/Zana**: Maelezo ya kina ya zana zinazopatikana, pamoja na jina la kazi, kusudi, vigezo vinavyohitajika, na matokeo yanayotarajiwa. Miundo hii husaidia LLM kuelewa zana zilizopo na jinsi ya kuunda maombi halali.

- **Mantiki ya Utekelezaji wa Kazi**: Huidhibiti jinsi na lini zana zinapoitwa kutokana na nia ya mtumiaji na muktadha wa mazungumzo. Hii inaweza kujumuisha moduli za upangaji, mbinu za utumaji, au mtiririko wa masharti unaobainisha matumizi ya zana kwa nguvu.

- **Mfumo wa Udhibiti wa Ujumbe**: Vipengele vinavyoendesha mtiririko wa mazungumzo kati ya ingizo za mtumiaji, majibu ya LLM, miito ya zana, na matokeo ya zana.

- **Muundo wa Uunganishaji wa Zana**: Miundombinu inayounganisha ajenti na zana mbalimbali, iwe ni kazi rahisi au huduma ngumu za nje.

- **Udhibiti wa Makosa na Uthibitishaji**: Mbinu za kushughulikia kushindwa kwa utekelezaji wa zana, kuthibitisha vigezo, na kusimamia majibu yasiyotegemewa.

- **Usimamizi wa Hali**: Kufuatilia muktadha wa mazungumzo, mwingiliano wa awali na zana, na data za kudumu ili kuhakikisha uthabiti katika mazungumzo yenye mizunguko mingi.

Ifuatayo, tutaangalia kwa undani zaidi Kuita Kazi/Zana.

### Kuita Kazi/Zana

Kuita kazi ni njia kuu tunavyowawezesha Miundo Mikubwa ya Lugha (LLMs) kuingiliana na zana. Mara nyingi utaona neno 'Kazi' na 'Zana' zikitumika kwa kubadilishana kwa sababu 'kazi' (vidokezo vya msimbo vinavyoweza kutumika tena) ni 'zana' ambazo maajenti hutumia kufanya kazi. Ili msimbo wa kazi kuitwa, LLM lazima iangalie ombi la mtumiaji dhidi ya maelezo ya kazi husika. Kwa kufanya hivi, muundo unaoelezea kazi zote zinazopatikana hutumwa kwa LLM. Kisha LLM huchagua kazi inayofaa zaidi kwa kazi husika na kurudisha jina la kazi na hoja zake. Kazi iliyochaguliwa huita, jibu lake hurudi kwa LLM, ambalo hutumia taarifa hiyo kujibu ombi la mtumiaji.

Kwa waendelezaji kutekeleza kaita kazi kwa maajenti, utahitaji:

1. Mfano wa LLM unaounga mkono kaita kazi
2. Mfumo unaoelezea kazi
3. Msimbo wa kila kazi iliyoelezwa

Tuchukue mfano wa kupata saa ya sasa jiji kupendelewa:

1. **anzisha LLM inayounga mkono kaita kazi:**

    Sio mifano yote inaunga mkono kaita kazi, hivyo ni muhimu kuangalia LLM unayotumia inaunga mkono. <a href="https://learn.microsoft.com/azure/ai-services/openai/how-to/function-calling" target="_blank">Azure OpenAI</a> inaunga mkono kaita kazi. Tunaweza kuanza kwa kuanzisha mteja wa Azure OpenAI.

    ```python
    # Anzisha mteja wa Azure OpenAI
    client = AzureOpenAI(
        azure_endpoint = os.getenv("AZURE_OPENAI_ENDPOINT"), 
        api_key=os.getenv("AZURE_OPENAI_API_KEY"),  
        api_version="2024-05-01-preview"
    )
    ```

1. **Unda Mfumo wa Kazi:**

    Ifuatayo tutaeleza mfumo wa JSON unaojumuisha jina la kazi, maelezo ya kile kazi hufanya, na majina na maelezo ya vigezo vya kazi.
    Kisha tutaptia mfumo huu mteja tuliyemuumba hapo awali, pamoja na ombi la mtumiaji kutafuta saa katika San Francisco. Muhimu ni kuzingatia kwamba **mwito wa zana** ndio unarejeshwa, **siyo** jibu la mwisho la swali. Kama tulivyosema awali, LLM hurudisha jina la kazi iliyochaguliwa na hoja zitakazotumwa.

    ```python
    # Maelezo ya kazi kwa mfano kusoma
    tools = [
        {
            "type": "function",
            "function": {
                "name": "get_current_time",
                "description": "Get the current time in a given location",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "location": {
                            "type": "string",
                            "description": "The city name, e.g. San Francisco",
                        },
                    },
                    "required": ["location"],
                },
            }
        }
    ]
    ```
   
    ```python
  
    # Ujumbe wa mwanzo wa mtumiaji
    messages = [{"role": "user", "content": "What's the current time in San Francisco"}] 
  
    # Mwito wa kwanza wa API: Muulize mfano kutumia kazi
      response = client.chat.completions.create(
          model=deployment_name,
          messages=messages,
          tools=tools,
          tool_choice="auto",
      )
  
      # Shughulikia jibu la mfano
      response_message = response.choices[0].message
      messages.append(response_message)
  
      print("Model's response:")  

      print(response_message)
  
    ```

    ```bash
    Model's response:
    ChatCompletionMessage(content=None, role='assistant', function_call=None, tool_calls=[ChatCompletionMessageToolCall(id='call_pOsKdUlqvdyttYB67MOj434b', function=Function(arguments='{"location":"San Francisco"}', name='get_current_time'), type='function')])
    ```
  
1. **Msimbo wa kazi unaohitajika kutekeleza kazi:**

    Sasa LLM imechagua ni kazi gani inapaswa kutekelezwa, msimbo wa kutekeleza kazi unahitaji kuandikishwa na kufanyika.
    Tunaweza kuandika msimbo wa kupata saa ya sasa kwa Python. Pia tutahitaji kuandika msimbo wa kutoa jina na hoja kutoka `response_message` ili kupata matokeo ya mwisho.

    ```python
      def get_current_time(location):
        """Get the current time for a given location"""
        print(f"get_current_time called with location: {location}")  
        location_lower = location.lower()
        
        for key, timezone in TIMEZONE_DATA.items():
            if key in location_lower:
                print(f"Timezone found for {key}")  
                current_time = datetime.now(ZoneInfo(timezone)).strftime("%I:%M %p")
                return json.dumps({
                    "location": location,
                    "current_time": current_time
                })
      
        print(f"No timezone data found for {location_lower}")  
        return json.dumps({"location": location, "current_time": "unknown"})
    ```

     ```python
     # Shughulikia wito za kazi
      if response_message.tool_calls:
          for tool_call in response_message.tool_calls:
              if tool_call.function.name == "get_current_time":
     
                  function_args = json.loads(tool_call.function.arguments)
     
                  time_response = get_current_time(
                      location=function_args.get("location")
                  )
     
                  messages.append({
                      "tool_call_id": tool_call.id,
                      "role": "tool",
                      "name": "get_current_time",
                      "content": time_response,
                  })
      else:
          print("No tool calls were made by the model.")  
  
      # Wito wa pili wa API: Pata jibu la mwisho kutoka kwa mfano
      final_response = client.chat.completions.create(
          model=deployment_name,
          messages=messages,
      )
  
      return final_response.choices[0].message.content
     ```

     ```bash
      get_current_time called with location: San Francisco
      Timezone found for san francisco
      The current time in San Francisco is 09:24 AM.
     ```

Kuita kazi ni kitu muhimu katika mtindo wa matumizi ya zana kwa maajenti wengi, lakini kutekeleza kutoka mwanzo inaweza kuwa changamoto wakati mwingine.
Kama tulivyojifunza katika [Somo la 2](../../../02-explore-agentic-frameworks) mifumo ya agentic hutupatia vinara vilivyotengenezwa tayari kutekeleza matumizi ya zana.

## Mifano ya Matumizi ya Zana kwa Mifumo ya Agentic

Hapa kuna mifano ya jinsi unavyoweza kutekeleza Mtindo wa Ubunifu wa Matumizi ya Zana kwa kutumia mifumo tofauti ya agentic:

### Semantic Kernel

<a href="https://learn.microsoft.com/azure/ai-services/agents/overview" target="_blank">Semantic Kernel</a> ni mfumo wa AI wa chanzo huria kwa watengenezaji wa .NET, Python, na Java wanaofanya kazi na Miundo Mikubwa ya Lugha (LLMs). Huirahisisha mchakato wa matumizi ya kaita kazi kwa kuelezea kiotomatiki kazi zako na vigezo vyake kwa mfano kupitia mchakato unaoitwa <a href="https://learn.microsoft.com/semantic-kernel/concepts/ai-services/chat-completion/function-calling/?pivots=programming-language-python#1-serializing-the-functions" target="_blank">serializing</a>. Pia hushughulikia mawasiliano ya mfululizo kati ya mfano na msimbo wako. Faida nyingine ya kutumia mfumo wa agentic kama Semantic Kernel ni kuwa unaruhusu kutumia zana zilizojengwa tayari kama <a href="https://github.com/microsoft/semantic-kernel/blob/main/python/samples/getting_started_with_agents/openai_assistant/step4_assistant_tool_file_search.py" target="_blank">Utafutaji Faili</a> na <a href="https://github.com/microsoft/semantic-kernel/blob/main/python/samples/getting_started_with_agents/openai_assistant/step3_assistant_tool_code_interpreter.py" target="_blank">Mfasiri wa Msimbo</a>.

Mchoro ufuatao unaonyesha mchakato wa kaita kazi na Semantic Kernel:

![function calling](../../../translated_images/sw/functioncalling-diagram.a84006fc287f6014.webp)

Katika Semantic Kernel, kazi/zana hujulikana kama <a href="https://learn.microsoft.com/semantic-kernel/concepts/plugins/?pivots=programming-language-python" target="_blank">Plugins</a>. Tunaweza kubadilisha kazi `get_current_time` tuliyoiona awali kuwa plugin kwa kuiweka kama darasa lenye kazi ndani. Pia tunaweza kuingiza `kernel_function` decorator, inayochukua maelezo ya kazi. Unapounda kernel na GetCurrentTimePlugin, kernel itaserializa kazi na vigezo vyake moja kwa moja, na kuunda mfumo wa kutuma kwa LLM.

```python
from semantic_kernel.functions import kernel_function

class GetCurrentTimePlugin:
    async def __init__(self, location):
        self.location = location

    @kernel_function(
        description="Get the current time for a given location"
    )
    def get_current_time(location: str = ""):
        ...

```

```python 
from semantic_kernel import Kernel

# Unda kernel
kernel = Kernel()

# Unda kiendelezi
get_current_time_plugin = GetCurrentTimePlugin(location)

# Ongeza kiendelezi kwenye kernel
kernel.add_plugin(get_current_time_plugin)
```
  
### Huduma ya Maajenti ya Azure AI

<a href="https://learn.microsoft.com/azure/ai-services/agents/overview" target="_blank">Huduma ya Maajenti ya Azure AI</a> ni mfumo mpya wa agentic ulioundwa kuwezesha waendelezaji kujenga, kupeleka, na kupanua maajenti wa AI wenye ubora wa juu na unaoweza kuongezwa kwa usalama bila haja ya kusimamia rasilimali za msingi za kompyuta na hifadhi. Ni maalum kwa matumizi ya biashara kwani ni huduma inayosimamiwa kikamilifu yenye usalama wa ngazi ya biashara.

Ukilinganisha na kuendeleza moja kwa moja kwa API ya LLM, Huduma ya Maajenti ya Azure AI inatoa faida zifuatazo:

- Kuita zana moja kwa moja – hakuna haja ya kuchambua mwito wa zana, kuitisha zana, na kushughulikia jibu; yote haya hufanyika upande wa seva sasa
- Data iliyosimamiwa kwa usalama – badala ya kusimamia hali ya mazungumzo mwenyewe, unaweza kutegemea ‘threads’ kuhifadhi taarifa zote unazohitaji
- Zana za kutumika moja kwa moja – Zana ambazo unaweza kutumia kuingiliana na vyanzo vyako vya data, kama Bing, Azure AI Search, na Azure Functions.

Zana zinazopatikana katika Huduma ya Maajenti ya Azure AI zinaweza kugawanywa katika makundi mawili:

1. Zana za Maarifa:
    - <a href="https://learn.microsoft.com/azure/ai-services/agents/how-to/tools/bing-grounding?tabs=python&pivots=overview" target="_blank">Kuweka Mwanga na Bing Search</a>
    - <a href="https://learn.microsoft.com/azure/ai-services/agents/how-to/tools/file-search?tabs=python&pivots=overview" target="_blank">Utafutaji Faili</a>
    - <a href="https://learn.microsoft.com/azure/ai-services/agents/how-to/tools/azure-ai-search?tabs=azurecli%2Cpython&pivots=overview-azure-ai-search" target="_blank">Azure AI Search</a>

2. Zana za Vitendo:
    - <a href="https://learn.microsoft.com/azure/ai-services/agents/how-to/tools/function-calling?tabs=python&pivots=overview" target="_blank">Kuita Kazi</a>
    - <a href="https://learn.microsoft.com/azure/ai-services/agents/how-to/tools/code-interpreter?tabs=python&pivots=overview" target="_blank">Mfasiri wa Msimbo</a>
    - <a href="https://learn.microsoft.com/azure/ai-services/agents/how-to/tools/openapi-spec?tabs=python&pivots=overview" target="_blank">Zana zilizoainishwa na OpenAPI</a>
    - <a href="https://learn.microsoft.com/azure/ai-services/agents/how-to/tools/azure-functions?pivots=overview" target="_blank">Azure Functions</a>

Huduma ya Maajenti hutuwezesha kutumia zana hizi pamoja kama `toolset`. Pia hutumia `threads` ambazo zinafuatilia historia ya ujumbe kutoka kwa mazungumzo fulani.

Fikiria uko ajenti wa mauzo katika kampuni inayoitwa Contoso. Unataka kuendeleza ajenti wa mazungumzo ambazo zinaweza kujibu maswali kuhusu data zako za mauzo.

Picha ifuatayo inaonyesha jinsi unavyoweza kutumia Huduma ya Maajenti ya Azure AI kuchambua data zako za mauzo:

![Agentic Service In Action](../../../translated_images/sw/agent-service-in-action.34fb465c9a84659e.webp)

Ili kutumia zana zozote hizi na huduma, tunaweza kuunda mteja na kufafanua zana au seti ya zana. Kutekeleza hili kikamilifu tunaweza kutumia msimbo wa Python ufuatao. LLM itakuwa na uwezo wa kuangalia seti ya zana na kuamua kama itatumia kazi iliyoundwa na mtumiaji, `fetch_sales_data_using_sqlite_query`, au Mfasiri wa Msimbo uliotengenezwa tayari kulingana na ombi la mtumiaji.

```python 
import os
from azure.ai.projects import AIProjectClient
from azure.identity import DefaultAzureCredential
from fetch_sales_data_functions import fetch_sales_data_using_sqlite_query # kipengele cha fetch_sales_data_using_sqlite_query ambacho kinaweza kupatikana katika faili la fetch_sales_data_functions.py.
from azure.ai.projects.models import ToolSet, FunctionTool, CodeInterpreterTool

project_client = AIProjectClient.from_connection_string(
    credential=DefaultAzureCredential(),
    conn_str=os.environ["PROJECT_CONNECTION_STRING"],
)

# Anzisha seti ya zana
toolset = ToolSet()

# Anzisha wakala wa kuita kazi kwa kipengele cha fetch_sales_data_using_sqlite_query na kuiongeza kwenye seti ya zana
fetch_data_function = FunctionTool(fetch_sales_data_using_sqlite_query)
toolset.add(fetch_data_function)

# Anzisha Zana ya Mfasiri wa Msimbo na kuiongeza kwenye seti ya zana.
code_interpreter = code_interpreter = CodeInterpreterTool()
toolset.add(code_interpreter)

agent = project_client.agents.create_agent(
    model="gpt-4o-mini", name="my-agent", instructions="You are helpful agent", 
    toolset=toolset
)
```

## Ni Mambo Gani Maalum Yanayopaswa Kuzingatiwa Wakati wa Kutumia Mtindo wa Ubunifu wa Matumizi ya Zana Kujenga Maajenti wa AI wa Kuaminika?

Shaka ya kawaida kuhusu SQL inayozalishwa na LLM kwa njia ya moja kwa moja ni usalama, hasa hatari ya sindikizo la SQL au vitendo vya uovu, kama kufuta au kubadilisha hifadhidata. Ingawa shaka hizi ni halali, zinaweza kupunguzwa kwa ufanisi kwa kuweka vibali sahihi vya ufikiaji wa hifadhidata. Kwa hifadhidata nyingi hili linahusisha kusanidi hifadhidata kuwa ya kusoma tu. Kwa huduma za hifadhidata kama PostgreSQL au Azure SQL, programu inapaswa kupatiwa jukumu la kusoma tu (SELECT).

Kuendesha programu katika mazingira salama huongeza ulinzi zaidi. Katika mazingira ya biashara, data mara nyingi hutolewa na kubadilishwa kutoka mifumo ya kiutendaji kwenda hifadhidata ya kusoma tu au ghala la data lenye muundo rafiki kwa mtumiaji. Njia hii huhakikisha data ni salama, imeboreshwa kwa utendaji na upatikanaji, na programu ina upatikanaji wa kusoma tu uliozuiliwa.

## Mifano ya Msimbo
- Python: [Agent Framework](./code_samples/04-python-agent-framework.ipynb)
- .NET: [Agent Framework](./code_samples/04-dotnet-agent-framework.md)

## Una Maswali Zaidi Kuhusu Matumizi ya Muundo wa Zana?

Jiunge na [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord) kukutana na wanaojifunza wengine, kuhudhuria saa za ofisi na kupata majibu ya maswali yako kuhusu Maajenti wa AI.

## Rasilimali za Ziada

- <a href="https://microsoft.github.io/build-your-first-agent-with-azure-ai-agent-service-workshop/" target="_blank">Warsha ya Huduma za Azure AI Agents</a>
- <a href="https://github.com/Azure-Samples/contoso-creative-writer/tree/main/docs/workshop" target="_blank">Warsha ya Maajenti Wengi wa Mwandishi Mbunifu wa Contoso</a>
- <a href="https://learn.microsoft.com/semantic-kernel/concepts/ai-services/chat-completion/function-calling/?pivots=programming-language-python#1-serializing-the-functions" target="_blank">Kozi ya Kuitwa kwa Kazi za Semantic Kernel</a>
- <a href="https://github.com/microsoft/semantic-kernel/blob/main/python/samples/getting_started_with_agents/openai_assistant/step3_assistant_tool_code_interpreter.py" target="_blank">Mfasiri wa Msimbo wa Semantic Kernel</a>
- <a href="https://microsoft.github.io/autogen/dev/user-guide/core-user-guide/components/tools.html" target="_blank">Zana za Autogen</a>

## Somo Lililopita

[Kuelewa Mifumo ya Ubunifu wa Maajenti](../03-agentic-design-patterns/README.md)

## Somo Linalofuata

[Agentic RAG](../05-agentic-rag/README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**Kiongozi wa Msamaha**:  
Hati hii imetafsiriwa kwa kutumia huduma ya utafsiri wa AI [Co-op Translator](https://github.com/Azure/co-op-translator). Wakati tunajitahidi kufikia usahihi, tafadhali fahamu kuwa tafsiri za moja kwa moja zinaweza kuwa na makosa au ukosefu wa usahihi. Hati ya asili katika lugha yake ya asili inapaswa kuzingatiwa kama chanzo cha mamlaka. Kwa taarifa muhimu, tafsiri ya kitaalamu na ya binadamu inapendekezwa. Hatuwajibiki kwa kutoelewana au tafsiri zisizo sahihi zinazotokana na matumizi ya tafsiri hii.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->