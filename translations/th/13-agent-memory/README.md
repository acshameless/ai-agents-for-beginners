# หน่วยความจำสำหรับเอเจนต์ AI  
[![Agent Memory](../../../translated_images/th/lesson-13-thumbnail.959e3bc52d210c64.webp)](https://youtu.be/QrYbHesIxpw?si=qNYW6PL3fb3lTPMk)

เมื่อพูดถึงประโยชน์เฉพาะของการสร้างเอเจนต์ AI สองสิ่งที่มักจะถูกพูดถึงคือ: ความสามารถในการเรียกใช้เครื่องมือเพื่อทำงานให้เสร็จ และความสามารถในการปรับปรุงตัวเองเมื่อเวลาผ่านไป หน่วยความจำถือเป็นรากฐานของการสร้างเอเจนต์ที่สามารถปรับปรุงตัวเองและสร้างประสบการณ์ที่ดียิ่งขึ้นสำหรับผู้ใช้ของเรา

ในบทเรียนนี้ เราจะมาดูว่า หน่วยความจำสำหรับเอเจนต์ AI คืออะไร และเราจะจัดการและใช้มันเพื่อประโยชน์ของแอปพลิเคชันของเราได้อย่างไร

## บทนำ

บทเรียนนี้จะครอบคลุม:

• **ทำความเข้าใจหน่วยความจำของเอเจนต์ AI**: ว่าหน่วยความจำคืออะไรและทำไมจึงมีความสำคัญต่อเอเจนต์

• **การใช้และการเก็บหน่วยความจำ**: วิธีการปฏิบัติในการเพิ่มความสามารถด้านหน่วยความจำให้กับเอเจนต์ AI ของคุณ โดยเน้นหน่วยความจำระยะสั้นและระยะยาว

• **ทำให้เอเจนต์ AI ปรับปรุงตัวเองได้**: วิธีที่หน่วยความจำช่วยให้เอเจนต์เรียนรู้จากการโต้ตอบในอดีตและปรับปรุงเมื่อเวลาผ่านไป

## การใช้งานที่มีให้

บทเรียนนี้ประกอบด้วยสมุดบันทึกสองชุดครบถ้วน:

• **[13-agent-memory.ipynb](./13-agent-memory.ipynb)**: นำหน่วยความจำมาใช้โดยใช้ Mem0 และ Azure AI Search กับ Semantic Kernel

• **[13-agent-memory-cognee.ipynb](./13-agent-memory-cognee.ipynb)**: นำหน่วยความจำแบบมีโครงสร้างมาใช้ด้วย Cognee ซึ่งสร้างกราฟความรู้โดยอัตโนมัติด้วย embeddings, แสดงภาพกราฟ และการดึงข้อมูลอย่างชาญฉลาด

## เป้าหมายการเรียนรู้

หลังจากทำบทเรียนนี้เสร็จ คุณจะสามารถ:

• **แยกแยะประเภทต่าง ๆ ของหน่วยความจำสำหรับเอเจนต์ AI** รวมถึงหน่วยความจำทำงาน หน่วยความจำระยะสั้น และหน่วยความจำระยะยาว รวมถึงรูปแบบเฉพาะเช่น persona และ episodic memory

• **เพิ่มและจัดการหน่วยความจำระยะสั้นและระยะยาวสำหรับเอเจนต์ AI** โดยใช้ Semantic Kernel และเครื่องมือต่าง ๆ เช่น Mem0, Cognee, Whiteboard memory รวมทั้งการรวมเข้ากับ Azure AI Search

• **เข้าใจหลักการเบื้องหลังเอเจนต์ AI ที่ปรับปรุงตัวเองได้** และวิธีที่ระบบจัดการหน่วยความจำที่แข็งแกร่งช่วยส่งเสริมการเรียนรู้และปรับตัวอย่างต่อเนื่อง

## การทำความเข้าใจหน่วยความจำของเอเจนต์ AI

โดยพื้นฐานแล้ว **หน่วยความจำสำหรับเอเจนต์ AI หมายถึงกลไกที่ช่วยให้พวกเขาสามารถเก็บรักษาและเรียกคืนข้อมูลได้** ข้อมูลนี้อาจเป็นรายละเอียดเฉพาะเจาะจงเกี่ยวกับบทสนทนา, ความชอบของผู้ใช้, การกระทำที่ผ่านมา หรือแม้แต่รูปแบบที่ได้เรียนรู้

ถ้าไม่มีหน่วยความจำ แอปพลิเคชัน AI มักจะไม่มีสถานะ (stateless) ซึ่งหมายความว่าการโต้ตอบแต่ละครั้งจะเริ่มต้นใหม่ทั้งหมด ส่งผลให้ประสบการณ์ผู้ใช้ซ้ำซากและน่าหงุดหงิด เพราะเอเจนต์ "ลืม" บริบทหรือความชอบก่อนหน้า

### ทำไมหน่วยความจำจึงสำคัญ?

ความฉลาดของเอเจนต์ผูกพันลึกกับความสามารถในการเรียกคืนและใช้งานข้อมูลที่ผ่านมา หน่วยความจำช่วยให้เอเจนต์สามารถ:

• **สะท้อนความคิด**: เรียนรู้จากการกระทำและผลลัพธ์ที่ผ่านมา

• **โต้ตอบได้**: รักษาบริบทของบทสนทนาที่ดำเนินอยู่

• **รุกล้ำและตอบสนอง**: คาดการณ์ความต้องการหรือตอบสนองอย่างเหมาะสมตามข้อมูลในอดีต

• **เป็นอิสระ**: ทำงานอย่างอิสระมากขึ้นโดยอ้างอิงจากความรู้ที่เก็บไว้

เป้าหมายของการใช้หน่วยความจำคือทำให้เอเจนต์ **น่าเชื่อถือและมีความสามารถมากขึ้น**

### ประเภทของหน่วยความจำ

#### หน่วยความจำทำงาน

นึกถึงหน่วยความจำทำงานเหมือนกระดาษลอกเลียนที่เอเจนต์ใช้ในระหว่างงานหรือกระบวนการคิดที่กำลังดำเนินอยู่ มันถือข้อมูลโดยตรงที่จำเป็นสำหรับคำนวณขั้นตอนถัดไป

สำหรับเอเจนต์ AI หน่วยความจำทำงานมักจะเก็บข้อมูลที่เกี่ยวข้องที่สุดจากบทสนทนา แม้ว่าประวัติการแชททั้งหมดจะยาวหรือถูกตัดทอนก็ตาม โดยจะเน้นดึงองค์ประกอบสำคัญ เช่น ความต้องการ ข้อเสนอ การตัดสินใจ และการดำเนินการ

**ตัวอย่างหน่วยความจำทำงาน**

ในเอเจนต์จองท่องเที่ยว หน่วยความจำทำงานอาจจับคำขอปัจจุบันของผู้ใช้ เช่น "ฉันต้องการจองทริปไปปารีส" ข้อความนี้จะถูกเก็บไว้ในบริบททันทีของเอเจนต์เพื่อแนะนำการโต้ตอบในขณะนั้น

#### หน่วยความจำระยะสั้น

หน่วยความจำประเภทนี้เก็บข้อมูลในช่วงเวลาของบทสนทนาหรือเซสชันเดียว มันคือบริบทของการแชทปัจจุบัน ช่วยให้เอเจนต์เรียกดูรอบก่อนหน้าของบทสนทนาได้

**ตัวอย่างหน่วยความจำระยะสั้น**

ถ้าผู้ใช้ถามว่า "เที่ยวบินไปปารีสราคาเท่าไหร่?" แล้วตามด้วย "ที่พักล่ะ?" หน่วยความจำระยะสั้นจะช่วยให้เอเจนต์เข้าใจว่า "ที่นั่น" หมายถึง "ปารีส" ในบทสนทนาเดียวกัน

#### หน่วยความจำระยะยาว

นี่คือข้อมูลที่คงอยู่ข้ามหลายบทสนทนาหรือเซสชัน ช่วยให้เอเจนต์จำความชอบของผู้ใช้ การโต้ตอบในอดีต หรือความรู้ทั่วไปในระยะยาว ซึ่งสำคัญสำหรับการปรับแต่งส่วนบุคคล

**ตัวอย่างหน่วยความจำระยะยาว**

หน่วยความจำระยะยาวอาจเก็บว่า "เบ็นชอบเล่นสกีและกิจกรรมกลางแจ้ง ชอบดื่มกาแฟพร้อมวิวภูเขา และต้องการหลีกเลี่ยงทางสกีขั้นสูงเพราะเคยได้รับบาดเจ็บ" ข้อมูลนี้ซึ่งเรียนรู้จากการโต้ตอบก่อนหน้านี้จะมีผลกับคำแนะนำในการวางแผนท่องเที่ยวในอนาคต ทำให้คำแนะนำนั้นมีความเฉพาะเจาะจงสูง

#### หน่วยความจำบุคลิก (Persona Memory)

หน่วยความจำเฉพาะนี้ช่วยให้เอเจนต์พัฒนาบุคลิกหรือ persona ที่สอดคล้อง ช่วยให้เอเจนต์จำรายละเอียดเกี่ยวกับตัวเองหรือบทบาทที่ตั้งใจไว้ ทำให้การโต้ตอบไหลลื่นและมีจุดมุ่งหมายมากขึ้น

**ตัวอย่างหน่วยความจำบุคลิก**

ถ้าเอเจนต์ท่องเที่ยวถูกออกแบบให้เป็น "ผู้เชี่ยวชาญด้านการวางแผนสกี" หน่วยความจำบุคลิกจะเสริมบทบาทนี้ ส่งผลต่อคำตอบให้สอดคล้องกับน้ำเสียงและความรู้ของผู้เชี่ยวชาญ

#### หน่วยความจำขั้นตอน/เฉพาะเหตุการณ์ (Workflow/Episodic Memory)

หน่วยความจำนี้เก็บลำดับขั้นตอนที่เอเจนต์ทำในงานซับซ้อน รวมถึงความสำเร็จและความล้มเหลว มันก็เหมือนการจดจำ "ตอน" หรือประสบการณ์ที่ผ่านมาเพื่อเรียนรู้จากพวกมัน

**ตัวอย่างหน่วยความจำเฉพาะเหตุการณ์**

ถ้าเอเจนต์พยายามจองเที่ยวบินเจาะจงแต่ล้มเหลวเนื่องจากไม่มีที่นั่ง หน่วยความจำเฉพาะเหตุการณ์จะบันทึกล้มเหลวนี้ ช่วยให้เอเจนต์ลองทางเลือกอื่นหรือแจ้งผู้ใช้แบบมีข้อมูลมากขึ้นในการพยายามครั้งต่อไป

#### หน่วยความจำเอนทิตี้ (Entity Memory)

เกี่ยวข้องกับการดึงและจดจำเอนทิตี้เฉพาะ เช่น คน สถานที่ หรือสิ่งของ รวมถึงเหตุการณ์จากบทสนทนา ช่วยให้เอเจนต์สร้างความเข้าใจมีโครงสร้างขององค์ประกอบสำคัญที่พูดคุยกัน

**ตัวอย่างหน่วยความจำเอนทิตี้**

จากบทสนทนาเกี่ยวกับทริปที่ผ่านมา เอเจนต์อาจดึงคำว่า "ปารีส," "หอไอเฟล," และ "ดินเนอร์ที่ร้าน Le Chat Noir" เป็นเอนทิตี้ ในการโต้ตอบครั้งหน้าจะสามารถจดจำ "Le Chat Noir" และเสนอบริการจองโต๊ะใหม่ได้

#### Structured RAG (Retrieval Augmented Generation แบบมีโครงสร้าง)

แม้ว่า RAG จะเป็นเทคนิคที่กว้างกว่า แต่ “Structured RAG” ถูกเน้นว่าเป็นเทคโนโลยีหน่วยความจำอันทรงพลัง มันดึงข้อมูลที่หนาแน่นและมีโครงสร้างจากแหล่งต่าง ๆ เช่น บทสนทนา อีเมล รูปภาพ และใช้เพื่อเสริมความแม่นยำ การเรียกคืน และความเร็วในการตอบกลับ แตกต่างจาก RAG แบบคลาสสิกที่พึ่งพาแค่ความคล้ายทางความหมาย Structured RAG ทำงานกับโครงสร้างเนื้อหาโดยตรง

**ตัวอย่าง Structured RAG**

แทนที่จะจับคู่แค่คำสำคัญ Structured RAG สามารถแยกข้อมูลเที่ยวบิน (ปลายทาง วันที่ เวลา สายการบิน) จากอีเมลและเก็บในรูปแบบที่มีโครงสร้าง ทำให้สามารถถามแบบแม่นยำ เช่น "ฉันจองเที่ยวบินไปปารีสวันอังคารอะไร?"

## การใช้และเก็บหน่วยความจำ

การนำหน่วยความจำมาใช้กับเอเจนต์ AI เกี่ยวข้องกับกระบวนการจัดการหน่วยความจำแบบเป็นระบบ ซึ่งรวมถึงการสร้าง เก็บรักษา ดึงข้อมูล บูรณาการ อัปเดต และแม้แต่การ “ลืม” (หรือลบ) ข้อมูล การดึงข้อมูลเป็นส่วนสำคัญอย่างยิ่ง

### เครื่องมือหน่วยความจำเฉพาะ

#### Mem0

วิธีหนึ่งในการเก็บและจัดการหน่วยความจำของเอเจนต์คือการใช้เครื่องมือเฉพาะอย่าง Mem0 Mem0 ทำงานเป็นชั้นหน่วยความจำถาวร ช่วยให้เอเจนต์เรียกคืนการโต้ตอบที่เกี่ยวข้อง เก็บความชอบของผู้ใช้และบริบทข้อเท็จจริง และเรียนรู้จากความสำเร็จและความล้มเหลวเมื่อเวลาผ่านไป แนวคิดคือเอเจนต์ที่ไม่มีสถานะจะกลายเป็นเอเจนต์ที่มีสถานะ

มันทำงานผ่าน **กระบวนการหน่วยความจำสองขั้นตอน: การสกัดและอัปเดต** ขั้นแรก ข้อความที่เพิ่มในเธรดของเอเจนต์จะถูกส่งไปยังบริการ Mem0 ซึ่งใช้ Large Language Model (LLM) สรุปประวัติการสนทนาและดึงหน่วยความจำใหม่ หลังจากนั้น ขั้นตอนอัปเดตที่ขับเคลื่อนโดย LLM จะกำหนดว่าจะเพิ่ม แก้ไข หรือ ลบหน่วยความจำเหล่านี้ โดยเก็บไว้ในที่เก็บข้อมูลแบบไฮบริดที่รวมฐานข้อมูลเวกเตอร์ กราฟ และคีย์-ค่า ระบบนี้รองรับประเภทหน่วยความจำต่าง ๆ รวมถึงหน่วยความจำกราฟสำหรับจัดการความสัมพันธ์ระหว่างเอนทิตี้

#### Cognee

อีกแนวทางที่ทรงพลังคือการใช้ **Cognee** ซึ่งเป็นหน่วยความจำ semantic แบบโอเพนซอร์สสำหรับเอเจนต์ AI ที่เปลี่ยนข้อมูลที่มีและไม่มีโครงสร้างเป็นกราฟความรู้ที่สามารถค้นหาได้โดยสนับสนุนด้วย embeddings Cognee มี **สถาปัตยกรรมแบบเก็บข้อมูลคู่** ที่ผสมการค้นหาแบบเวกเตอร์ที่คล้ายคลึงกับความสัมพันธ์กราฟ ช่วยให้เอเจนต์ไม่เพียงแค่เข้าใจว่าข้อมูลใดคล้ายกัน แต่เข้าใจว่าคอนเซ็ปต์เกี่ยวข้องกันอย่างไร

มันโดดเด่นใน **การดึงข้อมูลแบบไฮบริด** ที่ผสมผสานความคล้ายคลึงเวกเตอร์ โครงสร้างกราฟ และการใช้เหตุผลจาก LLM ตั้งแต่การค้นหาแบบ chunks ธรรมดา ไปจนถึงการตอบคำถามที่รู้จักกราฟ ระบบนี้เก็บ **หน่วยความจำที่มีชีวิต** ซึ่งพัฒนาและเติบโตในขณะที่ยังคงสามารถค้นหาได้ในฐานะกราฟที่เชื่อมต่อกันเดียว สนับสนุนทั้งบริบทเซสชันระยะสั้นและหน่วยความจำถาวรระยะยาว

สมุดบันทึกสาธิต Cognee ([13-agent-memory-cognee.ipynb](./13-agent-memory-cognee.ipynb)) แสดงการสร้างชั้นหน่วยความจำที่รวมนี้ พร้อมตัวอย่างปฏิบัติของการนำเข้าข้อมูลหลากหลายประเภท แสดงภาพกราฟความรู้ และการค้นหาด้วยกลยุทธ์ต่าง ๆ ที่เหมาะสมกับความต้องการเฉพาะของเอเจนต์

### การเก็บหน่วยความจำด้วย RAG

นอกจากเครื่องมือหน่วยความจำเฉพาะอย่าง mem0 คุณยังสามารถใช้บริการค้นหาที่แข็งแกร่งเช่น **Azure AI Search เป็น backend สำหรับเก็บและดึงหน่วยความจำ** โดยเฉพาะสำหรับ Structured RAG

วิธีนี้ช่วยให้คุณสร้างฐานข้อมูลสำหรับตอบสนองเอเจนต์ของคุณด้วยข้อมูลของคุณเอง เพื่อให้ได้คำตอบที่เกี่ยวข้องและแม่นยำมากขึ้น Azure AI Search สามารถถูกใช้ในการเก็บความทรงจำเฉพาะของผู้ใช้ในเรื่องท่องเที่ยว แคตตาล็อกสินค้า หรือความรู้โดเมนอื่น ๆ

Azure AI Search รองรับความสามารถอย่าง **Structured RAG** ซึ่งโดดเด่นในการดึงและเรียกคืนข้อมูลที่หนาแน่นและมีโครงสร้างจากชุดข้อมูลขนาดใหญ่ เช่น ประวัติการสนทนา อีเมล หรือแม้แต่รูปภาพ ทำให้ได้ “ความแม่นยำและการจำแบบเหนือมนุษย์” เมื่อเทียบกับวิธีปกติอย่างการแยกชิ้นข้อความและการฝัง

## ทำให้เอเจนต์ AI ปรับปรุงตัวเองได้

รูปแบบทั่วไปสำหรับเอเจนต์ที่ปรับปรุงตัวเองได้คือการเพิ่มเอเจนต์ “ความรู้” (knowledge agent) แยกต่างหากออกมา เอเจนต์นี้เฝ้าดูบทสนทนาหลักระหว่างผู้ใช้กับเอเจนต์หลัก โดยทำหน้าที่:

1. **ระบุข้อมูลที่มีค่า**: ว่ามีส่วนใดของบทสนทนาที่ควรเก็บเป็นความรู้ทั่วไปหรือความชอบเฉพาะของผู้ใช้

2. **สกัดและสรุปผล**: กลั่นกรองการเรียนรู้หรือความชอบสำคัญจากบทสนทนา

3. **เก็บในฐานความรู้**: บันทึกข้อมูลที่สกัดไว้ ซึ่งมักจะอยู่ในฐานข้อมูลเวกเตอร์ เพื่อจะได้เรียกคืนในภายหลัง

4. **เสริมการค้นหาในอนาคต**: เมื่อผู้ใช้เริ่มคำถามใหม่ เอเจนต์ความรู้จะดึงข้อมูลที่เกี่ยวข้องมาและเพิ่มลงใน prompt ของผู้ใช้เพื่อให้บริบทสำคัญกับเอเจนต์หลัก (คล้ายกับ RAG)

### การปรับแต่งเพื่อหน่วยความจำ

• **การจัดการความล่าช้า (Latency Management)**: เพื่อไม่ให้การโต้ตอบช้าลง อาจใช้โมเดลที่ถูกกว่าและเร็วกว่าเพื่อตรวจสอบเบื้องต้นว่าข้อมูลน่าจะมีค่าต่อการเก็บหรือดึงข้อมูล จากนั้นจะเรียกใช้กระบวนการสกัดหรือดึงข้อมูลที่ซับซ้อนกว่าเฉพาะเมื่อต้องการจริง ๆ

• **การบำรุงรักษาฐานความรู้**: สำหรับฐานความรู้ที่เติบโต ข้อมูลที่ไม่ได้ใช้บ่อยอาจถูกย้ายไปที่ “cold storage” เพื่อลดต้นทุน

## มีคำถามเพิ่มเติมเกี่ยวกับหน่วยความจำของเอเจนต์ไหม?

เข้าร่วม [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord) เพื่อพบกับนักเรียนคนอื่น ๆ เข้าร่วมชั่วโมงสำนักงาน และรับคำตอบสำหรับคำถามเกี่ยวกับเอเจนต์ AI ของคุณได้เลย

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**ข้อจำกัดความรับผิดชอบ**:
เอกสารนี้ได้รับการแปลโดยใช้บริการแปลด้วย AI [Co-op Translator](https://github.com/Azure/co-op-translator) แม้ว่าเราจะพยายามให้ความถูกต้องสูงสุด แต่โปรดทราบว่าการแปลอัตโนมัติอาจมีข้อผิดพลาดหรือความไม่ถูกต้อง เอกสารฉบับต้นฉบับในภาษาต้นทางถือเป็นแหล่งข้อมูลที่ถูกต้องและน่าเชื่อถือ สำหรับข้อมูลที่สำคัญ ขอแนะนำให้ใช้บริการแปลโดยนักแปลมืออาชีพพึงระวังว่าเราไม่ต้องรับผิดชอบต่อความเข้าใจผิดหรือการตีความผิดใด ๆ ที่เกิดขึ้นจากการใช้การแปลนี้
<!-- CO-OP TRANSLATOR DISCLAIMER END -->