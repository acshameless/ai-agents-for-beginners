[![Multi-Agent Design](../../../translated_images/zh-CN/lesson-8-thumbnail.278a3e4a59137d62.webp)](https://youtu.be/V6HpE9hZEx0?si=A7K44uMCqgvLQVCa)

> _(点击上方图片观看本课视频)_

# 多智能体设计模式

一旦你开始从事涉及多个智能体的项目，就需要考虑多智能体设计模式。然而，何时切换到多智能体以及其优势可能并不立即清晰。

## 介绍

在本课中，我们将尝试回答以下问题：

- 多智能体适用的场景有哪些？
- 使用多智能体相较于单一智能体执行多任务有什么优势？
- 实现多智能体设计模式的构建模块有哪些？
- 我们如何能看到多个智能体之间的交互情况？

## 学习目标

本课结束后，你应能：

- 识别多智能体适用的场景
- 认识使用多智能体相比单一智能体的优势
- 理解实现多智能体设计模式的构建模块

更大的背景是什么？

*多智能体是一种设计模式，允许多个智能体协同工作以实现共同目标*。

该模式广泛应用于机器人学、自治系统和分布式计算等多个领域。

## 多智能体适用场景

那么哪些场景适合使用多智能体？答案是多种场景中尤其以下情况适用：

- **大工作负载**：将大任务拆分成小任务，分配给不同智能体，实现并行处理，加快完成速度。例如大型数据处理任务。
- **复杂任务**：复杂任务也可以拆分成多个子任务，由不同智能体负责各个具体方面。例如自动驾驶汽车中，不同智能体负责导航、障碍检测及与其它车辆通信。
- **多样专长**：不同智能体具备多样专长，更有效地处理任务不同方面。比如医疗领域，智能体分别管理诊断、治疗方案和患者监护。

## 使用多智能体优于单一智能体的优势

单一智能体系统适合简单任务，但面对复杂任务时，多智能体有以下优势：

- **专门化**：每个智能体专攻特定任务。单一智能体因缺乏专门化，面对复杂任务时可能混淆、执行不擅长的任务。
- **可扩展性**：通过增加更多智能体扩展系统更加容易，而不是让单个智能体超负荷。
- **容错性**：某智能体失败时，其他智能体仍能继续工作，确保系统可靠。

举例来说，为用户订旅行。单一智能体需处理所有预订流程，从查找航班到订酒店及租车。此智能体需具备处理所有任务的能力，导致系统复杂且难维护扩展。多智能体系统则让不同智能体专注查航班、订酒店和租车，使系统更模块化、易维护和可扩展。

这就像一家家庭经营的旅行社与特许经营的旅行社对比。家庭旅行社由单一智能体处理所有预订，而特许经营由不同智能体分别处理不同流程。

## 实现多智能体设计模式的构建模块

在实现多智能体设计模式前，需了解构成该模式的模块。

以为用户订旅行为例，构建模块包括：

- **智能体通信**：负责查航班、订酒店和租车的智能体需沟通用户偏好和限制。需要决定通信协议和方法。具体来说，查航班智能体需与订酒店智能体交流，保证酒店预订与航班日期一致。即需决定*哪些智能体共享信息以及如何共享*。
- **协调机制**：智能体须协调行动，满足用户偏好和限制。比如用户偏好酒店靠近机场，而限制是租车只能在机场拿车。订酒店智能体与租车智能体相互协调，满足这些需求。即需决定*智能体如何协调行动*。
- **智能体架构**：智能体内部须具备决策功能，能从与用户互动中学习。查航班智能体需根据用户历史偏好决策推荐航班。即需决定*智能体如何决策和学习*。例如，查航班智能体可用机器学习模型基于用户过往偏好进行推荐。
- **多智能体交互可见性**：需要有工具和技术监控多个智能体的活动和交互，如日志监控、可视化工具和性能指标。
- **多智能体模式**：有集中式、分布式和混合架构等不同实现模式，需选择最合适的模式。
- **人工介入**：通常系统中有人类介入环节，需要指示智能体何时请求人工干预。例如，用户要求指定未推荐的酒店或航班，或预订前要求确认。

## 多智能体交互的可见性

了解多个智能体之间如何交互非常重要，有助于调试、优化和保障系统效果。为此需有跟踪智能体活动和交互的工具，如日志监控、可视化工具和性能指标。

例如，为用户订旅行时，可有仪表盘显示每个智能体状态、用户偏好和限制、以及智能体间交互。仪表盘可显示旅行日期、航班智能体推荐的航班、酒店智能体推荐的酒店和租车智能体推荐的车型。帮助清晰了解智能体交互及是否满足用户需求。

更具体地看：

- **日志和监控工具**：每个智能体的操作都应记录日志，日志包含操作智能体、执行动作、动作发生时间及结果，便于调试与优化。
- **可视化工具**：用图形化方式展示智能体间信息流，直观揭示瓶颈、低效等问题。
- **性能指标**：追踪多智能体系统绩效，如完成任务所需时间、单位时间完成任务数量及推荐准确性，指导改进和优化。

## 多智能体模式

以下是一些可用于构建多智能体应用的具体模式，值得考虑：

### 群聊模式

当需要创建多智能体相互通信的群聊应用时适用。典型场景包括团队协作、客户支持和社交网络。

该模式中，每个智能体代表群聊中的一个用户，采用消息协议交换消息。智能体可以发送、接收并响应群聊消息。

可采用集中式架构（所有消息通过中央服务器传递）或分布式架构（消息直接交换）。

![Group chat](../../../translated_images/zh-CN/multi-agent-group-chat.ec10f4cde556babd.webp)

### 任务交接模式

适合创建多个智能体之间能够相互交接任务的应用。

典型应用包括客户支持、任务管理和工作流自动化。

每个智能体表现为任务或工作流中的一步，按照预定义规则向其他智能体交接任务。

![Hand off](../../../translated_images/zh-CN/multi-agent-hand-off.4c5fb00ba6f8750a.webp)

### 协同过滤模式

用于多个智能体合作向用户推荐内容的应用。

使用多个智能体参与推荐因各智能体具备不同专长，能从不同角度贡献。

举例：用户需要买股票推荐。

- **行业专家**：一智能体专研某行业。
- **技术分析**：另一智能体擅长技术分析。
- **基本面分析**：再一智能体负责基本面分析。通过协作，提供更全面推荐。

![Recommendation](../../../translated_images/zh-CN/multi-agent-filtering.d959cb129dc9f608.webp)

## 场景：退款流程

假设客户申请产品退款，过程中可能涉及多个智能体，分为退款特定智能体和业务通用智能体。

**退款特定智能体**：

- **客户智能体**：代表客户，负责发起退款流程。
- **卖家智能体**：代表卖家，负责处理退款。
- **支付智能体**：管理支付过程，负责退款执行。
- **解决智能体**：负责处理退款过程中产生的问题。
- **合规智能体**：确保退款流程符合规章政策。

**通用智能体**：

业务其他部分也可用。

- **物流智能体**：代表物流过程，负责将产品寄回卖家。可用于退款或一般购买物流。
- **反馈智能体**：负责收集客户反馈，反馈不限于退款时。
- **升级智能体**：负责将问题升级到更高支持级别，适用于任何需要升级的问题。
- **通知智能体**：负责退款各阶段向客户发送通知。
- **分析智能体**：负责分析退款相关数据。
- **审计智能体**：负责审计退款流程确保规范执行。
- **报告智能体**：生成退款流程相关报告。
- **知识智能体**：维护退款及业务相关知识库。
- **安全智能体**：保障退款流程安全。
- **质量智能体**：确保退款流程质量。

以上列出了多个退款相关及通用智能体，帮助你理解如何设计多智能体系统时选择合适智能体。

## 作业

设计一个客户支持流程的多智能体系统。识别过程中涉及的智能体、其角色和职责，以及它们的交互方式。考虑客户支持特定智能体和业务其他部分可用的通用智能体。
> 在阅读以下解决方案之前，请先思考，你可能需要的代理数量比你想象的要多。

> TIP: 思考客户支持流程的不同阶段，同时也考虑系统所需的代理。

## 解决方案

[Solution](./solution/solution.md)

## 知识检测

问题：何时应考虑使用多代理？

- [ ] A1：当你有小工作量且任务简单时。
- [ ] A2：当你有大工作量时。
- [ ] A3：当你有简单任务时。

[Solution quiz](./solution/solution-quiz.md)

## 总结

在本课中，我们探讨了多代理设计模式，包括适用多代理的场景、使用多代理相较于单一代理的优势、实现多代理设计模式的构建模块，以及如何监控多个代理之间的互动。

### 对多代理设计模式还有更多疑问吗？

加入 [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord)，与其他学习者交流，参加答疑时间，获得你的 AI 代理问题的解答。

## 附加资源

- <a href="https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html" target="_blank">AutoGen 设计模式</a>
- <a href="https://www.analyticsvidhya.com/blog/2024/10/agentic-design-patterns/" target="_blank">Agentic 设计模式</a>

## 上一课

[规划设计](../07-planning-design/README.md)

## 下一课

[AI 代理中的元认知](../09-metacognition/README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**免责声明**：
本文件使用 AI 翻译服务 [Co-op Translator](https://github.com/Azure/co-op-translator) 进行翻译。尽管我们力求准确，但请注意，自动翻译可能存在错误或不准确之处。原始文件的原文应被视为权威来源。对于关键信息，建议采用专业人工翻译。对于因使用本翻译而产生的任何误解或误释，我们概不负责。
<!-- CO-OP TRANSLATOR DISCLAIMER END -->