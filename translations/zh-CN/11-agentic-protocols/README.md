# 使用代理协议（MCP、A2A 与 NLWeb）

[![代理协议](../../../translated_images/zh-CN/lesson-11-thumbnail.b6c742949cf1ce2a.webp)](https://youtu.be/X-Dh9R3Opn8)

> _(点击上方图片查看本课的视频)_

随着 AI 代理的使用增长，对确保标准化、安全性并支持开放创新的协议需求也在增加。在本课中，我们将介绍旨在满足这些需求的三种协议 —— 模型上下文协议（MCP）、代理到代理（A2A）和自然语言网页（NLWeb）。

## 介绍

在本课中，我们将涵盖：

• **MCP** 如何允许 AI 代理访问外部工具和数据以完成用户任务。

• **A2A** 如何使不同 AI 代理之间进行通信和协作。

• **NLWeb** 如何为任何网站带来自然语言界面，使 AI 代理能够发现并与内容交互。

## 学习目标

• **识别** MCP、A2A 和 NLWeb 在 AI 代理上下文中的核心目的和优势。

• **解释** 每个协议如何促进 LLM、工具和其他代理之间的通信与交互。

• **识别** 每个协议在构建复杂代理系统中扮演的不同角色。

## 模型上下文协议

**模型上下文协议（MCP）** 是一种开放标准，提供了一种标准化方式，供应用向 LLM 提供上下文和工具。这使得 AI 代理可以以一致的方式连接到不同的数据源和工具，形成“通用适配器”。

让我们看看 MCP 的组件、与直接使用 API 相比的好处，以及 AI 代理可能如何使用 MCP 服务器的示例。

### MCP 核心组件

MCP 在 **客户端-服务器 架构** 上运行，其核心组件包括：

• **Hosts** 是启动与 MCP 服务器连接的 LLM 应用（例如像 VSCode 这样的代码编辑器）。

• **Clients** 是托管应用内的组件，与服务器保持一对一连接。

• **Servers** 是公开特定功能的轻量级程序。

协议中包含三种核心原语，即 MCP 服务器的能力：

• **Tools**：这些是 AI 代理可以调用以执行某个动作的离散操作或函数。例如，天气服务可能公开一个“获取天气”的工具，或电子商务服务器可能公开一个“购买商品”的工具。MCP 服务器会在其能力列表中公布每个工具的名称、描述和输入/输出模式。

• **Resources**：这些是 MCP 服务器可以提供的只读数据项或文档，客户端可以按需检索它们。示例包括文件内容、数据库记录或日志文件。资源可以是文本（如代码或 JSON）或二进制（如图像或 PDF）。

• **Prompts**：这些是预定义的模板，提供建议提示，允许更复杂的工作流。

### MCP 的好处

MCP 为 AI 代理提供了显著优势：

• **动态工具发现**：代理可以动态接收来自服务器的可用工具列表以及它们的功能说明。这与传统 API 不同，传统 API 往往需要静态编码集成，任何 API 更改都会需要代码更新。MCP 提供“一次集成”的方法，从而具有更高的适应性。

• **跨 LLM 的互操作性**：MCP 可在不同的 LLM 之间工作，提供灵活性以切换核心模型以评估更好的性能。

• **标准化安全**：MCP 包含标准的身份验证方法，在添加对额外 MCP 服务器的访问时提高了可扩展性。这比管理不同的密钥和各种传统 API 的身份验证类型更简单。

### MCP 示例

![MCP 图示](../../../translated_images/zh-CN/mcp-diagram.e4ca1cbd551444a1.webp)

想象用户希望使用由 MCP 提供支持的 AI 助手预订航班。

1. **Connection**：AI 助手（MCP 客户端）连接到航空公司提供的 MCP 服务器。

2. **Tool Discovery**：客户端询问航空公司的 MCP 服务器：“你们有哪些可用的工具？”服务器返回诸如“搜索航班”和“预订航班”等工具。

3. **Tool Invocation**：然后你请求 AI 助手，“请搜索一趟从波特兰到檀香山的航班。”AI 助手使用其 LLM，识别出需要调用“搜索航班”工具，并将相关参数（出发地、目的地）传递给 MCP 服务器。

4. **Execution and Response**：MCP 服务器作为包装器，实际调用航空公司的内部预订 API。随后它接收航班信息（例如 JSON 数据）并将其发送回 AI 助手。

5. **Further Interaction**：AI 助手展示航班选项。一旦你选择航班，助手可能会在同一 MCP 服务器上调用“预订航班”工具，完成预订。

## 代理到代理 协议（A2A）

虽然 MCP 专注于将 LLM 连接到工具，**代理到代理（A2A）协议** 更进一步，使不同 AI 代理之间能够通信与协作。A2A 将来自不同组织、环境和技术栈的 AI 代理连接起来，以完成共享任务。

我们将审视 A2A 的组件和优势，以及它如何在我们的旅行应用中应用的示例。

### A2A 核心组件

A2A 专注于使代理之间能够通信并协作完成用户的子任务。协议的每个组件都对此有所贡献：

#### Agent Card

类似于 MCP 服务器共享工具列表的方式，Agent Card 包含：
- 代理的名称 .
- **它完成的一般任务的描述**。
- **具体技能列表**及其描述，以帮助其他代理（或人类用户）了解何时以及为什么要调用该代理。
- 代理的 **当前 Endpoint URL**
- 代理的 **版本**和 **能力**，例如流式响应和推送通知。

#### Agent Executor

Agent Executor 负责 **将用户聊天的上下文传递给远程代理**，远程代理需要这些上下文来理解需要完成的任务。在 A2A 服务器中，代理使用其自己的大型语言模型（LLM）来解析传入请求并使用其内部工具执行任务。

#### Artifact

一旦远程代理完成请求的任务，其工作产出将作为工件创建。工件 **包含代理工作结果**、**已完成内容的描述**，以及通过该协议发送的 **文本上下文**。工件发送后，与远程代理的连接将关闭，直到再次需要为止。

#### Event Queue

该组件用于 **处理更新和传递消息**。在生产环境中，对于代理系统尤为重要，以防止在任务完成之前代理之间的连接被关闭，尤其是当任务完成时间可能较长时。

### A2A 的好处

• **增强的协作**：它使来自不同供应商和平台的代理能够交互、共享上下文并协同工作，促进跨传统上不连通的系统的无缝自动化。

• **模型选择灵活性**：每个 A2A 代理可以决定用于服务其请求的 LLM，允许为每个代理使用优化或微调的模型，这不同于某些 MCP 场景中的单一 LLM 连接。

• **内置身份验证**：身份验证直接集成到 A2A 协议中，为代理交互提供了强健的安全框架。

### A2A 示例

![A2A 图示](../../../translated_images/zh-CN/A2A-Diagram.8666928d648acc26.webp)

让我们扩展之前的旅行预订场景，这次使用 A2A。

1. **用户向多代理发出请求**：用户与“旅行代理”A2A 客户端/代理交互，可能会说：“请为下周预订一次完整的檀香山行程，包括航班、酒店和租车”。

2. **旅行代理的编排**：旅行代理接收这一复杂请求。它使用其 LLM 推理任务并确定需要与其他专门代理交互。

3. **代理间通信**：旅行代理随后使用 A2A 协议连接到下游代理，例如由不同公司创建的“航空公司代理”、“酒店代理”和“租车代理”。

4. **委派任务执行**：旅行代理将具体任务发送给这些专门代理（例如，“查找飞往檀香山的航班”、“预订酒店”、“租车”）。这些专门代理各自运行自己的 LLM 并利用自己的工具（这些工具本身也可能是 MCP 服务器），执行其特定的预订部分。

5. **汇总响应**：一旦所有下游代理完成任务，旅行代理汇总结果（航班详情、酒店确认、租车预订）并将综合的聊天式响应发送回用户。

## 自然语言网页（NLWeb）

网站长期以来一直是用户访问互联网上信息和数据的主要方式。

让我们来看一下 NLWeb 的不同组件、NLWeb 的优势以及通过我们的旅行应用来说明 NLWeb 的工作示例。

### NLWeb 的组件

- **NLWeb 应用（核心服务代码）**：处理自然语言问题的系统。它连接平台的不同部分以生成响应。你可以将其视为为网站的自然语言功能提供动力的 **引擎**。

- **NLWeb 协议**：这是一套用于与网站进行自然语言交互的**基本规则**。它以 JSON 格式返回响应（通常使用 Schema.org）。其目的是为“AI 网”创建一个简单的基础，就像 HTML 使在线共享文档成为可能一样。

- **MCP 服务器（模型上下文协议端点）**：每个 NLWeb 设置也作为 **MCP 服务器** 工作。这意味着它可以 **与其他 AI 系统共享工具（如“ask”方法）和数据**。在实践中，这使网站的内容和功能可以被 AI 代理使用，从而使该站点成为更广泛“代理生态系统”的一部分。

- **嵌入模型**：这些模型用于将网站内容**转换为称为向量的数值表示（嵌入）**。这些向量以计算机可比较和搜索的方式捕捉含义。它们存储在专门的数据库中，用户可以选择他们想使用的嵌入模型。

- **向量数据库（检索机制）**：该数据库**存储网站内容的嵌入**。当有人提出问题时，NLWeb 会检查向量数据库以快速查找最相关的信息。它会给出按相似度排序的快速可能答案列表。NLWeb 支持与不同的向量存储系统协作，例如 Qdrant、Snowflake、Milvus、Azure AI Search 和 Elasticsearch。

### NLWeb 示例

![NLWeb](../../../translated_images/zh-CN/nlweb-diagram.c1e2390b310e5fe4.webp)

再次考虑我们的旅行预订网站，但这次它由 NLWeb 提供支持。

1. **数据摄取**：旅行网站现有的产品目录（例如航班列表、酒店描述、旅游套餐）使用 Schema.org 格式化或通过 RSS 源加载。NLWeb 的工具摄取这些结构化数据，创建嵌入，并将其存储在本地或远程的向量数据库中。

2. **自然语言查询（人类）**：用户访问网站，与其通过导航菜单，不如在聊天界面中输入：“帮我找下周在檀香山适合家庭入住且带游泳池的酒店”。

3. **NLWeb 处理**：NLWeb 应用接收该查询。它将查询发送给 LLM 以便理解，同时在其向量数据库中搜索相关的酒店列表。

4. **准确的结果**：LLM 有助于解释数据库的搜索结果，根据“适合家庭”、“游泳池”和“檀香山”的条件识别最佳匹配，然后将其格式化为自然语言响应。关键是，响应引用的是网站目录中的实际酒店，避免捏造信息。

5. **AI 代理交互**：因为 NLWeb 作为 MCP 服务器，外部 AI 旅行代理也可以连接到该网站的 NLWeb 实例。AI 代理随后可以使用 `ask("Are there any vegan-friendly restaurants in the Honolulu area recommended by the hotel?")` MCP 方法直接查询网站。NLWeb 实例将处理此请求，利用其餐厅信息数据库（如果已加载），并返回结构化的 JSON 响应。

### 想了解更多关于 MCP/A2A/NLWeb 的问题吗？

加入 [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord) 与其他学习者见面，参加答疑时段并获取你的 AI 代理问题的解答。

## 资源

- [MCP for Beginners](https://aka.ms/mcp-for-beginners)  
- [MCP Documentation](https://github.com/microsoft/semantic-kernel/tree/main/python/semantic-kernel/semantic_kernel/connectors/mcp)
- [NLWeb Repo](https://github.com/nlweb-ai/NLWeb)
- [Semantic Kernel Guides](https://learn.microsoft.com/semantic-kernel/)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
免责声明：
本文件已使用 AI 翻译服务 [Co-op Translator](https://github.com/Azure/co-op-translator) 进行翻译。尽管我们努力确保准确性，但请注意自动翻译可能包含错误或不准确之处。原始文档的母语版本应被视为权威来源。对于关键信息，建议使用专业人工翻译。我们不对因使用本翻译而产生的任何误解或曲解承担责任。
<!-- CO-OP TRANSLATOR DISCLAIMER END -->