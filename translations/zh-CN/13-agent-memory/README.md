# AI 代理的记忆 
[![代理记忆](../../../translated_images/zh-CN/lesson-13-thumbnail.959e3bc52d210c64.webp)](https://youtu.be/QrYbHesIxpw?si=qNYW6PL3fb3lTPMk)

当讨论创建 AI 代理的独特优势时，主要讨论两点：调用工具完成任务的能力和随着时间改进的能力。记忆是创建能够自我改进、为用户创造更好体验的代理的基础。

在本课中，我们将了解 AI 代理的记忆是什么，以及如何管理和利用它来提升我们的应用。

## 介绍

本课将涵盖：

• **理解 AI 代理记忆**：记忆是什么以及为什么对代理至关重要。

• **实现和存储记忆**：为您的 AI 代理添加记忆功能的实用方法，重点关注短期和长期记忆。

• **使 AI 代理自我改进**：记忆如何使代理从过去的交互中学习并随着时间推移改进。

## 可用实现

本课包含两个全面的笔记本教程：

• **[13-agent-memory.ipynb](./13-agent-memory.ipynb)**：使用 Mem0 和 Azure AI Search 结合 Semantic Kernel 框架实现记忆

• **[13-agent-memory-cognee.ipynb](./13-agent-memory-cognee.ipynb)**：使用 Cognee 实现结构化记忆，自动构建由嵌入支持的知识图、可视化图谱以及智能检索

## 学习目标

完成本课后，您将知道如何：

• **区分各种类型的 AI 代理记忆**，包括工作记忆、短期和长期记忆，以及像角色记忆和情节记忆等专门形式。

• **使用 Semantic Kernel 框架为 AI 代理实现和管理短期与长期记忆**，利用 Mem0、Cognee、Whiteboard 记忆等工具，并与 Azure AI Search 集成。

• **理解自我改进 AI 代理背后的原理**，以及健全的记忆管理系统如何促进持续学习和适应。

## 理解 AI 代理的记忆

从本质上讲，**AI 代理的记忆指允许它们保留和回忆信息的机制**。这些信息可以是关于对话的具体细节、用户偏好、过去的行动，甚至是学到的模式。

没有记忆，AI 应用通常是无状态的，这意味着每次交互都从头开始。这会导致重复且令人沮丧的用户体验，代理会“忘记”先前的上下文或偏好。

### 为什么记忆重要？

代理的智能与其回忆和利用过去信息的能力密切相关。记忆使代理能够：

• **反思**：从过去的行动和结果中学习。

• **交互性**：在正在进行的对话中保持上下文。

• **前瞻性和反应性**：基于历史数据预测需求或做出适当回应。

• **自主性**：通过调用存储的知识更独立地运行。

实现记忆的目标是使代理更加**可靠和有能力**。

### 记忆类型

#### 工作记忆

将其视为代理在单个正在进行的任务或思考过程中使用的一张草稿纸。它保存计算下一步所需的即时信息。

对于 AI 代理，工作记忆通常捕获对话中最相关的信息，即使完整的聊天记录很长或被截断。它侧重于提取关键要素，如需求、建议、决策和操作。

**工作记忆示例**

在旅行预订代理中，工作记忆可能会捕获用户当前的请求，例如“我想预订去巴黎的行程”。这一具体需求被保存在代理的即时上下文中，以指导当前交互。

#### 短期记忆

这种记忆在单次对话或会话期间保留信息。它是当前聊天的上下文，允许代理回溯对话中的先前轮次。

**短期记忆示例**

如果用户问：“去巴黎的机票大概多少钱？”然后跟进问：“那里的住宿呢？”，短期记忆确保代理知道“那里”在同一对话中指的是“巴黎”。

#### 长期记忆

这是跨多个对话或会话持续存在的信息。它允许代理记住用户偏好、历史交互或长期的常识知识。这对个性化很重要。

**长期记忆示例**

长期记忆可能会存储“Ben 喜欢滑雪和户外活动，喜欢在有山景的咖啡馆喝咖啡，并且因过去受伤而想避免高级滑雪道”等信息。这些从先前交互中学到的信息会影响未来旅行计划会话中的推荐，使其高度个性化。

#### 角色记忆

这种专门的记忆类型帮助代理形成一致的“个性”或“角色”。它允许代理记住关于自身或其预定角色的细节，使交互更流畅和有针对性。

**角色记忆示例**
如果旅行代理被设计为“滑雪专家”，角色记忆可能会强化这一角色，影响其以专家的语气和知识来回答问题。

#### 工作流/情节记忆

这种记忆存储代理在复杂任务中采取的步骤序列，包括成功和失败。它像是在记住特定“情节”或过去经历，以便从中学习。

**情节记忆示例**

如果代理尝试预订某趟特定航班但因不可用而失败，情节记忆可以记录这一失败，允许代理在随后尝试时尝试替代航班或以更知情的方式向用户说明问题。

#### 实体记忆

这涉及从对话中提取并记住特定实体（如人、地点或事物）和事件。它允许代理构建一个关于讨论的关键元素的结构化理解。

**实体记忆示例**

从一次关于过去旅行的对话中，代理可能会提取“巴黎”、“埃菲尔铁塔”和“在 Le Chat Noir 餐厅的晚餐”等实体。在未来的交互中，代理可以回忆起“Le Chat Noir”并主动提出在那里重新预订。

#### 结构化 RAG (Retrieval Augmented Generation)

虽然 RAG 是一种更广泛的技术，但“结构化 RAG”被强调为一种强大的记忆技术。它从各种来源（对话、电子邮件、图像）提取密集、结构化的信息，并用它来提高回答的精确性、召回率和速度。与仅依赖语义相似性的经典 RAG 不同，结构化 RAG 利用信息的固有结构。

**结构化 RAG 示例**

结构化 RAG 可以不仅仅匹配关键字，而是从电子邮件中解析出航班详情（目的地、日期、时间、航空公司）并以结构化方式存储。这允许像“我周二预订了去巴黎的哪趟航班？”这样的精确查询。

## 实现与存储记忆

为 AI 代理实现记忆涉及一个系统化的“记忆管理”过程，包括生成、存储、检索、整合、更新，甚至“遗忘”（或删除）信息。检索是一个特别关键的方面。

### 专用记忆工具

#### Mem0

存储和管理代理记忆的一种方式是使用像 Mem0 这样的专用工具。Mem0 作为持久记忆层工作，允许代理回忆相关交互、存储用户偏好和事实性上下文，并随着时间从成功和失败中学习。其核心思想是无状态的代理转变为有状态的代理。

它通过一个**两阶段记忆管道：提取和更新**来工作。首先，添加到代理线程的消息会发送到 Mem0 服务，Mem0 使用大型语言模型（LLM）来总结对话历史并提取新记忆。随后，LLM 驱动的更新阶段会决定是否添加、修改或删除这些记忆，并将它们存储在可能包含向量、图和键值数据库的混合数据存储中。该系统还支持各种记忆类型，并且可以整合图记忆以管理实体之间的关系。

#### Cognee

另一种强大方法是使用 **Cognee**，一个开源的语义记忆系统，它将结构化和非结构化数据转换为由嵌入支持的可查询知识图。Cognee 提供了**双存储架构**，结合了向量相似性搜索和图关系，使代理不仅能理解信息之间的相似性，还能理解概念之间的关系。

它擅长于将向量相似性、图结构和 LLM 推理融合的**混合检索**——从原始块查找到具备图感知的问题回答。系统维持着不断演进和增长的**活记忆**，并作为一个连接的图保持可查询，支持短期会话上下文和长期持久记忆。

Cognee 的笔记本教程（[13-agent-memory-cognee.ipynb](./13-agent-memory-cognee.ipynb)）演示了构建这个统一记忆层的过程，包含摄取多种数据源、可视化知识图以及针对特定代理需求采用不同检索策略的实用示例。

### 使用 RAG 存储记忆

除了像 mem0 这样的专用记忆工具之外，您还可以利用强大的搜索服务，例如 **Azure AI Search 作为存储和检索记忆的后端**，尤其适用于结构化 RAG。

这使您能够以自己的数据为基础来支撑代理的回答，确保更相关和准确的答案。Azure AI Search 可用于存储用户特定的旅行记忆、产品目录或任何其他特定领域的知识。

Azure AI Search 支持诸如 **结构化 RAG** 的功能，这在从大量数据集中（如对话历史、电子邮件或甚至图像）提取和检索密集、结构化信息方面表现出色。与传统的文本分块和嵌入方法相比，这提供了“超越人类的精确度和召回率”。

## 使 AI 代理自我改进

实现自我改进代理的一个常见模式是引入一个“知识代理”。这个独立的代理观察用户与主代理之间的主要对话。它的角色是：

1. **识别有价值的信息**：确定对话中的哪部分值得作为通用知识或特定用户偏好保存。

2. **提取并总结**：从对话中提炼出关键的学习或偏好。

3. **存储到知识库**：将提取的信息持久化，通常存储在向量数据库中，以便日后检索。

4. **增强未来查询**：当用户发起新查询时，知识代理检索相关的已存信息并将其附加到用户的提示中，为主代理提供关键上下文（类似于 RAG）。

### 记忆的优化

• **延迟管理**：为了避免降低用户交互速度，可以最初使用更便宜、更快速的模型快速检查信息是否有价值需要存储或检索，只有在必要时才调用更复杂的提取/检索流程。

• **知识库维护**：对于不断增长的知识库，不常用的信息可以移动到“冷存储”以控制成本。

## 有关代理记忆还有更多问题吗？

加入 [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord) 与其他学习者会面，参加答疑时间并获得您关于 AI 代理的问题解答。

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
免责声明：
本文件由 AI 翻译服务 Co-op Translator（https://github.com/Azure/co-op-translator）翻译。尽管我们力求准确，但请注意自动翻译可能包含错误或不准确之处。原始语言版本应视为权威来源。对于重要信息，建议采用专业人工翻译。我们不对因使用本翻译而产生的任何误解或曲解承担责任。
<!-- CO-OP TRANSLATOR DISCLAIMER END -->