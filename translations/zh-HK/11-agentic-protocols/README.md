# 使用 Agentic 協議（MCP、A2A 和 NLWeb）

[![Agentic Protocols](../../../translated_images/zh-HK/lesson-11-thumbnail.b6c742949cf1ce2a.webp)](https://youtu.be/X-Dh9R3Opn8)

> _(點擊上方圖片觀看本課程視頻)_

隨著 AI 代理的使用日益增長，對確保標準化、安全性以及支持開放創新的協議需求也隨之增加。本課程將介紹三個旨在滿足此需求的協議——模型上下文協議（MCP）、代理對代理（A2A）和自然語言網絡（NLWeb）。

## 介紹

本課程將涵蓋：

• **MCP** 如何讓 AI 代理訪問外部工具和資料，以完成用戶任務。

• **A2A** 如何實現不同 AI 代理之間的溝通與協作。

• **NLWeb** 如何為任何網站帶來自然語言界面，使 AI 代理能發現並互動網站內容。

## 學習目標

• **識別** MCP、A2A 及 NLWeb 在 AI 代理背景下的核心目的與益處。

• **解釋** 每個協議如何促進大型語言模型（LLM）、工具與其他代理之間的溝通和互動。

• **認識** 各協議在構建複雜代理系統中扮演的不同角色。

## 模型上下文協議

**模型上下文協議（Model Context Protocol, MCP）** 是一個開放標準，提供標準化方式讓應用向大型語言模型提供上下文與工具。這使得 AI 代理能通過「通用適配器」以一致方式連接不同資料來源和工具。

讓我們來看看 MCP 的組成、相較於直接使用 API 的優勢，和 AI 代理如何使用 MCP 伺服器的例子。

### MCP 核心組件

MCP 採用**客戶端伺服器架構**，核心組件包括：

• **Host（主機）** 是啟動到 MCP 伺服器連接的 LLM 應用（例如 VSCode 這類程式碼編輯器）。

• **Client（客戶端）** 是主機應用中維護與伺服器一對一連接的組件。

• **Server（伺服器）** 是暴露特定功能的輕量程序。

協議中包含三個核心基本元素，代表 MCP 伺服器的功能：

• **工具（Tools）**：是 AI 代理可調用執行特定操作的獨立行為或函數。例如，天氣服務可能提供「獲取天氣」工具，電商伺服器可能提供「購買商品」工具。MCP 伺服器會在其功能列表中公布每個工具的名稱、描述和輸入/輸出結構。

• **資源（Resources）**：是 MCP 伺服器可提供的唯讀資料項或文件，客戶端能按需檢索。例子包括檔案內容、資料庫記錄或日誌文件。資源可為純文本（如代碼或 JSON）或二進制內容（如圖片或 PDF）。

• **提示（Prompts）**：是預定義的模板，提供建議提示，便於更複雜工作流程。

### MCP 的優勢

MCP 為 AI 代理帶來顯著優勢：

• **動態工具發現**：代理可動態接收伺服器提供的工具列表及其描述。相較傳統 API 通常需靜態編碼整合，任何 API 變更均需更新碼，MCP 採用“一次集成”方式，具備更高適應性。

• **跨 LLM 互操作性**：MCP 能跨不同大型語言模型運作，提供更換核心模型以評估性能的靈活性。

• **標準化安全性**：MCP 包含標準認證方法，添加更多 MCP 伺服器時提高擴展性，較傳統 API 管理多種密鑰和驗證方式更簡單。

### MCP 範例

![MCP Diagram](../../../translated_images/zh-HK/mcp-diagram.e4ca1cbd551444a1.webp)

想像用戶想用由 MCP 驅動的 AI 助理預訂機票。

1. **連接**：AI 助理（MCP 客戶端）連接航空公司提供的 MCP 伺服器。

2. **工具發現**：客戶端詢問航空公司的 MCP 伺服器：「你有哪些工具可用？」伺服器回應如「搜尋航班」和「預訂航班」等工具。

3. **工具調用**：用戶向 AI 助理說：「請幫我搜尋從波特蘭到火奴魯魯的航班。」AI 助理透過 LLM 判斷需呼叫「搜尋航班」工具，並把相關參數（出發地、目的地）傳給 MCP 伺服器。

4. **執行與回應**：MCP 伺服器作為封裝調用航空公司的內部訂票 API，接著接收航班資訊（例如 JSON 資料），傳回 AI 助理。

5. **後續互動**：AI 助理展示航班選項；用戶選擇航班後，助理可能呼叫同一 MCP 伺服器的「預訂航班」工具，完成訂票。

## 代理對代理協議（A2A）

MCP 專注於連接 LLM 與工具，而**代理對代理協議（Agent-to-Agent, A2A）** 更進一步，促進不同 AI 代理間的溝通與協作。A2A 連接跨組織、環境及技術棧的 AI 代理，共同執行一項共享任務。

我們將探討 A2A 的組成與優勢，以及如何在旅遊應用中應用它的範例。

### A2A 核心組件

A2A 使代理能互相溝通並協同完成用戶子任務。每個組件均支持此目標：

#### 代理卡（Agent Card）

類似 MCP 伺服器分享工具列表，代理卡包含：

- 代理名稱。

- **其完成一般任務的描述**。

- **具體技能列表**與描述，幫助其他代理（甚至人類用戶）了解何時以及為何調用該代理。

- 代理的**當前端點 URL**。

- 代理的**版本**及功能，如串流回應和推送通知。

#### 代理執行器（Agent Executor）

代理執行器負責**將用戶聊天上下文傳給遠程代理**，遠程代理需此資訊以理解要完成的任務。在 A2A 伺服器中，代理使用自身大型語言模型解析請求並調用內部工具執行任務。

#### 工件（Artifact）

遠程代理完成任務後，產出稱作工件。工件**包含代理工作結果**、**完成內容描述**及透過協議傳輸的**文本上下文**。發送工件後，與遠程代理連接關閉，直至再次需要。

#### 事件隊列（Event Queue）

此組件用於**處理更新與傳遞訊息**。在生產環境中，能防止代理間連接在任務完成前關閉，特別是任務執行需要較長時間時。

### A2A 的優勢

• **增強協作**：允許不同廠商和平台的代理互動、共享上下文並協力工作，促進跨系統無縫自動化。

• **模型選擇彈性**：每個 A2A 代理可自行選擇用於服務請求的 LLM，支持優化或微調型模型，與某些 MCP 情境下單一 LLM 連接不同。

• **內建認證**：認證直接整合於 A2A 協議中，為代理互動提供強大安全框架。

### A2A 範例

![A2A Diagram](../../../translated_images/zh-HK/A2A-Diagram.8666928d648acc26.webp)

讓我們拓展之前的旅遊預訂場景，這次使用 A2A。

1. **用戶向多代理請求**：用戶透過「旅遊代理」A2A 客戶端或代理交互，說：「請幫我預訂下週去火奴魯魯的整個行程，包括航班、飯店和租車」。

2. **旅遊代理協調**：旅遊代理接收複雜請求，利用其 LLM 推理任務，判斷需與其他專業代理互動。

3. **代理間通訊**：旅遊代理使用 A2A 協議連接下游代理，如「航空公司代理」、「飯店代理」和「租車代理」，這些代理均由不同公司建立。

4. **委派任務執行**：旅遊代理將具體任務分配給這些專業代理（如「查找火奴魯魯的航班」、「預訂飯店」、「租車」）。各代理分別透過自身 LLM 並利用自己的工具（也可能是 MCP 伺服器）執行相應部分。

5. **整合回應**：待所有下游代理任務完成後，旅遊代理彙整結果（航班詳情、飯店確認、租車訂單）並以聊天式回應發回用戶。

## 自然語言網絡（NLWeb）

網站長期以來是用戶跨網際網路存取資訊和資料的主要方式。

接下來我們看看 NLWeb 的各組件、優勢，以及透過旅遊應用範例瞭解 NLWeb 的運作。

### NLWeb 組件

- **NLWeb 應用（核心服務代碼）**：處理自然語言問題的系統。連結平臺各部分以產生回應。可視為網站自然語言功能的**引擎**。

- **NLWeb 協議**：與網站進行自然語言交互的**基礎規則集**。它以 JSON 格式（常用 Schema.org）返回回應。其目標是為「AI 網絡」建立簡單基礎，就像 HTML 讓線上共享文件成為可能一樣。

- **MCP 伺服器（模型上下文協議端點）**：每個 NLWeb 設置也充當**MCP 伺服器**。意味著它可**與其他 AI 系統共享工具（如「問」方法）和資料**。實際上，這使網站內容和能力可被 AI 代理使用，使網站成為更大「代理生態系」的一部分。

- **嵌入模型**：用於將網站內容轉成叫做向量（embeddings）的數值表示。這些向量以計算機能比較和搜尋的方式捕捉意義。會存放在特殊資料庫中，使用者可選擇想用的嵌入模型。

- **向量資料庫（檢索機制）**：此資料庫儲存網站內容的嵌入。當有人提問時，NLWeb 會檢查向量資料庫迅速尋找最相關資訊，提供相似度排序的快速回答清單。NLWeb 支援多種向量儲存系統，如 Qdrant、Snowflake、Milvus、Azure AI Search 和 Elasticsearch。

### NLWeb 範例

![NLWeb](../../../translated_images/zh-HK/nlweb-diagram.c1e2390b310e5fe4.webp)

再看一次旅遊預訂網站，不過這次它由 NLWeb 驅動。

1. **資料導入**：旅遊網站現有產品目錄（如航班列表、飯店描述、旅遊套票）使用 Schema.org 格式或透過 RSS 輸入。NLWeb 工具將結構化資料導入，產生嵌入，並存入本地或遠端向量資料庫。

2. **自然語言查詢（人類）**：用戶造訪網站後，非透過瀏覽選單，而是在聊天介面中輸入：「幫我找下週火奴魯魯有泳池的親子飯店」。

3. **NLWeb 處理**：NLWeb 應用接收查詢，將查詢送入 LLM 理解，同時搜尋向量資料庫獲取相關飯店列表。

4. **精確結果**：LLM 幫助解釋資料庫搜尋結果，根據「親子友善」、「泳池」和「火奴魯魯」等條件找出最佳匹配，並格式化自然語言回應。關鍵是回應依據網站目錄中的真實飯店資訊，避免杜撰內容。

5. **AI 代理互動**：因 NLWeb 同時作為 MCP 伺服器，外部 AI 旅遊代理也能連接該網站的 NLWeb 實例，利用 `ask` MCP 方法直接查詢網站：`ask("火奴魯魯地區有沒有飯店推薦的純素食餐廳？")`。NLWeb 實例會處理該查詢，調用已導入的餐廳資訊資料庫，並返回結構化 JSON 回應。

### 對 MCP/A2A/NLWeb 還有更多疑問？

加入 [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord)，與其他學習者交流，參加線上答疑時間並解決你的 AI 代理問題。

## 資源

- [MCP 初學者指南](https://aka.ms/mcp-for-beginners)  
- [MCP 文件](https://github.com/microsoft/semantic-kernel/tree/main/python/semantic-kernel/semantic_kernel/connectors/mcp)
- [NLWeb 代碼庫](https://github.com/nlweb-ai/NLWeb)
- [Semantic Kernel 指南](https://learn.microsoft.com/semantic-kernel/)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**免責聲明**：  
本文件由 AI 翻譯服務 [Co-op Translator](https://github.com/Azure/co-op-translator) 進行翻譯。雖然我們致力於確保準確性，但請注意自動翻譯可能包含錯誤或不準確之處。原文文件的原始語言版本應被視為權威來源。對於重要資訊，建議採用專業人工翻譯。我們不對因使用此翻譯內容而引起的任何誤解或誤釋承擔責任。
<!-- CO-OP TRANSLATOR DISCLAIMER END -->