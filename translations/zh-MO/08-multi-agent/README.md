[![Multi-Agent Design](../../../translated_images/zh-MO/lesson-8-thumbnail.278a3e4a59137d62.webp)](https://youtu.be/V6HpE9hZEx0?si=A7K44uMCqgvLQVCa)

> _(點擊上方圖片觀看本課程影片)_

# 多代理設計模式

當你開始著手涉及多代理的專案時，你會需要考慮多代理設計模式。然而，何時轉向多代理以及其優勢可能不會立即明顯。

## 簡介

在本課程中，我們將回答以下問題：

- 哪些情境適合使用多代理？
- 使用多代理相比於單一代理執行多項任務的優勢是什麼？
- 實現多代理設計模式的基本組件有哪些？
- 如何觀察多個代理彼此之間的交互？

## 學習目標

本課後，你應該能夠：

- 識別適用多代理的場景
- 了解使用多代理相較於單一代理的優勢
- 理解實現多代理設計模式的基本組件

整體大方向是什麼？

*多代理是一種設計模式，讓多個代理協同工作以達成共同目標*。

此模式廣泛應用於各種領域，包括機器人技術、自主系統及分散式運算。

## 多代理適用的情境

哪些情境適合使用多代理？答案是有許多情境下使用多代理是有利的，尤其在以下幾種情況：

- **龐大工作負載**：龐大的工作負載可拆分成較小的任務分配給不同代理，允許平行處理並加速完成。舉例來說，如大型資料處理任務。
- **複雜任務**：如同龐大工作負載，複雜任務能拆解成多個子任務，分配給專門處理特定任務的代理。例如自駕車中，不同代理分別負責導航、障礙物偵測及與其他車輛通訊。
- **多元專長**：不同代理可擁有多元專長，使其能較單一代理更有效率地處理任務中的不同面向。舉例而言，在醫療領域中，代理可以分別處理診斷、治療計劃及病患監控。

## 使用多代理相比單一代理的優勢

單一代理系統對於簡單任務可運作良好，但較複雜任務時，使用多代理有多項優勢：

- **專業化**：每個代理可專精於特定任務。單一代理缺乏專業化，意味著代理必須應付所有事情，但面對複雜任務時可能無所適從。例如可能錯誤處理非其擅長的任務。
- **可擴展性**：擴充系統較容易，直接增加代理人數，而不是讓單一代理超負荷。
- **容錯能力**：若一個代理失效，其他代理仍可繼續運作，確保系統可靠。

舉例來說，為用戶訂製旅程。若使用單一代理系統，必須處理所有訂票過程，從尋找航班到預訂飯店和租車。要用單一代理達成，代理需內建處理所有任務的工具，可能導致系統複雜且難以維護及擴充。多代理系統則可由不同代理分別專職尋找航班、訂飯店與租車，使系統更模組化，維護和擴充都較容易。

這情境可比擬為一個家庭式小旅遊社與一個加盟連鎖旅遊社。家庭式旅遊社由單一代理負責所有訂票流程，加盟連鎖則由不同代理分別處理訂票的各個環節。

## 實現多代理設計模式的基本組件

在實作多代理設計模式前，你需理解構成模式的基本組件。

讓我們以再次為用戶訂製旅程為例，基本組件包括：

- **代理通訊**：尋找航班、訂飯店和租車的代理需彼此通訊並分享用戶偏好與限制。你需決定通訊協定與方法。具體來說，尋找航班的代理需與訂飯店的代理通訊，以確保飯店訂在與航班相同日期。這代表代理必須共享用戶行程日期資訊，你需要決定*哪些代理共享資訊以及如何共享*。
- **協調機制**：代理需協調行動以符合用戶偏好與限制。例如用戶偏好住附近機場的飯店，而限制為租車只能在機場取車，訂飯店與租車代理需協調以達成用戶需求。你需要決定*代理如何協調行動*。
- **代理架構**：代理必須具備內部結構以做出決策並從與用戶的互動中學習。舉例，尋找航班的代理需有內部結構決定向用戶推薦哪個航班。你需決定*代理如何做出決策及從用戶互動中學習*。例如，尋找航班代理可利用機器學習模型，依過去偏好推薦航班。
- **多代理互動的可見性**：你需能觀察多個代理間如何互動，因此需要工具和方法來追蹤代理活動和互動。可使用日誌記錄、監控工具、視覺化工具與效能指標。
- **多代理模式**：具備多種實現多代理系統的模式，如集中式、去中心化及混合架構。你需選擇最適合用例的模式。
- **人為介入**：多數情況會有人類介入控制，你需指示代理何時請求人工干預。例如用戶要求指定特定尚未被推薦的飯店或航班，或在訂票前需確認。

## 多代理互動的可見性

你必須能觀察多個代理彼此互動，這對除錯、優化及確保整體系統效能至關重要。為此，你需具備追蹤代理活動和互動的工具與技術，包括日誌與監控工具、視覺化工具及效能指標。

舉例，為用戶訂製旅程時，你可有一個儀表板展示各代理狀態、用戶偏好與限制及代理間的互動。儀表板可顯示用戶旅遊日期、航班代理推薦的航班、飯店代理推薦的飯店及租車代理推薦的車輛。這使你清楚了解代理間的互動，以及是否符合用戶偏好與限制。

讓我們更詳細看這些功能：

- **日誌與監控工具**：你需為代理的每個行動做紀錄。日誌條目可存儲採取行動的代理、所執行的行動、行動時間及結果。這些資訊可用於除錯與優化。
- **視覺化工具**：視覺化工具能讓你直觀了解代理間互動，如資訊流動圖表，有助識別瓶頸、低效率或其他系統問題。
- **效能指標**：效能指標能協助你追蹤多代理系統效能。例如，追蹤完成任務所需時間、單位時間內完成任務數以及代理推薦的準確度。這些資訊能幫助識別改善空間並優化系統。

## 多代理模式

讓我們探討幾個具體模式，可用於建立多代理應用。以下是值得考慮的有趣模式：

### 群組聊天

此模式適用於建立多代理彼此通訊的群組聊天應用。典型使用案例包括團隊協作、客戶支援及社交網絡。

在此模式中，每個代理代表群組聊天中的一位用戶，代理間透過訊息協定交換訊息。代理能發送訊息至群組、接收群組訊息及回應其他代理訊息。

此模式可利用集中式架構（所有訊息經由中央伺服器）或去中心化架構（訊息直接交換）實現。

![Group chat](../../../translated_images/zh-MO/multi-agent-group-chat.ec10f4cde556babd.webp)

### 任務交接

此模式適用於多代理可相互交接任務的應用。

典型使用場景包括客戶支援、任務管理及流程自動化。

在此模式中，每個代理代表一項任務或流程中的一個步驟，代理可根據預設規則將任務交給其他代理。

![Hand off](../../../translated_images/zh-MO/multi-agent-hand-off.4c5fb00ba6f8750a.webp)

### 協同過濾

此模式適用於多代理合作為用戶做推薦的應用。

多代理合作的原因是每個代理具備不同專長，可於推薦過程中以不同方式貢獻。

舉例，用戶想要獲得股市最佳買進股票的推薦。

- **產業專家**：一個代理專長於特定產業
- **技術分析**：另一代理專精技術分析
- **基本面分析**：還有代理專長基本面分析。透過合作，這些代理能為用戶提供更全面的推薦。

![Recommendation](../../../translated_images/zh-MO/multi-agent-filtering.d959cb129dc9f608.webp)

## 範例：退款流程

考慮一個顧客嘗試申請產品退款的情境，整個流程可能涉及多個代理，我們以退款特定代理和其他通用代理區分。

**退款流程專用代理**：

以下是可能參與退款流程的代理：

- **客戶代理**：代表顧客，負責啟動退款流程。
- **賣家代理**：代表賣家，負責處理退款事宜。
- **付款代理**：負責處理付款並返還顧客款項。
- **解決代理**：負責解決退款過程中出現的問題。
- **合規代理**：確保退款流程符合法規與政策。

**通用代理**：

這些代理可被企業其他部門使用。

- **運送代理**：代表運送過程，負責將產品寄回賣家。可用於退款流程及一般購買產品運送。
- **回饋代理**：負責蒐集顧客回饋，回饋可於任何時間收集，不限退款時。
- **升級代理**：負責將問題升級至更高層支援。適用於任何需升級問題的流程。
- **通知代理**：負責在退款過程各階段向顧客發送通知。
- **分析代理**：負責分析與退款流程相關的數據。
- **審計代理**：負責審核退款流程，確保正確執行。
- **報告代理**：負責產生退款流程的報告。
- **知識代理**：維護退款流程相關的知識庫，也能涵蓋企業其他領域知識。
- **安全代理**：負責確保退款流程的安全性。
- **品質代理**：負責確保退款流程的品質。

以上列出許多代理，包括退款專用代理及可用於企業其他部分的通用代理。希望這能讓你有所啟發，知道如何選擇多代理系統中所需代理。

## 作業

為客戶支援流程設計一套多代理系統。識別流程中涉及的代理、其角色和職責，以及他們如何互動。考慮包括客戶支援流程專用代理和企業其他部分可共用的通用代理。
> 在閱讀以下解決方案之前，請先思考一下，你可能需要比想像中更多的代理人。

> TIP：思考客戶支持流程的不同階段，同時考慮系統所需的代理人。

## 解決方案

[Solution](./solution/solution.md)

## 知識檢查

問題：何時應該考慮使用多代理人？

- [ ] A1：當你有少量工作和簡單任務時。
- [ ] A2：當你有大量工作時。
- [ ] A3：當你有簡單任務時。

[Solution quiz](./solution/solution-quiz.md)

## 總結

在本課中，我們探討了多代理設計模式，包括適用多代理的情境、使用多代理相較於單一代理的優勢、實現多代理設計模式的組件，以及如何監察多個代理彼此互動的情況。

### 對多代理設計模式有更多疑問嗎？

加入 [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord) 與其他學習者交流，參加辦公時間並解答你的 AI 代理問題。

## 額外資源

- <a href="https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html" target="_blank">AutoGen 設計模式</a>
- <a href="https://www.analyticsvidhya.com/blog/2024/10/agentic-design-patterns/" target="_blank">代理設計模式</a>

## 上一課

[Planning Design](../07-planning-design/README.md)

## 下一課

[Metacognition in AI Agents](../09-metacognition/README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**免責聲明**：
本文件乃使用 AI 翻譯服務 [Co-op Translator](https://github.com/Azure/co-op-translator) 所翻譯。雖然我們致力於確保準確性，但請注意自動翻譯結果可能包含錯誤或不準確之處。原始文件的母語版本應視為權威來源。對於重要資訊，建議採用專業人工翻譯。我們不對因使用此翻譯而引起之任何誤解或誤釋承擔責任。
<!-- CO-OP TRANSLATOR DISCLAIMER END -->