# 使用 Agentic Protocols (MCP, A2A and NLWeb)

[![代理協定](../../../translated_images/zh-MO/lesson-11-thumbnail.b6c742949cf1ce2a.webp)](https://youtu.be/X-Dh9R3Opn8)

> _(點擊上方圖片以觀看本課程的教學影片)_

隨著 AI 代理的使用增加，對於能確保標準化、安全性並支援開放創新的協定需求也在增加。在本課程中，我們將介紹三種旨在滿足這些需求的協定 — 模型上下文協定（Model Context Protocol，MCP）、代理間協定（Agent to Agent，A2A）與自然語言網頁（Natural Language Web，NLWeb）。

## 介紹

在本課程中，我們將涵蓋：

• MCP 如何讓 AI 代理存取外部工具與資料以完成使用者任務。

• A2A 如何促進不同 AI 代理之間的通訊與協作。

• NLWeb 如何為任何網站帶來自然語言介面，使 AI 代理能發現並互動網站內容。

## 學習目標

• 辨識 MCP、A2A 與 NLWeb 在 AI 代理情境下的核心目的與效益。

• 說明每個協定如何促進 LLM、工具與其他代理之間的通訊與互動。

• 認識每個協定在構建複雜代理系統時所扮演的不同角色。

## 模型上下文協定

模型上下文協定（Model Context Protocol，**MCP**）是一個開放標準，提供應用程式向 LLM 提供上下文與工具的標準化方式。這讓 AI 代理能以一致的方式連接到不同的資料來源與工具，充當「通用介面」。

讓我們來看看 MCP 的組成要素、相對於直接使用 API 的好處，以及 AI 代理可能如何使用 MCP 伺服器的示例。

### MCP 核心組件

MCP 採用**客戶端-伺服器架構**運作，核心組件包括：

• **Hosts** 為啟動連線到 MCP 伺服器的 LLM 應用程式（例如像 VSCode 的程式碼編輯器）。

• **Clients** 是宿主應用程式中的元件，負責與伺服器維持一對一的連線。

• **Servers** 是暴露特定功能的輕量程式。

協定中包含三個核心原語，代表 MCP 伺服器的功能：

• **Tools**：這些為 AI 代理可呼叫以執行動作的離散操作或函式。例如，天氣服務可能會暴露「get weather」工具，或電商伺服器可能會暴露「purchase product」工具。MCP 伺服器在其能力清單中會宣告每個工具的名稱、描述與輸入/輸出模式。

• **Resources**：這些為 MCP 伺服器能提供、且客戶端可按需檢索的唯讀資料項或文件。範例包括檔案內容、資料庫記錄或日誌檔。Resources 可以是文字（如程式碼或 JSON）或二進位（如圖片或 PDF）。

• **Prompts**：這些為預定義的範本，提供建議提示以允許更複雜的工作流程。

### MCP 的好處

MCP 為 AI 代理帶來重要優勢：

• **動態工具發現**：代理可以動態接收伺服器提供的可用工具清單以及它們的描述。這與傳統 API 需靜態編碼整合不同，傳統 API 的任何變更通常需要更新程式碼。MCP 提供「一次整合」的方法，提高適應性。

• **跨 LLM 的互通性**：MCP 可在不同的 LLM 之間運作，提供切換核心模型以評估更好效能的彈性。

• **標準化的安全性**：MCP 包含標準的驗證方法，當新增對額外 MCP 伺服器的存取時能改善可擴展性。這比為各種傳統 API 管理不同金鑰與驗證類型要簡單。

### MCP 範例

![MCP 示意圖](../../../translated_images/zh-MO/mcp-diagram.e4ca1cbd551444a1.webp)

想像使用 MCP 驅動的 AI 助手幫使用者訂機票的情境。

1. **連線**：AI 助手（MCP 客戶端）連接到航空公司提供的 MCP 伺服器。

2. **工具發現**：客戶端詢問航空公司的 MCP 伺服器：「你們有哪些可用的工具？」伺服器回應像是「search flights」和「book flights」等工具。

3. **工具呼叫**：使用者接著請 AI 助手：「請搜尋從 Portland 到 Honolulu 的航班。」AI 助手使用其 LLM 判斷需要呼叫「search flights」工具，並將相關參數（出發地、目的地）傳給 MCP 伺服器。

4. **執行與回應**：MCP 伺服器作為包裝層，實際呼叫航空公司的內部訂票 API，取得航班資訊（例如 JSON 資料），然後回傳給 AI 助手。

5. **進一步互動**：AI 助手呈現航班選項。當你選擇航班後，助理可能會在同一 MCP 伺服器上呼叫「book flight」工具，完成訂位。

## 代理間協定 (A2A)

當 MCP 著重於連接 LLM 到工具時，**代理對代理協定（Agent-to-Agent，A2A）** 更進一步，使不同 AI 代理之間能彼此通訊與協作。A2A 將不同組織、環境與技術棧中的 AI 代理連接起來，共同完成一項共享任務。

我們將檢視 A2A 的組件與好處，以及在我們的旅遊應用中如何應用的範例。

### A2A 核心組件

A2A 著重於讓代理之間能夠通訊並協同完成使用者的子任務。協定的每個組件皆有助於此：

#### Agent Card

類似於 MCP 伺服器分享工具清單的方式，Agent Card 包含：
- The Name of the Agent .
- 對它可完成的一般任務的描述。
- 一個帶有描述的具體技能清單，幫助其他代理（甚至人類使用者）了解何時以及為何要呼叫該代理。
- 代理的當前 Endpoint URL
- 代理的版本與能力，例如串流回應與推送通知。

#### Agent Executor

Agent Executor 負責將使用者聊天的上下文傳遞給遠端代理，遠端代理需要此來理解需完成的任務。在 A2A 伺服器中，代理會使用其自己的大型語言模型（LLM）來解析傳入請求並使用其內部工具執行任務。

#### Artifact

一旦遠端代理完成請求的任務，其工作產出會以 artifact 形式建立。artifact 包含代理完成工作的結果、已完成內容的描述，以及透過協定傳遞的文字上下文。artifact 傳送後，與遠端代理的連線會關閉，直到再次需要時才重新開啟。

#### Event Queue

此組件用於處理更新與傳遞訊息。它在生產環境中對代理系統特別重要，以防止在任務完成之前代理之間的連線被關閉，特別是當任務完成時間可能較長時。

### A2A 的好處

• **強化的協作**：它讓來自不同供應商與平臺的代理能互動、分享上下文並協同工作，促成跨傳統上分離系統的無縫自動化。

• **模型選擇彈性**：每個 A2A 代理可以決定其使用哪個 LLM 來服務請求，允許為每個代理優化或使用微調模型，這與某些 MCP 場景中僅有單一 LLM 連線不同。

• **內建驗證機制**：驗證直接整合在 A2A 協定中，為代理互動提供堅固的安全框架。

### A2A 範例

![A2A 示意圖](../../../translated_images/zh-MO/A2A-Diagram.8666928d648acc26.webp)

讓我們延伸前述旅遊訂票情境，這次使用 A2A。

1. **使用者向多代理發出請求**：使用者與一個「旅行代理」A2A 客戶端/代理互動，可能說：「請幫我訂下週前往 Honolulu 的整個行程，包括航班、旅館與租車」。

2. **旅行代理的協調**：旅行代理接收這項複雜請求。它使用其 LLM 來推理任務，並判定需要與其他專門代理互動。

3. **代理間通訊**：旅行代理接著使用 A2A 協定連接下游代理，例如由不同公司建立的「航空公司代理」、「飯店代理」與「租車代理」。

4. **委派任務執行**：旅行代理向這些專門代理傳送特定任務（例如：「搜尋飛往 Honolulu 的航班」、「訂飯店」、「租車」）。每個專門代理都運行自己的 LLM 並使用自己的工具（這些工具本身也可能是 MCP 伺服器）來執行其負責的訂票部分。

5. **整合回應**：當所有下游代理完成任務後，旅行代理整合結果（航班資訊、飯店確認、租車訂單），並以對話式的綜合回應回傳給使用者。

## 自然語言網頁（NLWeb）

網站長期以來一直是使用者存取網路上資訊與資料的主要方式。

讓我們來看 NLWeb 的不同組成部分、NLWeb 的好處，以及透過我們的旅遊應用示例說明 NLWeb 如何運作。

### NLWeb 的組成

- **NLWeb 應用程式（核心服務程式碼）**：處理自然語言問題的系統。它連接平台的不同部分以產生回應。你可以把它視為驅動網站自然語言功能的引擎。

- **NLWeb 協定**：這是一套用於與網站進行自然語言互動的基本規則。它以 JSON 格式（通常使用 Schema.org）回傳回應。其目的在於為「AI 網路」建立一個簡單的基礎，類似於 HTML 讓線上分享文件成為可能。

- **MCP 伺服器（Model Context Protocol 端點）**：每個 NLWeb 設定也同時作為一個 MCP 伺服器。這表示它可以與其他 AI 系統分享工具（例如「ask」方法）與資料。實務上，這使得網站的內容與功能可被 AI 代理使用，將該網站納入更廣泛的「代理生態系」。

- **Embedding 模型**：這些模型用於將網站內容轉換為稱為向量（embeddings）的數值表示。這些向量以便電腦比較與搜尋它們所代表的意義。這些向量會儲存在特定資料庫中，使用者可以選擇想使用的 embedding 模型。

- **向量資料庫（檢索機制）**：此資料庫儲存網站內容的 embeddings。當有人提出問題時，NLWeb 會檢查向量資料庫以快速找出最相關的資訊，並根據相似度回傳一份可能答案的清單。NLWeb 可與不同的向量儲存系統合作，例如 Qdrant、Snowflake、Milvus、Azure AI Search 與 Elasticsearch。

### 透過範例了解 NLWeb

![NLWeb 示意圖](../../../translated_images/zh-MO/nlweb-diagram.c1e2390b310e5fe4.webp)

再以我們的旅遊訂票網站為例，但這次由 NLWeb 提供支援。

1. **資料擷取**：旅遊網站現有的產品目錄（例如航班清單、飯店描述、旅遊套裝）會使用 Schema.org 格式化或透過 RSS 摘要載入。NLWeb 的工具擷取這些結構化資料，建立 embeddings，並將它們儲存在本地或遠端的向量資料庫中。

2. **自然語言查詢（人類）**：使用者造訪網站後，並非逐頁瀏覽，而是在聊天介面輸入：「替我找下週在 Honolulu 有游泳池且適合家庭入住的飯店」。

3. **NLWeb 處理**：NLWeb 應用接收此查詢。它會將查詢傳給 LLM 作理解，同時搜尋其向量資料庫以找出相關的飯店列表。

4. **精確結果**：LLM 協助解釋資料庫的搜尋結果，根據「適合家庭」、「游泳池」與「Honolulu」等條件辨識最佳匹配，並將結果格式化為自然語言回應。關鍵在於，回應會參照網站目錄中的實際飯店，避免虛構資訊。

5. **AI 代理互動**：由於 NLWeb 也作為 MCP 伺服器，外部的 AI 旅行代理亦可連接到該網站的 NLWeb 實例。該 AI 代理即可使用 `ask("Are there any vegan-friendly restaurants in the Honolulu area recommended by the hotel?")` MCP 方法直接查詢網站。NLWeb 實例會處理此查詢，利用其已載入的餐廳資訊資料庫（若有），並回傳結構化的 JSON 回應。

### 對 MCP/A2A/NLWeb 有更多問題嗎？

加入 [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord) 與其他學習者交流、參加問答時段並取得 AI 代理相關問題的協助。

## 資源

- [初學者的 MCP](https://aka.ms/mcp-for-beginners)  
- [MCP 文件](https://github.com/microsoft/semantic-kernel/tree/main/python/semantic-kernel/semantic_kernel/connectors/mcp)
- [NLWeb 倉庫](https://github.com/nlweb-ai/NLWeb)
- [Semantic Kernel 指南](https://learn.microsoft.com/semantic-kernel/)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
免責聲明：
本文件是使用 AI 翻譯服務 Co-op Translator（https://github.com/Azure/co-op-translator）進行翻譯。雖然我們力求準確，但請注意自動翻譯可能包含錯誤或不準確之處。原始語言的文件應被視為具權威性的版本。若涉及重要資訊，建議採用專業人工翻譯。我們對因使用本翻譯而導致的任何誤解或錯誤詮釋概不負責。
<!-- CO-OP TRANSLATOR DISCLAIMER END -->