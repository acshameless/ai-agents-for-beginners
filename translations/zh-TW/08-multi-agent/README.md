[![Multi-Agent Design](../../../translated_images/zh-TW/lesson-8-thumbnail.278a3e4a59137d62.webp)](https://youtu.be/V6HpE9hZEx0?si=A7K44uMCqgvLQVCa)

> _(點擊上方圖片觀看本課程影片)_

# 多代理設計模式

一旦你開始處理有多個代理的專案，你就需要考慮多代理設計模式。然而，什麼時候該切換到多代理，及其優點可能並不立即明確。

## 簡介

在本課程中，我們將嘗試回答以下問題：

- 哪些情境適用多代理？
- 使用多代理相比單一代理執行多項任務有什麼優勢？
- 實現多代理設計模式的基本組件有哪些？
- 我們如何掌握多個代理之間的互動情況？

## 學習目標

完成本課程後，你應該能夠：

- 辨識適用多代理的情境
- 認識使用多代理優於單一代理的優勢
- 理解實現多代理設計模式的基本組件

更大的整體概念是什麼？

*多代理是一種設計模式，允許多個代理共同合作以達成共同目標*。

這種模式廣泛應用於各個領域，包括機器人學、自主系統與分布式運算。

## 適用多代理的情境

那麼，哪些情境適合使用多代理呢？答案是，有很多情境下使用多代理是有益的，特別是在以下情況：

- **大量工作負載**：大型工作可以拆分為較小的任務分派給不同代理，使得可並行處理並加快完成速度。舉例而言，大型資料處理任務就是如此。
- **複雜任務**：複雜任務像大型工作負載一樣，可拆分為不同的子任務分派給專精不同領域的代理。良好範例是自主車輛中，不同代理分管導航、障礙物偵測及與其他車輛通訊等功能。
- **多元專業技能**：不同代理擁有不同專長，使他們能更有效處理任務中不同面向，勝過單一代理。舉例來說，醫療領域中，代理可分別負責診斷、治療方案及病患監測。

## 使用多代理優於單一代理的優點

單一代理系統適用於簡單任務，但面對更複雜任務時，使用多代理有幾項優點：

- **專業化**：每個代理可專注於特定任務。單一代理缺乏專業化時，可能面對複雜任務時不知該如何處理，可能錯誤執行不適合自己的任務。
- **可擴充性**：增加更多代理比單一代理承載更多工作更容易擴充系統。
- **容錯性**：若一個代理失效，其他代理仍可繼續運作，確保系統穩定可靠。

舉例來說，假設為用戶預訂旅程。單一代理系統需處理整個預訂流程，從尋找航班、訂旅館到租車，代理必須有處理各任務的工具。但這樣系統可能變得複雜且難以維護與擴展。反之，多代理系統中，每個代理專精尋找航班、訂旅館或租車，使系統更模組化、更易維護且可擴展。

類比單一小商店旅遊代理與特許經營旅遊代理的差異，小商店由單一代理處理所有旅遊預訂事務，而特許經營則由多個代理分工負責不同面向。

## 多代理設計模式的基本組件

在實作多代理設計模式之前，需了解組成模式的基本組件。

以預訂旅程為例，基本組件包括：

- **代理通訊**：尋找航班、訂旅館、租車代理需要溝通並共享用戶喜好與限制資訊。你需決定通訊協定與方法。例如尋找航班代理需與訂旅館代理溝通，確保旅館訂於與航班相同日期，即需共享用戶出行日期資料。這表示你需決定「哪些代理共享資訊以及如何共享」。
- **協調機制**：代理需協調彼此行動，確保用戶喜好與限制被滿足。用戶可能希望旅館靠近機場，而租車只能在機場取車，則旅館訂房代理須配合租車代理，達成需求。這表示你需決定「代理如何協調彼此行動」。
- **代理架構**：代理內部需具備決策與學習機制，能依用戶互動調整策略。舉例，尋找航班代理需有內部架構判斷推薦哪些航班，可用機器學習模型，依用戶過去偏好推薦航班。你需決定「代理如何作決策以及從互動中學習」。
- **多代理互動可視化**：你需能掌握多個代理間如何互動。故需要工具與技術追蹤代理活動與互動，例如日誌監控系統、視覺化工具及績效指標。
- **多代理模式**：多代理系統可採用集中式、去中心化或混合架構等不同模式，你需決定最適用於案例的設計模式。
- **人員介入（human in the loop）**：多數情況下會有人員介入，你須指示代理何時請求人工協助，例如用戶要求特定未被推薦的航班或旅館，或在訂購前請確認。

## 多代理互動的可視化

能掌握多代理之間的互動關係十分重要，這對除錯、優化及確保系統整體效能至關重要。為此，你需具備追蹤代理活動與互動的工具與技術，形式包括日誌監控工具、視覺化工具及效能評量指標。

以用戶預訂旅程為例，可能有儀錶板展示各代理狀態、用戶喜好與限制，以及代理間互動。此儀錶板能顯示用戶出行日期、航班代理推薦的航班、旅館代理推薦的飯店、租車代理推薦的車輛，讓你清楚看見代理間如何互動，與是否符合用戶需求與限制。

讓我們更詳細看這些面向：

- **日誌與監控工具**：你想記錄每個代理執行的動作。日誌條目可包含執行代理、動作內容、時間與結果。這些資料有助除錯與優化。
- **視覺化工具**：視覺化工具能直觀呈現代理間互動。舉例可用流程圖展示資訊流向，幫助識別瓶頸、低效率或系統問題。
- **效能指標**：效能指標有助追蹤多代理系統的效果，例如完成任務所需時間、每單位時間完成任務數量、代理推薦準確率等，有助找出改善空間與優化。

## 多代理模式

接著深入幾個可用於建立多代理應用的具體模式，以下是值得考慮的幾種：

### 群組聊天

此模式適用於建立多代理可互相通訊的群組聊天應用。典型案例包括團隊協作、客服支援及社交網絡。

此模式中，每個代理代表群組內一名使用者，並用訊息協定互傳訊息。代理能向群組發送訊息、接收訊息並回覆其他代理的訊息。

此模式可用集中式架構實現，消息經由中心伺服器路由，或去中心化架構直接交換訊息。

![Group chat](../../../translated_images/zh-TW/multi-agent-group-chat.ec10f4cde556babd.webp)

### 任務交接

此模式適用於建立多個代理間能交接工作任務的應用。

典型案例包含客服支援、任務管理及流程自動化。

此模式中，每個代理代表工作或流程中的一環，依預設規則可將任務交給其他代理。

![Hand off](../../../translated_images/zh-TW/multi-agent-hand-off.4c5fb00ba6f8750a.webp)

### 協同過濾

此模式適用於建立多個代理合作給使用者推薦的應用。

多代理合作的原因在於各代理具不同專長，可從不同角度提供推薦。

舉例，用戶要找股市中最佳購買股票建議。

- **產業專家**：代理專精特定產業。
- **技術分析**：另個代理專長技術分析。
- **基本面分析**：還有代理專長基本面分析。透過合作，這些代理能提供更完整的推薦。

![Recommendation](../../../translated_images/zh-TW/multi-agent-filtering.d959cb129dc9f608.webp)

## 範例：退款流程

考慮用戶申請商品退款的情境，可能涉及多個代理，但我們可將代理分為專責退款流程及可用於其他流程的通用代理。

**專責退款流程代理**：

以下是可能參與退款流程的代理：

- **客戶代理**：代表用戶，負責啟動退款流程。
- **賣方代理**：代表賣方，負責處理退款。
- **付款代理**：代表付款流程，負責退款給用戶。
- **解決代理**：負責解決退款過程中出現的問題。
- **合規代理**：確保退款流程符合法規與政策。

**通用代理**：

此類代理可供業務其他部分使用。

- **運送代理**：代表運送流程，負責將商品退回賣方。可用於退款流程及一般購買商品的運送。
- **回饋代理**：負責收集用戶回饋。回饋可在任何時間發生，不限於退款階段。
- **升級代理**：負責將問題升級至更高階支援。適用於任何需升級問題的流程。
- **通知代理**：負責在退款流程各階段發送通知給用戶。
- **分析代理**：負責分析退款相關資料。
- **審核代理**：負責審核退款流程，確保執行正確。
- **報告代理**：負責產出退款流程相關報告。
- **知識代理**：維護退款流程及其他業務相關知識庫。
- **安全代理**：確保退款流程的安全性。
- **品質代理**：確保退款流程品質。

前述代理數量不少，包含退款專責及可用於其他業務部分的通用代理。希望能幫助你了解如何決定多代理系統中應使用哪些代理。

## 作業

為客服流程設計多代理系統。識別該流程中的代理、他們的角色與責任，以及彼此的互動方式。請同時考慮客服專屬代理與可用於其他業務的通用代理。
> 請先思考以下解決方案，您可能需要比想像中更多的代理人。

> 提示：思考客服流程的不同階段，並且考慮任何系統所需的代理人。

## 解決方案

[Solution](./solution/solution.md)

## 知識檢核

問題：什麼時候應該考慮使用多代理？

- [ ] A1：當工作量小且任務簡單時。
- [ ] A2：當工作量大時。
- [ ] A3：當任務簡單時。

[Solution quiz](./solution/solution-quiz.md)

## 總結

在本課程中，我們探討了多代理設計模式，包括多代理適用的場景、使用多代理相較於單一代理的優點、實作多代理設計模式的構築要素，以及如何洞察多個代理之間的互動情況。

### 對多代理設計模式有更多疑問嗎？

加入 [Microsoft Foundry Discord](https://aka.ms/ai-agents/discord) ，與其他學習者交流，參加開放時間並獲得您的 AI 代理問題解答。

## 其他資源

- <a href="https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html" target="_blank">AutoGen 設計模式</a>
- <a href="https://www.analyticsvidhya.com/blog/2024/10/agentic-design-patterns/" target="_blank">Agentic 設計模式</a>

## 上一課

[Planning Design](../07-planning-design/README.md)

## 下一課

[Metacognition in AI Agents](../09-metacognition/README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**免責聲明**：  
本文件係使用 AI 翻譯服務 [Co-op Translator](https://github.com/Azure/co-op-translator) 進行翻譯。雖然我們致力於翻譯的準確性，但請注意自動翻譯可能包含錯誤或不準確之處。原始文件的原文版本應被視為權威來源。對於關鍵資訊，建議使用專業人工翻譯。我們不對因使用此翻譯而產生的任何誤解或誤譯負責。
<!-- CO-OP TRANSLATOR DISCLAIMER END -->